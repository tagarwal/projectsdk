<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Developer Guide</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="generator" content="J4C">

    <!-- Le styles -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
    <link href="css/bootstrap_yeti.css" rel="stylesheet">
    <link href="css/base.css" rel="stylesheet">
    <link href="css/prettify.css" rel="stylesheet">
    <link href="css/bootstrap-toc.min.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!-- <link rel="shortcut icon" href="favicon.ico"> -->
  </head>
  <body data-spy="scroll" data-target="#toc" data-offset="100" onload="prettyPrint()">
    <div id="wrap">
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html">J4C</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="samples.html">Samples</a></li>
            <li><a href="starter/">Project Starter</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation<b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="getting-started.html">Getting Started</a></li>
                <li><a href="developer-guide.html">Developer Guide</a></li>
                <li><a href="javadocs.html">Javadocs</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle disabled" data-toggle="dropdown">Older Versions<b class="caret"></b></a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="container" style="">

        <div class="docs-header" id="content" style="padding-left:0; padding-right:0">
          <div class="container">
            <h1>Developer Guide</h1>
            <p>A deep dive in Java for Cloud</p>
          </div>
        </div>

<div class="col-md-3" style="padding-left:0"><nav id="toc" data-spy="affix" data-offset-top="240" data-toggle="toc" class="bs-docs-sidebar"><ul class="nav"><li><a href="#_what_is_j4c">1. What is J4C?</a></li><li><a href="#components">2. Components</a><ul class="nav"><li><a href="#_web_server">2.1. Web Server</a><ul class="nav"><li><a href="#_web_server_installation">2.1.1. Web Server Installation</a></li><li><a href="#_quick_start">2.1.2. Quick start</a></li><li><a href="#_introduction">2.1.3. Introduction</a></li><li><a href="#_configuration">2.1.4. Configuration</a></li><li><a href="#_routing">2.1.5. Routing</a></li><li><a href="#_request_handling">2.1.6. Request Handling</a></li><li><a href="#anchor-error-handling">2.1.7. Error Routing</a></li><li><a href="#_register_the_way_how_to_organize_code_into_services">2.1.8. "Register" the way, how to organize code into services</a></li><li><a href="#_web_server_static_content_support">2.1.9. Web Server Static Content Support</a></li><li><a href="#_web_server_jersey_support">2.1.10. Web Server Jersey Support</a></li><li><a href="#_web_server_json_support">2.1.11. Web Server Json Support</a></li><li><a href="#_web_server_zipkin_support">2.1.12. Web Server Zipkin Support</a></li></ul></li><li><a href="#_configuration_2">2.2. Configuration</a><ul class="nav"><li><a href="#_configuration_installation">2.2.1. Configuration Installation</a></li><li><a href="#Config-Basics">2.2.2. Configuration Basics</a></li><li><a href="#Config-ConfigSources">2.2.3. Configuration Config Sources</a></li><li><a href="#Config-HierarchicalFeatures">2.2.4. Configuration Hierarchical Features</a></li><li><a href="#Config-PropertyMapping">2.2.5. Configuration Property Mapping</a></li><li><a href="#Config-MutabilitySupport">2.2.6. Configuration Mutability Support</a></li><li><a href="#Config-AdvancedTopics">2.2.7. Advanced Configuration Topics</a></li><li><a href="#Config-SPI">2.2.8. How to extend Configuration functionality (SPI)</a></li><li><a href="#_configuration_extension_modules">2.2.9. Configuration Extension modules</a></li></ul></li><li><a href="#_cloud_security">2.3. Cloud Security</a><ul class="nav"><li><a href="#_how_to_use">2.3.1. How to use</a></li><li><a href="#_cloud_security_installation">2.3.2. Cloud Security Installation</a></li><li><a href="#_cloud_security_container_integrations">2.3.3. Cloud Security Container Integrations</a></li><li><a href="#_cloud_security_providers">2.3.4. Cloud Security Providers</a></li><li><a href="#_tools">2.3.5. Tools</a></li><li><a href="#_developer_s_guide">2.3.6. Developerâ€™s Guide</a></li></ul></li><li><a href="#_open_tracing">2.4. Open Tracing</a></li><li><a href="#_prometheus">2.5. Prometheus</a></li></ul></li><li><a href="#_tracing_and_monitoring">3. Tracing and Monitoring</a></li><li><a href="#_deployment">4. Deployment</a><ul class="nav"><li><a href="#_first_deployment_section">4.1. First Deployment Section</a></li><li><a href="#_code_bmkops_code_tool">4.2. bmkops Tool</a><ul class="nav"><li><a href="#_installation">4.2.1. Installation</a></li></ul></li></ul></li><li><a href="#_samples">5. Samples</a></li></ul></nav></div><div class="col-md-9" role="main"><div class="docs-content"><div class="sect1">
<h2 id="_what_is_j4c">1. What is J4C?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Java for Cloud is a Java platform for writing cloud native applications. It is a collection of
APIs&#8201;&#8212;&#8201;some old, some new&#8201;&#8212;&#8201;combined with tooling to help you write and
deploy microservices. J4C applications are just plain old Java applications, so
there is no new framework to learn.</p>
</div>
<div class="paragraph">
<p>The APIs that J4C provides fall into three categories:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#components">New Reactive APIs</a>: a collection of new APIs designed specifically
for writing services using the reactive features introduced in Java 8 and Java 9.
These APIs cover HTTP/REST, asynchronous messaging, configuration, NoSQL and more.</p>
</li>
<li>
<p><a href="#javaee">Java EE APIs</a>: a number of Java EE APIs that are well suited for writing
cloud native applications</p>
</li>
<li>
<p><a href="#opensource">Additional Open Source APIs</a>: additional popular open source APIs.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>J4C is a one stop shop for using these APIs by providing easy access to project
documentation, javadocs and examples. J4C also provides Maven and Gradle tooling to
facilitate writing and deploying your cloud native applications:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Project generators for conveniently creating a Maven or Gradle projects</p>
</li>
<li>
<p>Plugins for generating docker images containing your application</p>
</li>
<li>
<p>Plugins to automate deploying your application to Kubernetes</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="components">2. Components</h2>
<div class="sectionbody">
<div class="paragraph">
<p>J4C consists of a collection of components (libraries) for implementing
your cloud native application. The first set of components in the list below
are the new J4C reactive style APIs. These APIs are all simple
libraries that use an imperative style of programming, and leverage a
number of language features in Java 8 and Java 9 (lambda&#8217;s, streams, flows,
etc). Unlike some Java EE APIs these libraries do not require a managing
container to run. They also don&#8217;t rely on annotations much, and where they
do support annotations they are typically provided as a shortcut for
 something that you could otherwise do using methods.</p>
</div>
<div class="paragraph">
<p>The second group of APIs come from Java EE. While you might think of Java EE
as being suited for application servers only, it turns out a number of
Java EE APIs work equally as well in a plain old Java SE application.
So we&#8217;ve included those here as well.</p>
</div>
<div class="paragraph">
<p>And finally we provide a collection of other open source components.</p>
</div>
<div class="sect2">
<h3 id="_web_server">2.1. Web Server</h3>
<div class="paragraph">
<p>The Web Server project aims to provide a reactive API for creating Web (HTTP) Server instances that can route
and process client requests based on the programmatically defined processing routes.
The API is inspired by popular Node and Java frameworks.</p>
</div>
<div class="sect3">
<h4 id="_web_server_installation">2.1.1. Web Server Installation</h4>
<div class="sect4">
<h5 id="_coordinates">Coordinates</h5>
<div class="paragraph">
<p>Latest version can be found at:</p>
</div>
<div class="paragraph">
<p><a href="https://artifactory-slc.oraclecorp.com/artifactory/api/search/latestVersion?g=io.j4c.webserver&amp;a=j4c-webserver&amp;repos=mic-release-local" class="bare">https://artifactory-slc.oraclecorp.com/artifactory/api/search/latestVersion?g=io.j4c.webserver&amp;a=j4c-webserver&amp;repos=mic-release-local</a></p>
</div>
<div class="paragraph">
<p>Version at the time this document was written: 0.1.0-b74</p>
</div>
<div class="listingblock">
<div class="title">Maven Dependencies</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.j4c.webserver<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>j4c-webserver-netty<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>0.1.0-b74<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_requirements">Requirements</h5>
<div class="listingblock">
<div class="title">Java 9 Required</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">$ java -version
java version &quot;9-ea&quot;
Java(TM) SE Runtime Environment (build 9-ea+163)
Java HotSpot(TM) 64-Bit Server VM (build 9-ea+163, mixed mode)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tools:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven</p>
</li>
<li>
<p>Docker (optional)</p>
</li>
<li>
<p>Zipkin (optional)</p>
</li>
<li>
<p>Minikube (optional)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_quick_start">2.1.2. Quick start</h4>
<div class="paragraph">
<p>To have a running Reactive Web Server, use the code block bellow while following requirements are meet:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Dependencies:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><a href="#_coordinates">Web Server module</a>: <code>io.j4c.webserver:j4c-webserver</code></p>
</li>
<li>
<p>TCP Server implementation module, such as <a href="#anchor-netty">Netty based one</a>: <code>io.j4c.webserver:j4c-webserver-netty</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>JDK 9</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Running Web Server on a random free port</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> <span class="exception">Exception</span> {
        WebServer webServer = WebServer
                .create(Routing.builder()
                               .any((req, res) -&gt; res.send(<span class="string"><span class="delimiter">&quot;</span><span class="content">It works!</span><span class="delimiter">&quot;</span></span>)) <i class="conum" data-value="1"></i><b>(1)</b>
                               .build())
                .start() <i class="conum" data-value="2"></i><b>(2)</b>
                .toCompletableFuture()
                .get(<span class="integer">10</span>, <span class="predefined-type">TimeUnit</span>.SECONDS); <i class="conum" data-value="3"></i><b>(3)</b>

        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Server started at: http://localhost:</span><span class="delimiter">&quot;</span></span> + webServer.port());
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>For any kind of request at any path response with <code>It works!</code> string.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Start the server.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Wait for the server to start while throwing possible errors as exceptions</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_introduction">2.1.3. Introduction</h4>
<div class="paragraph">
<p>The Web Server project provides asynchronous and reactive API for creating web applications.
It requires a non-blocking TCP server. Currently, the only implemented integration is on top of the Netty project.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/webserver/architecture.png" alt="WebServer architecture">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuration">2.1.4. Configuration</h4>
<div class="paragraph">
<p>The Web Server is configured through a <code>ServerConfiguration</code> by using
its <code>ServerConfiguration.Builder</code> builder.</p>
</div>
<div class="paragraph">
<p>The easiest way to configure the Web Server is a programmatic way:</p>
</div>
<div class="listingblock">
<div class="title">Programmatic configuration of the Web Server</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ServerConfiguration configuration = ServerConfiguration.builder()
                                                       .bindAddress(<span class="predefined-type">InetAddress</span>.getLocalHost())
                                                       .port(<span class="integer">8080</span>)
                                                       .build();

WebServer webServer = WebServer.create(configuration, routing)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Additionally, the Web Server supports a configuration through the J4C Config:</p>
</div>
<div class="listingblock">
<div class="title">Web Server Configuration file <code>application.conf</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="hocon">webserver {
  port: 8080,
  bind-address: &quot;0.0.0.0&quot;,
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Web Server initialization with the <code>application.conf</code> file located on classpath</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ServerConfiguration configuration = ServerConfiguration.fromConfig(
        Config.builder()
              .source(ClasspathConfigSource.from(<span class="string"><span class="delimiter">&quot;</span><span class="content">application.conf</span><span class="delimiter">&quot;</span></span>))
              .build());

WebServer webServer = WebServer.create(configuration, routing)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The full set of all available options and their description is available at
<a href="http://mic-api.uk.oracle.com/webserver/io/j4c/webserver/ServerConfiguration.html">Reactive Web Server Java API</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_routing">2.1.5. Routing</h4>
<div class="paragraph">
<p>The routing is an essential part of WebServer API. It uses request matching criteria to bind requests to the
custom business logic - <code>Handler</code>. Matching criteria are a pair of an <strong>HTTP Method(s)</strong> and request <strong>path matcher</strong>.
Routing also supports <em>Error Routing</em> which binds java <code>Throwable</code> to the handling logic.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is also possible to use <a href="#anchor-requestpredicate">RequestPredicate</a> for finer routing using more criteria.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The configuration of the HTTP requests routing is done through the <code>Routing</code> interface by its
<code>Routing.Builder</code> builder.</p>
</div>
<div class="listingblock">
<div class="title">Using Routing.Builder to configure HTTP requests handling</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Routing routing = Routing.builder()
                         .get(<span class="string"><span class="delimiter">&quot;</span><span class="content">/hello</span><span class="delimiter">&quot;</span></span>, (req, res) -&gt; res.send(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World!</span><span class="delimiter">&quot;</span></span>)) <i class="conum" data-value="1"></i><b>(1)</b>
                         .build();

WebServer webServer = WebServer.create(configuration, routing) <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Handle all GETs to <code>/hello</code> path and send back a string <code>Hello World!</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>plug the <code>routing</code> into the Web Server</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_http_method_routing">HTTP Method Routing</h5>
<div class="paragraph">
<p>The <code>Routing.Builder</code> allows to handle each HTTP method, that is:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">HTTP Method</th>
<th class="tableblock halign-left valign-top">Routing.Builder example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>GET</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.get((req, res) -&gt; { /* handler */ })</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PUT</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.put((req, res) -&gt; { /* handler */ })</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>POST</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.post((req, res) -&gt; { /* handler */ })</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>HEAD</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.head((req, res) -&gt; { /* handler */ })</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>DELETE</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.delete((req, res) -&gt; { /* handler */ })</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>TRACE</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.trace((req, res) -&gt; { /* handler */ })</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>OPTIONS</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.options((req, res) -&gt; { /* handler */ })</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>any method</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.any((req, res) -&gt; { /* handler */ })</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>selected methods</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.anyOf(List.of(Http.Method.GET, Http.Method.POST), (req, res) -&gt; { /* handler */ })</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_path_matcher_routing">Path Matcher Routing</h5>
<div class="paragraph">
<p>Any HTTP method routing can be combined with request path matching.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Routing.builder()
       .post(<span class="string"><span class="delimiter">&quot;</span><span class="content">/some/path</span><span class="delimiter">&quot;</span></span>, (req, res) -&gt; { <span class="comment">/* handler */</span> })</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is possible to use <strong>path pattern</strong> instead of <em>path</em> with the following syntax:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/foo/bar/baz</code> - Exact path match against resolved path even with non-usual characters</p>
</li>
<li>
<p><code>/foo/{}/baz</code> - <code>{}</code> Unnamed regular expression segment <code>([^/]+)</code></p>
</li>
<li>
<p><code>/foo/{var}/baz</code> - Named regular expression segment <code>([^/]+)</code></p>
</li>
<li>
<p><code>/foo/{var:\d+}</code> - Named regular expression segment with a specified expression</p>
</li>
<li>
<p><code>/foo/{:\d+}</code> - Unnamed regular expression segment with a specified expression</p>
</li>
<li>
<p><code>/foo/{+var}</code> - A convenience shortcut for {var:.+}. A matcher is not a true URI template (as defined by RFC) but this convenience is sync with the Apiary templates.</p>
</li>
<li>
<p><code>/foo/{+}</code> - Convenience shortcut for unnamed segment with regular expression {:.+}</p>
</li>
<li>
<p><code>/foo[/bar]</code> - An optional block, Translated to <code>/foo(/bar)?</code> regular expression.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Path (matcher) routing is <strong>exact</strong>. It means that request on <code>/foo/bar</code> is <strong>not</strong> routed to <code>.post('/foo', &#8230;&#8203;)</code>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Always start <em>path</em> and <em>path patterns</em> wits <code>/</code> character.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="anchor-requestpredicate">Request Predicate</h5>
<div class="paragraph">
<p><code>RequestPredicate</code> is an utility class to construct (build) a predicate based on typical request criteria such as header
or cookie existence, content type and others. It is also possible to construct handler, which process only
requests accepted by the predicate. All other requests are <em>nexted</em> - rote to the next valid handler.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">.post(<span class="string"><span class="delimiter">&quot;</span><span class="content">/foo</span><span class="delimiter">&quot;</span></span>,
      RequestPredicate.whenRequest()
                      .containsHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">my-gr8-header</span><span class="delimiter">&quot;</span></span>)
                      .accepts(MediaType.TEXT_PLAIN)
                      .and(<span class="local-variable">this</span>::isUserAuthenticated)
                      .thenApply((req, resp) -&gt; {
                           <span class="comment">// Some logic</span>
                      })
                      .otherwise((req, resp) -&gt; { <span class="comment">/* Otherwise logic */</span> }); <span class="comment">// Optional, default logic is req.next()</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_request_handling">2.1.6. Request Handling</h4>
<div class="paragraph">
<p><code>Handler</code> is a <code>FunctionalInterface</code> representing a business logic bind to some request. The goal of the handler is</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Process the request and  <a href="#anchor-sending-response">send</a> response.</p>
</li>
<li>
<p>Act as a filter and forward to downstream handlers using <code>request.next()</code> method.</p>
</li>
<li>
<p>Throw an exception or call `request.next(exception) to begin <a href="#anchor-error-handling">error handling</a>.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_process_request_and_produce_response">Process Request and Produce Response</h5>
<div class="paragraph">
<p>Each <code>Handler</code> has two parameters. <code>ServerRequest</code> and <code>ServerResponse</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Request provides access to the request method, URI, path, query parameters, headers and entity.</p>
</li>
<li>
<p>Response provides an ability to set response code, headers, and entity.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="anchor-filtering">Handler as a Filter</h5>
<div class="paragraph">
<p>As a filter, the handler forwards the handling to the downstream handlers by <em>nexting</em>; that is to</p>
</div>
<div class="ulist">
<ul>
<li>
<p>call <code>req.next()</code></p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">.any(<span class="string"><span class="delimiter">&quot;</span><span class="content">/hello</span><span class="delimiter">&quot;</span></span>, (req, res) -&gt; { <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="comment">// filtering logic (e.g., logging) </span><i class="conum" data-value="2"></i><b>(2)</b>
    req.next(); <i class="conum" data-value="3"></i><b>(3)</b>
})</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a handler for <code>/hello</code> path for any http method that acts as a filter</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>business logic implementation</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Forwarding the handling of the current request to the downstream handlers</td>
</tr>
</table>
</div>
</li>
<li>
<p>or call <code>req.next(throwable)</code> to forward the handling to the <a href="#anchor-error-handling">error handlers</a></p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">.any(<span class="string"><span class="delimiter">&quot;</span><span class="content">/hello</span><span class="delimiter">&quot;</span></span>, (req, res) -&gt; { <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="comment">// filtering logic (e.g., validating parameters) </span><i class="conum" data-value="2"></i><b>(2)</b>
    <span class="keyword">if</span> (userParametersOk()) {
        req.next(); <i class="conum" data-value="3"></i><b>(3)</b>
    } <span class="keyword">else</span> {
        req.next(<span class="keyword">new</span> <span class="exception">IllegalArgumentException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">User entered wrong parameters.</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="4"></i><b>(4)</b>
    }
})</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a handler for <code>/hello</code> path for any http method that acts as a filter</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>business logic implementation</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Forwarding the handling of the current request to the downstream handlers,</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Forwarding the handling to error handlers</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The handling logic can explicitly forward the execution to a different thread. This is the reason why returning from the handler can&#8217;t automatically trigger calling the next handler.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="anchor-sending-response">Sending a response</h5>
<div class="paragraph">
<p>To complete a request handling, a response must be sent by calling <code>res.send(?)</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">/hello</span><span class="delimiter">&quot;</span></span>, (req, res) -&gt; { <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="comment">// terminating logic</span>
    res.status(Http.Status.ACCEPTED_201);
    res.send(<span class="string"><span class="delimiter">&quot;</span><span class="content">Saved!</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="2"></i><b>(2)</b>
})</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a handler for <code>/hello</code> path for any http method that terminates the request</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>finishing the request by sending a response</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="anchor-error-handling">2.1.7. Error Routing</h4>
<div class="paragraph">
<p>It is possible to register an error handler for a particular <code>Throwable</code> on the <code>Routing.Builder</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Routing routing = Routing.builder()
                         .error(MyException.class, (req, res, ex) -&gt; { <i class="conum" data-value="1"></i><b>(1)</b>
                             <span class="comment">// handle the error, set the http status code</span>
                             res.send(errorDescriptionObject); <i class="conum" data-value="2"></i><b>(2)</b>
                         })
                         .build</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Registers an error handler that handles <code>MyException</code> that are thrown from the upstream handlers</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Finishes the request handling by sending a response</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Error handlers are called when</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an exception is thrown from a handler</p>
</li>
<li>
<p>when <code>req.next(ex)</code> is called (where <code>ex</code> is an instance of <code>Throwable</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As with the standard handlers, the error handler must strictly either</p>
</div>
<div class="ulist">
<ul>
<li>
<p>send a response</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">.error(MyException.class, (req, res, ex) -&gt; {
    res.status(Http.Status.BAD_REQUEST_400);
    res.send(<span class="string"><span class="delimiter">&quot;</span><span class="content">You really did wrong! Message: </span><span class="delimiter">&quot;</span></span> + ex.getMessage());
})</code></pre>
</div>
</div>
</li>
<li>
<p>forward the error handling to the downstream error handlers</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">.error(<span class="predefined-type">Throwable</span>.class, (req, res, ex) -&gt; {
    <span class="comment">// some logic</span>
    req.next(ex);
})</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is not possible to forward the error handling to the standard handlers.</p>
</div>
<div class="listingblock">
<div class="title">Calling <code>req.next(ex)</code> and <code>req.next()</code> in an error handler is equal</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">.error(<span class="predefined-type">Throwable</span>.class, (req, res, ex) -&gt; {
    <span class="keyword">if</span> (condition) {
        req.next(ex); <i class="conum" data-value="1"></i><b>(1)</b>
    } <span class="keyword">else</span> {
        req.next(); <i class="conum" data-value="2"></i><b>(2)</b>
    }
})</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Calling a downstream error handler with the <code>Throwable</code> instance</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Calling <code>req.next()</code> in an error handler is equal to calling <code>req.next(ex)</code>.</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_default_error_handling">Default error handling</h5>
<div class="paragraph">
<p>Any unmatched (i.e., no user defined error handler is matched) or <em>nexted</em> exceptions (the last error handler of the given
exception called <code>req.next()</code>) are translated to an HTTP response as follows</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Subtypes of <code>HttpException</code> are translated to their associated HTTP error codes.</p>
<div class="listingblock">
<div class="title">Reply with the <code>406</code> HTTP error code by throwing an exception</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">(req, res) -&gt; <span class="keyword">throw</span> <span class="keyword">new</span> HttpException(<span class="string"><span class="delimiter">&quot;</span><span class="content">It's illegal to send negative amount of money.</span><span class="delimiter">&quot;</span></span>, Http.Status.NOT_ACCEPTABLE_406) <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
</li>
<li>
<p>The rest of the exceptions is translated to an <em>Internal Server Error</em> HTTP error code <code>500</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_register_the_way_how_to_organize_code_into_services">2.1.8. "Register" the way, how to organize code into services</h4>
<div class="paragraph">
<p>It is also possible to register a handling module for a path prefix (i.e., register an application at a particular context root that has own handlers)</p>
</div>
<div class="listingblock">
<div class="title">Registering <em>Routing logic</em> for a context root</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">.register(<span class="string"><span class="delimiter">&quot;</span><span class="content">/context-root</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> MyComplexApplication())</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Routing logic implementation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyComplexApplication</span> <span class="directive">implements</span> Consumer&lt;Routing.Config&gt; {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> accept(Routing.Config config) {
        config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">/subpath</span><span class="delimiter">&quot;</span></span>, (req, res) -&gt; {<span class="comment">/* handler */</span>});
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In such case, the <code>GET</code> handler would match a request to <code>/context-root/subpath</code> path.</p>
</div>
</div>
<div class="sect3">
<h4 id="_web_server_static_content_support">2.1.9. Web Server Static Content Support</h4>
<div class="paragraph">
<p>It is possible to serve files and classpath resources easily using a <code>StaticContentSupport</code>. It can be created for any readable
directory or classpath context root and registered on some path in <code>Routing</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Routing.builder()
       .register(<span class="string"><span class="delimiter">&quot;</span><span class="content">/pictures</span><span class="delimiter">&quot;</span></span>, StaticContent.create(Paths.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">/some/WEB/pics</span><span class="delimiter">&quot;</span></span>)) <i class="conum" data-value="1"></i><b>(1)</b>
       .register(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>, StaticContent.builder(<span class="string"><span class="delimiter">&quot;</span><span class="content">/static-content</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
                                   .welcomeFile(<span class="string"><span class="delimiter">&quot;</span><span class="content">index.html</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="3"></i><b>(3)</b>
                                   .build());</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create new static content support to serve data from the file system (directory) a register it in <code>"/pictured"</code> context path.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Creates static content support to serve resources from the contextual <code>ClassLoader</code>. (The specific classloader can be also
defined.) The example uses a builder to provide more configuration values.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specifies the <em>welcome file-name</em>. The name is used if requested path points to the directory.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>StaticContentSupport</code> can be created using <code>create(&#8230;&#8203;)</code> factory methods or a <code>builder</code> which provides more configuration values
including <em>welcome file-name</em> and definition of media types for file-name extensions.</p>
</div>
<div class="paragraph">
<p>If there is no file for the request path then request procession is forwarded to the next handler. It means that it is possible
to combine dynamic handlers with <code>StaticContentSupport</code> a in very flexible but controlled way.</p>
</div>
</div>
<div class="sect3">
<h4 id="_web_server_jersey_support">2.1.10. Web Server Jersey Support</h4>
<div class="paragraph">
<p>The Web Server provides means to register a Jersey (JAX-RS) application at a particular <em>context root</em> by using <code>JerseySupport</code>
from the <code>io.j4c.webserver:j4c-webserver-jersey</code> module.</p>
</div>
<div class="sect4">
<h5 id="_prerequisites">Prerequisites</h5>
<div class="paragraph">
<p>Add a dependency on <code>io.j4c.webserver:j4c-webserver-jersey</code> artifact</p>
</div>
<div class="listingblock">
<div class="title">Webserver Jersey Dependency</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.j4c.webserver<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>j4c-webserver-jersey<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>0.1.0-b74<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_usage">Usage</h5>
<div class="paragraph">
<p>To register a <strong>Jersey</strong> application at a particular <em>context path</em>, use <code>JerseySupport</code> class and its <code>JerseySupport.Builder</code> builder.</p>
</div>
<div class="paragraph">
<p>It is possible to let <code>JerseySupport</code> register the JAX-RS resources directly</p>
</div>
<div class="listingblock">
<div class="title">Jersey (JAX-RS) <code>HelloWorld</code> resource</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloWorld</span> {

    <span class="annotation">@GET</span>
    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> Response hello() {
        <span class="keyword">return</span> Response.ok(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World!</span><span class="delimiter">&quot;</span></span>).build();
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Registering the <code>HelloWorld</code> resource</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Routing.builder()
       .register(<span class="string"><span class="delimiter">&quot;</span><span class="content">/jersey</span><span class="delimiter">&quot;</span></span>, <i class="conum" data-value="1"></i><b>(1)</b>
                 JerseySupport.builder()
                              .register(HelloWorld.class) <i class="conum" data-value="2"></i><b>(2)</b>
                              .build())
       .build();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Register the Jersey application at <code>/jersey</code> context root</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The Jersey <code>Application</code> stays hidden and consists of a single <code>HelloWorld</code> resource class</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As a result an HTTP GET request to <code>/jersey/hello</code> would yield into <code>Hello World!</code> response string.</p>
</div>
<div class="sect5">
<h6 id="_registering_jax_rs_application">Registering JAX-RS Application</h6>
<div class="paragraph">
<p>It is also possible to register the JAX-RS <code>Application</code> object</p>
</div>
<div class="listingblock">
<div class="title">Registering the <code>HelloWorld</code> resource</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Routing.builder()
       .register(<span class="string"><span class="delimiter">&quot;</span><span class="content">/jersey</span><span class="delimiter">&quot;</span></span>, <i class="conum" data-value="1"></i><b>(1)</b>
                 JerseySupport.builder(<span class="keyword">new</span> MyApplication()) <i class="conum" data-value="2"></i><b>(2)</b>
                              .build())
       .build();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Register the Jersey application at <code>/jersey</code> context root</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The Jersey <code>MyApplication</code> implements its own  stays hidden and consists of a single <code>HelloWorld</code> resource class</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_accessing_web_server_internals_from_jersey_application">Accessing Web Server internals from Jersey application</h6>
<div class="paragraph">
<p>To access Web Server internals, inject following beans into the Jersey managed beans:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>request scoped <code>ServerRequest</code></p>
</li>
<li>
<p>and/or request scoped <code>ServerResponse</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Injection of Web Server internal objects</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloWorld</span> {
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> ServerRequest request;

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> ServerResponse response;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_web_server_json_support">2.1.11. Web Server Json Support</h4>
<div class="paragraph">
<p>The Web Server comes with JSON-P support. When enabled, it is possible to send and receive JSON-P objects transparently.</p>
</div>
<div class="sect4">
<h5 id="_prerequisites_2">Prerequisites</h5>
<div class="paragraph">
<p>Add a dependency on <code>io.j4c.webserver:j4c-webserver-json</code> artifact</p>
</div>
<div class="listingblock">
<div class="title">Webserver JSON-P Dependency</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.j4c.webserver<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>j4c-webserver-json<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>0.1.0-b74<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_usage_2">Usage</h5>
<div class="listingblock">
<div class="title">Configuring <code>JsonSupport</code> and use it for reading and writing of entities</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Routing.builder()
       .register(JsonSupport.get()) <i class="conum" data-value="1"></i><b>(1)</b>
       .post(<span class="string"><span class="delimiter">&quot;</span><span class="content">/foo</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Handler</span>.of(JsonObject.class, (req, res, json) -&gt; { <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="comment">// business logic with the json object</span>
            res.send(jsonResultObject); <i class="conum" data-value="3"></i><b>(3)</b>
       }))
       .build();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Register the <code>JsonSupport</code> to enable transformation from and to <code>JsonStructure</code> objects</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Register a handler that receives a <code>JsonObject</code> on its input while all the error states are correctly handled</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Send back a <code>JsonObject</code> as a response payload</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_configuring_json_reader_writer_factories">Configuring Json Reader/Writer factories</h5>
<div class="paragraph">
<p>To configure JSON-P <code>JsonReaderFactory</code> and <code>JsonWriterFactory</code> that are used by the <code>JsonSupport</code> instance,
create the <code>JsonSupport</code> with a provided a <code>Map</code>:</p>
</div>
<div class="listingblock">
<div class="title">Creating <code>JsonSupport</code> with a</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">JsonSupport.create(<span class="predefined-type">Map</span>.of(JsonGenerator.PRETTY_PRINTING, <span class="predefined-constant">false</span>))</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_web_server_zipkin_support">2.1.12. Web Server Zipkin Support</h4>
<div class="paragraph">
<p>The Web Server comes with Zipkin support for OpenTracing. When enabled, the Web Server sends its
tracing events to Zipkin.</p>
</div>
<div class="sect4">
<h5 id="_prerequisites_3">Prerequisites</h5>
<div class="paragraph">
<p>Add a dependency on <code>io.j4c.webserver:j4c-webserver-zipkin</code> artifact</p>
</div>
<div class="listingblock">
<div class="title">Webserver Zipkin Support Dependency</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.j4c.webserver<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>j4c-webserver-zipkin<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>0.1.0-b74<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_usage_3">Usage</h5>
<div class="paragraph">
<p>To enable Zipkin integration, <code>Tracer</code> must be configured on the <code>ServerConfiguration.Builder</code>.</p>
</div>
<div class="listingblock">
<div class="title">Configuring OpenTracing <code>Tracer</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ServerConfiguration.builder()
                   .tracer(<span class="keyword">new</span> ZipkinTracerBuilder(<span class="string"><span class="delimiter">&quot;</span><span class="content">10.0.0.18</span><span class="delimiter">&quot;</span></span>, <i class="conum" data-value="1"></i><b>(1)</b>
                                                   <span class="string"><span class="delimiter">&quot;</span><span class="content">my-application</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
                                 .build())
                   .build()</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Send the tracing events to Zipkin running at <code>10.0.0.18:9411</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The name of the application to associate with the tracing events is <code>my-application</code></td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="img/webserver/zipkin.png" alt="Zipkin example">
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_2">2.2. Configuration</h3>
<div class="paragraph">
<p>Configuration component provides generic Java API to load and access configuration properties into
immutable <code>Config</code> object.</p>
</div>
<div class="paragraph">
<p>Common pattern to access configuration property is getting value of a concrete property key.
Config API exposes configuration values as a leaves in tree-like structure.
Configuration tree is traversable object which is evaluated when the value is requested.
Values can be retrieved as primitive (Java) data types or mapped to any Java object.
Each configuration node also allows registering a listener,
which will be notified when a value in the particular subtree is changed.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="img/config/overview.png" alt="Configuration Overview">
</div>
</div>
<div class="paragraph">
<p>The main API interface is <code>Config</code>. It covers following use-cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>accessors</strong> - Basic value type is <code>String</code>. The API provides accessor methods to map a value into
<code>boolean</code>, <code>int</code>, <code>long</code>, <code>double</code>. You can also choose to use <code>Optional</code> variants of accessor methods.</p>
</li>
<li>
<p><strong>mappers</strong> - The API also allows to map a single value or complex Config node into custom Java type.</p>
</li>
<li>
<p><strong>tree-like structure</strong> - It is possible to walk through a configuration structure.
The API supports also <em>object</em> and <em>list</em> configuration node types.</p>
</li>
<li>
<p><strong>watchers</strong> - It is possible to subscribe on configuration source(s) changes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Configuration <code>Builder</code> API allows to build new instance of <code>Config</code> and bootstrap it using appropriate SPI implementations.</p>
</div>
<div class="paragraph">
<p>Configuration component supports following SPI:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>config source</strong> - Allows to implement a custom mechanism to load configuration raw data from any source.</p>
</li>
<li>
<p><strong>config parser</strong> - Allows to provide a custom configuration format parser.</p>
</li>
<li>
<p><strong>config filter</strong> - Allows to filter configuration values before it will be accessible via Config API.</p>
</li>
<li>
<p><strong>config overrides</strong> - Allows overriding existing configuration values with other ones, which keys are specified by wildcards.</p>
</li>
<li>
<p><strong>config mapper provider</strong> - Allows to register a custom config mapper implementations
to map a configuration value or hierarchy to a Java type.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_configuration_installation">2.2.1. Configuration Installation</h4>
<div class="paragraph">
<p>Configuration is distributed as Java libraries that are supposed to be bundled together with client application.
Libraries are placed in Maven repository:</p>
</div>
<div class="listingblock">
<div class="title">Maven Repository</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;repositories&gt;</span>
    <span class="tag">&lt;repository&gt;</span>
        <span class="tag">&lt;id&gt;</span>j4c-release<span class="tag">&lt;/id&gt;</span>
        <span class="tag">&lt;url&gt;</span>http://j4c.uk.oracle.com/nexus/repository/j4c-release/<span class="tag">&lt;/url&gt;</span>
    <span class="tag">&lt;/repository&gt;</span>
<span class="tag">&lt;/repositories&gt;</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_coordinates_2">Coordinates</h5>
<div class="paragraph">
<p>Below are listed Maven coordinates for all Configuration modules.</p>
</div>
<div class="listingblock">
<div class="title">Define Config version in <code>pom.xml</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;properties&gt;</span>
    <span class="tag">&lt;j4c.config.version&gt;</span>0.1.0-b.189<span class="tag">&lt;/j4c.config.version&gt;</span>
<span class="tag">&lt;/properties&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Import Configuration BOM POM in <code>pom.xml</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencyManagement&gt;</span>
    <span class="tag">&lt;dependencies&gt;</span>
        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>io.j4c.config<span class="tag">&lt;/groupId&gt;</span>         <span class="comment">&lt;!-- &lt;1&gt; --&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>j4c-config-bom<span class="tag">&lt;/artifactId&gt;</span>  <span class="comment">&lt;!-- &lt;2&gt; --&gt;</span>
            <span class="tag">&lt;version&gt;</span>${j4c.config.version}<span class="tag">&lt;/version&gt;</span>
            <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>                         <span class="comment">&lt;!-- &lt;2&gt; --&gt;</span>
            <span class="tag">&lt;scope&gt;</span>import<span class="tag">&lt;/scope&gt;</span>                    <span class="comment">&lt;!-- &lt;3&gt; --&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span>
    <span class="tag">&lt;/dependencies&gt;</span>
<span class="tag">&lt;/dependencyManagement&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>All Configuration modules use same Maven group id <code>io.j4c.config</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Module <code>j4c-config-bom</code> is BOM POM that references all elementary Configuration modules.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Import BOM POM in an application&#8217;s <code>dependencyManagement</code>.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">All Maven Dependencies in <code>pom.xml</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>io.j4c.config<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>j4c-config<span class="tag">&lt;/artifactId&gt;</span>            <span class="comment">&lt;!-- &lt;1&gt; --&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>io.j4c.config<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>j4c-config-yaml<span class="tag">&lt;/artifactId&gt;</span>       <span class="comment">&lt;!-- &lt;2&gt; --&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>io.j4c.config<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>j4c-config-hocon<span class="tag">&lt;/artifactId&gt;</span>      <span class="comment">&lt;!-- &lt;3&gt; --&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>io.j4c.config<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>j4c-config-etcd<span class="tag">&lt;/artifactId&gt;</span>       <span class="comment">&lt;!-- &lt;4&gt; --&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>io.j4c.config<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>j4c-config-git<span class="tag">&lt;/artifactId&gt;</span>        <span class="comment">&lt;!-- &lt;5&gt; --&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Module <code>j4c-config</code> is Configuration core module.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Extension module <code>j4c-config-yaml</code> contains YAML config parser.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Extension module <code>j4c-config-hocon</code> contains HOCON and JSON config parser.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Extension module <code>j4c-config-etcd</code> contains Etcd config source.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Extension module <code>j4c-config-git</code> contains Git config source.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Or it is possible to use Config Bundle module that covers dependency on
core module (<code>j4c-config</code>) and all parser modules (<code>j4c-config-yaml</code>, <code>j4c-config-hocon</code>).</p>
</div>
<div class="listingblock">
<div class="title">Config Bundle dependency in <code>pom.xml</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>io.j4c.config<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>j4c-config-bundle<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>See below details about what module supports which functionality.</p>
</div>
</div>
<div class="sect4">
<h5 id="_requirements_2">Requirements</h5>
<div class="listingblock">
<div class="title">Java 9 Required</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">$ java -version
java version &quot;9-ea&quot;
. . .</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Config-Basics">2.2.2. Configuration Basics</h4>
<div class="sect4">
<h5 id="_coordinates_3">Coordinates</h5>
<div class="paragraph">
<p>Key functionality is covered by core module.</p>
</div>
<div class="listingblock">
<div class="title">Config Core Dependency in <code>pom.xml</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>io.j4c.config<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>j4c-config<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Config Core Dependency in <code>module-info.java</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">module myModule {
    requires io.j4c.config;
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Config-Basics-DefaultConfig">Access default configuration</h5>
<div class="paragraph">
<p>The easiest way to start with <a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/Config.html">Config</a> API is to create default instance:</p>
</div>
<div class="listingblock">
<div class="title">Create default <code>Config</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.create();</code></pre>
</div>
</div>
<div class="paragraph">
<p>It creates <code>Config</code> instance from following sources, in order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Environment variables;</p>
</li>
<li>
<p>Java System Properties;</p>
</li>
<li>
<p>One of following files on classpath, in order:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>application.yaml</code> - configuration file in YAML format <em>(support provided by extension module)</em></p>
</li>
<li>
<p><code>application.conf</code> - configuration file in HOCON format <em>(support provided by extension module)</em></p>
</li>
<li>
<p><code>application.json</code> - configuration file in JSON format <em>(support provided by extension module)</em></p>
</li>
<li>
<p><code>application.properties</code> - configuration file in Java Properties format</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>It uses the first and only one file that exists and there is a config parser available on an application classpath
that supports appropriate configuration file format.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Advanced feature of loading configuration from externalized list of sources (a.k.a. meta-configuration) by <code>Config.create()</code>
method is described bellow in <a href="#Config-Advanced-Config-MetaConfig">Create Config from meta-configuration</a> section.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Core module provides just Java Properties parser. We have following <code>application.properties</code> file
in root package on an application classpath.</p>
</div>
<div class="listingblock">
<div class="title">Default <code>application.properties</code> file</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">#
# Copyright (c) 2018 Oracle and/or its affiliates. All rights reserved.
#

greeting = Hello

web.debug = true
web.page-size = 20
web.ratio = 1.3

bl.initial-id = 10000000000</code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s time to use loaded configuration. Let&#8217;s start with the first <code>greeting</code> property.</p>
</div>
<div class="listingblock">
<div class="title">Access configuration property as <code>String</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> greeting = config
        .get(<span class="string"><span class="delimiter">&quot;</span><span class="content">greeting</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
        .asString();     <i class="conum" data-value="2"></i><b>(2)</b>

<span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">greeting: </span><span class="delimiter">&quot;</span></span> + greeting);
<span class="keyword">assert</span> greeting.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Method <code>get("greeting")</code> returns configuration node that represents <code>greeting</code> property.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Method <code>asString()</code> returns the property value as a <code>String</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And it is possible to override the value originally loaded from <code>application.properties</code> by system properties
or by environment variables (the top priority).</p>
</div>
<div class="listingblock">
<div class="title">Override <code>greeting</code> value by Java system property</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">java -Dgreeting=Hi -jar app-fat.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case <code>greeting: Hi</code> will be print to console.</p>
</div>
<div class="listingblock">
<div class="title">Override <code>greeting</code> value by environment variable</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">greeting=Ciao java -Dgreeting=Hi -jar app-fat.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>And in this case <code>greeting: Ciao</code> will be print to console, even Java system property is also used.</p>
</div>
</div>
<div class="sect4">
<h5 id="_working_with_different_types">Working with different types</h5>
<div class="paragraph">
<p>Not all configuration properties are type of <code>String</code>. <code>Config</code> API allows to get property value also as
<code>boolean</code>, <code>int</code>, <code>long</code> and <code>double</code>. And much more, see <a href="#Config-PropertyMapping">Property Mapping</a> section.</p>
</div>
<div class="listingblock">
<div class="title">Access configurarion property value as a different Java types</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">boolean</span> debug = config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">web.debug</span><span class="delimiter">&quot;</span></span>).asBoolean();   <i class="conum" data-value="1"></i><b>(1)</b>
<span class="keyword">assert</span> debug == <span class="predefined-constant">true</span>;

<span class="type">int</span> pageSize = config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">web.page-size</span><span class="delimiter">&quot;</span></span>).asInt();    <i class="conum" data-value="2"></i><b>(2)</b>
<span class="keyword">assert</span> pageSize == <span class="integer">20</span>;

<span class="type">double</span> ratio = config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">web.ratio</span><span class="delimiter">&quot;</span></span>).asDouble();     <i class="conum" data-value="3"></i><b>(3)</b>
<span class="keyword">assert</span> ratio == <span class="float">1.3</span>;

<span class="type">long</span> initialId = config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">bl.initial-id</span><span class="delimiter">&quot;</span></span>).asLong(); <i class="conum" data-value="4"></i><b>(4)</b>
<span class="keyword">assert</span> initialId == <span class="integer">10000000000L</span>;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Method <code>asBoolean()</code> returns <code>web.debug</code> property as a <code>boolean</code> value.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Method <code>asInt()</code> returns <code>web.page-size</code> property as a <code>int</code> value.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Method <code>asDouble()</code> returns <code>web.ratio</code> property as a <code>double</code> value.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Method <code>asLong()</code> returns <code>bl.initial-id</code> property as a <code>long</code> value.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_accessor_exceptions">Accessor Exceptions</h5>
<div class="paragraph">
<p>All mentioned accessor methods can throw two exceptions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/MissingValueException.html">MissingValueException</a> is thrown in case user invokes
<code>as*</code> method on property that has not set a value.</p>
</li>
<li>
<p><a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/ConfigMappingException.html">ConfigMappingException</a> is thrown in case it is not possible
to convert property into requested type.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Requesting wrong property type</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">greeting</span><span class="delimiter">&quot;</span></span>)
        .asInt();      <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Property <code>greeting</code> is free text that can not be mapped to <code>int</code>, method <code>asInt()</code> throws <code>ConfigMappingException</code>.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Accessing value on not set property</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">NOT-SET-PROPERTY</span><span class="delimiter">&quot;</span></span>)
        .asString();           <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Property <code>NOT-SET-PROPERTY</code> is missing, method <code>asString()</code> throws <code>MissingValueException</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_specifying_default_value">Specifying default value</h5>
<div class="paragraph">
<p>In case of missing values you can fix the <code>MissingValueException</code> issue programmatically by specifying default value
of appropriate property.</p>
</div>
<div class="listingblock">
<div class="title">Specify defaul value</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> notSet = config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">NOT-SET-PROPERTY</span><span class="delimiter">&quot;</span></span>)
        .asString(<span class="string"><span class="delimiter">&quot;</span><span class="content">def-val</span><span class="delimiter">&quot;</span></span>);                  <i class="conum" data-value="1"></i><b>(1)</b>

<span class="keyword">assert</span> notSet.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">def-val</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Method <code>asString</code> accepts a default value a a first parameter, i.e. <code>"def-val"</code> in our example.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Same pattern is applied on each <code>as*</code> accessor method.</p>
</div>
<div class="paragraph">
<p>Default value is ignored in case of existing property.</p>
</div>
<div class="listingblock">
<div class="title">Specify defaul value for existing property</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">greeting = config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">greeting</span><span class="delimiter">&quot;</span></span>)
        .asString(<span class="string"><span class="delimiter">&quot;</span><span class="content">Ahoj</span><span class="delimiter">&quot;</span></span>);        <i class="conum" data-value="1"></i><b>(1)</b>

<span class="keyword">assert</span> greeting.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span>);  <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We are specifying default value for <code>greeting</code> property.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>However the <code>greeting</code> property is loaded from <code>application.properties</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Config-ConfigSources">2.2.3. Configuration Config Sources</h4>
<div class="paragraph">
<p>Configuration can be loaded from different sources. In our previous examples we&#8217;ve worked
with default Configuration loaded from <code>application.properties</code> file on available on classpath.</p>
</div>
<div class="sect4">
<h5 id="_initialize_config_from_list_of_sources">Initialize Config from list of sources</h5>
<div class="paragraph">
<p>Following code explicitly loads <code>Config</code> from mentioned properties file.</p>
</div>
<div class="listingblock">
<div class="title">Initialize <code>Config</code> from <code>application.properties</code> file on classpath</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.from(                                <i class="conum" data-value="1"></i><b>(1)</b>
        ConfigSources.classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">application.properties</span><span class="delimiter">&quot;</span></span>)); <i class="conum" data-value="2"></i><b>(2)</b>

<span class="keyword">assert</span> config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">greeting</span><span class="delimiter">&quot;</span></span>).asString().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Factory method <code>Config.from(&#8230;&#8203;)</code> creates new <code>Config</code> instance loaded from specified configuration source(s).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Loads Java Properties file <code>application.properties</code> on classpath.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>ConfigSources</code> provides factory methods for built-in implementations of configuration sources.
It is possible to load configuration from file on <code>classpath</code>, from specified <code>file</code> path on filesystem, from HTTP <code>url</code> or
from files in specified <code>directory</code>. You can load configuration sources from Java system properties (<code>systemProperties</code>)
or environment variables (<code>environmentVariables</code>). These are used by <code>Config</code> factory methods and by <code>Config.Builder</code> by default.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="img/config/ConfigSources.png" alt="io.j4c.config.ConfigSources" width="192" height="324">
</div>
<div class="title">io.j4c.config.ConfigSources</div>
</div>
<div class="paragraph">
<p>See <a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/ConfigSources.html">ConfigSources</a> javadoc
or <a href="#Config-Advanced-ConfigSources">Advanced Config Source Topics</a> section for more information.</p>
</div>
<div class="paragraph">
<p>Method <code>ConfigSources.from(&#8230;&#8203;)</code> or <code>ConfigSources.from(List&lt;ConfigSource&gt;)</code> accepts ordered list of configuration sources.
Configuration sources found earlier in the list are considered to have a higher priority than the latter ones.
I.e., when resolving a value of a key, the sources are consulted in the order they have been provided and as soon as
the value is found in a configuration source, the value immediately is returned without consulting any of the remaining
configuration sources in the prioritized collection.</p>
</div>
<div class="listingblock">
<div class="title">Initialize <code>Config</code> from list of sources</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.from(
        ConfigSources.file(<span class="string"><span class="delimiter">&quot;</span><span class="content">conf/dev.properties</span><span class="delimiter">&quot;</span></span>)           <i class="conum" data-value="1"></i><b>(1)</b>
                .optional(),                                <i class="conum" data-value="2"></i><b>(2)</b>
        ConfigSources.file(<span class="string"><span class="delimiter">&quot;</span><span class="content">conf/config.properties</span><span class="delimiter">&quot;</span></span>)        <i class="conum" data-value="3"></i><b>(3)</b>
                .optional(),                                <i class="conum" data-value="4"></i><b>(4)</b>
        ConfigSources.classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">application.properties</span><span class="delimiter">&quot;</span></span>)); <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Loads configuration from file <code>conf/dev.properties</code> on filesystem.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>File <code>conf/dev.properties</code> is optional, i.e. if the file does not exist it does not fail.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Loads configuration from file <code>conf/config.properties</code> on filesystem.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>File <code>conf/config.properties</code> is optional, i.e. if the file does not exist it does not fail.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Loads configuration from file <code>application.properties</code> on classpath.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If all optional configuration files exist final configuration is initialized from ordered list of sources, top priority first:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Implicit environment variables (priority no. 1) - it is easy to run docker image with environment variables set;</p>
</li>
<li>
<p>Implicit Java system properties (priority no. 2) - it is easy to run java application with Java system properties set;</p>
</li>
<li>
<p>Filesystem file <code>conf/dev.properties</code> - suppose to be used during development to override application defaults;</p>
</li>
<li>
<p>Filesystem file <code>conf/config.properties</code> - suppose to be used in production as a deployment specific configuration,
e.g. as a Kubernetes ConfigMap.</p>
</li>
<li>
<p>Classpath file <code>application.properties</code> - an application defaults.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_use_builder_to_initialize_config">Use Builder to initialize Config</h5>
<div class="paragraph">
<p>As you probably already noticed, environment variables and Java system properties are always automatically used.
If you would like to create <code>Config</code> instance that does not use these configuration sources or you would like to change
order of sources you can use <a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/Config.Builder.html">Config.Builder</a>.</p>
</div>
<div class="paragraph">
<p>You can initialize <code>Config.Builder</code> with sources.</p>
</div>
<div class="listingblock">
<div class="title">Initialize <code>Builder</code> by <code>Config.withSources</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config.Builder builder = Config
        .withSources(file(<span class="string"><span class="delimiter">&quot;</span><span class="content">conf/dev.properties</span><span class="delimiter">&quot;</span></span>).optional(),    <i class="conum" data-value="1"></i><b>(1)</b>
                     file(<span class="string"><span class="delimiter">&quot;</span><span class="content">conf/config.properties</span><span class="delimiter">&quot;</span></span>).optional(), <i class="conum" data-value="1"></i><b>(1)</b>
                     classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">application.properties</span><span class="delimiter">&quot;</span></span>))       <i class="conum" data-value="1"></i><b>(1)</b>
        .disableEnvironmentVariablesSource()                    <i class="conum" data-value="2"></i><b>(2)</b>
        .disableSystemPropertiesSource();                       <i class="conum" data-value="3"></i><b>(3)</b>

Config config = builder.build();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>User static method imports to shorten code.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Implicit <em>environment variables</em> source (priority no. 1) is not used.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Implicit <em>Java system properties</em> source (priority no. 2) is not used.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Or you can create new empty <code>Builder</code> instance and specify list of sources by method <code>sources</code>.</p>
</div>
<div class="listingblock">
<div class="title">Create empty <code>Builder</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config.Builder builder = Config.builder()                  <i class="conum" data-value="1"></i><b>(1)</b>
        .sources(<span class="predefined-type">List</span>.of(                                  <i class="conum" data-value="2"></i><b>(2)</b>
                file(<span class="string"><span class="delimiter">&quot;</span><span class="content">conf/dev.properties</span><span class="delimiter">&quot;</span></span>).optional(),    <i class="conum" data-value="3"></i><b>(3)</b>
                ConfigSources.environmentVariables(),      <i class="conum" data-value="3"></i><b>(3)</b>
                ConfigSources.systemProperties(),          <i class="conum" data-value="3"></i><b>(3)</b>
                file(<span class="string"><span class="delimiter">&quot;</span><span class="content">conf/config.properties</span><span class="delimiter">&quot;</span></span>).optional(),
                classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">application.properties</span><span class="delimiter">&quot;</span></span>)))
        .disableEnvironmentVariablesSource()               <i class="conum" data-value="4"></i><b>(4)</b>
        .disableSystemPropertiesSource();                  <i class="conum" data-value="4"></i><b>(4)</b>

Config config = builder.build();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create new <code>Builder</code> instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Method <code>sources(&#8230;&#8203;)</code> accepts ordered list of sources, similar to <code>Config.from(&#8230;&#8203;)</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>File <code>conf/dev.properties</code> has top priority, even over environment variables and Java system properties.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Implicit <em>environment variables</em> and <em>Java system properties</em> sources are not used.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See <a href="#Config-Advanced-Config-Builder">Config Builder</a> section for more information about Config Builder API.</p>
</div>
</div>
<div class="sect4">
<h5 id="_other_configuration_sources">Other configuration sources</h5>
<div class="paragraph">
<p>It is possible to implement custom configuration source. See <a href="#Config-SPI-ConfigSource">ConfigSource SPI</a> for more information
how to implement custom <code>ConfigSource</code>.</p>
</div>
<div class="paragraph">
<p>Configuration distribution contains also following implementations of config sources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#Config-ModuleEtcd">Etcd</a> configuration source loads configuration from single Etcd key. It supports Etcd API v2 as well as v3.</p>
</li>
<li>
<p><a href="#Config-ModuleGit">Git</a> configuration source loads configuration from a file located in a git repository.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Config-HierarchicalFeatures">2.2.4. Configuration Hierarchical Features</h4>
<div class="paragraph">
<p><code>Config</code> API exposes configuration values as a leaves in tree-like structure.
Configuration tree is traversable object which is evaluated when the value is requested.</p>
</div>
<div class="sect4">
<h5 id="_configuration_node_types">Configuration Node Types</h5>
<div class="paragraph">
<p>Following example is in HOCON (Typesafe Config) format.
HOCON format is supported as an extension <a href="#Config-ModuleHocon">HOCON module</a>.</p>
</div>
<div class="listingblock">
<div class="title">HOCON <code>application.conf</code> file</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="hocon">#
# Copyright (c) 2017,2018 Oracle and/or its affiliates. All rights reserved.
#

app {
    greeting = &quot;Hello&quot;
    page-size = 20
    basic-range = [ -20, 20 ]
}
data {
    providers: [
        {
            name = &quot;Provider1&quot;
            class = &quot;this.is.my.Provider1&quot;
        },
        {
            name = &quot;Provider2&quot;
            class = &quot;this.is.my.Provider2&quot;
        }
    ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration contains:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>4 <span class="underline">object</span> (branch) nodes:</p>
<div class="ulist">
<ul>
<li>
<p><code>app</code></p>
</li>
<li>
<p><code>data</code></p>
</li>
<li>
<p>both values of <code>data.providers</code> list node</p>
</li>
</ul>
</div>
</li>
<li>
<p>2 <span class="underline">list</span> (array) nodes:</p>
<div class="ulist">
<ul>
<li>
<p><code>basic-range</code> - member of <code>app</code> object</p>
</li>
<li>
<p><code>providers</code> - member of <code>data</code> object</p>
</li>
</ul>
</div>
</li>
<li>
<p>8 <span class="underline">leaf value</span> nodes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The file is loaded into following node structure.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="img/config/application_conf-nodes.png" alt="Loaded Config Nodes structure">
</div>
<div class="title">Figure 1. Config Nodes structure of <code>application.conf</code> file</div>
</div>
<div class="paragraph">
<p>It is also shown that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There are following node types: <code>OBJECT</code>, <code>LIST</code> and <code>VALUE</code>.</p>
</li>
<li>
<p><strong>Root</strong> node&#8217;s <code>name</code> is <em>empty</em> as well as it&#8217;s <code>key</code>.</p>
</li>
<li>
<p>Node <code>key</code> is list of <em>key tokens</em> concatenated by &#8216;.&#8217; (dot character).</p>
</li>
<li>
<p><em>Key token</em> (node <strong>name</strong>), depending on node type, is:</p>
<div class="ulist">
<ul>
<li>
<p><em>object</em> member name</p>
</li>
<li>
<p><em>leaf</em> value name</p>
</li>
<li>
<p><em>list</em> element index</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>Config</code> provides methods to get <code>name</code>, <code>key</code> (<a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/Config.Key.html">Config.Key</a>)
and <code>type</code> (<a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/Config.Type.html">Config.Type</a>) of each configuration node.</p>
</div>
<div class="listingblock">
<div class="title">Root node type, name and key</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.withSources(classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">application.conf</span><span class="delimiter">&quot;</span></span>))
        .disableEnvironmentVariablesSource()
        .disableSystemPropertiesSource()
        .build();

<span class="keyword">assert</span> config.name().equals(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>);            <i class="conum" data-value="1"></i><b>(1)</b>
<span class="keyword">assert</span> config.key().name().equals(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>);      <i class="conum" data-value="1"></i><b>(1)</b>
<span class="keyword">assert</span> config.key().toString().equals(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>);  <i class="conum" data-value="2"></i><b>(2)</b>
<span class="keyword">assert</span> config.type() == Config.Type.OBJECT; <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Empty <em>name</em> of root node.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Empty <em>key</em> of root node.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>OBJECT</code> <em>type</em> of root node.</td>
</tr>
</table>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="img/config/Config_Key_Type.png" alt="Config (begining), Key, Type" width="411" height="144">
</div>
<div class="title">Config (begining), Key, Type</div>
</div>
<div class="paragraph">
<p>Configuration key <code>Config.Key</code> is returned by <code>Config.key()</code> method and represents unique fully-qualified pointer of each
configuration node.</p>
</div>
<div class="paragraph">
<p>It means each configuration node can be accessed calling <code>Config.get(key)</code> method.</p>
</div>
<div class="listingblock">
<div class="title">Get different type configuration nodes</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// app.greeting</span>
Config greeting = config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">app.greeting</span><span class="delimiter">&quot;</span></span>);               <i class="conum" data-value="1"></i><b>(1)</b>
<span class="keyword">assert</span> greeting.name().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">greeting</span><span class="delimiter">&quot;</span></span>);                  <i class="conum" data-value="2"></i><b>(2)</b>
<span class="keyword">assert</span> greeting.key().toString().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">app.greeting</span><span class="delimiter">&quot;</span></span>);    <i class="conum" data-value="3"></i><b>(3)</b>
<span class="keyword">assert</span> greeting.type() == Config.Type.VALUE;                <i class="conum" data-value="4"></i><b>(4)</b>

<span class="comment">// data.providers</span>
Config providers = config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">data.providers</span><span class="delimiter">&quot;</span></span>);            <i class="conum" data-value="5"></i><b>(5)</b>
<span class="keyword">assert</span> providers.name().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">providers</span><span class="delimiter">&quot;</span></span>);                <i class="conum" data-value="6"></i><b>(6)</b>
<span class="keyword">assert</span> providers.key().toString().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">data.providers</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="7"></i><b>(7)</b>
<span class="keyword">assert</span> providers.type() == Config.Type.LIST;                <i class="conum" data-value="8"></i><b>(8)</b>

<span class="comment">// data.providers.0</span>
Config prov1 = config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">data.providers.0</span><span class="delimiter">&quot;</span></span>);              <i class="conum" data-value="9"></i><b>(9)</b>
<span class="keyword">assert</span> prov1.name().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>);                            <i class="conum" data-value="10"></i><b>(10)</b>
<span class="keyword">assert</span> prov1.key().toString().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">data.providers.0</span><span class="delimiter">&quot;</span></span>);   <i class="conum" data-value="11"></i><b>(11)</b>
<span class="keyword">assert</span> prov1.type() == Config.Type.OBJECT;                  <i class="conum" data-value="12"></i><b>(12)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Gets <code>app.greeting</code> node. The node is again represented by <code>Config</code> API.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Name of <code>app.greeting</code> node is <code>greeting</code> as expected.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Key of <code>app.greeting</code> node is obvious.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Type of <code>app.greeting</code> node is leaf <code>VALUE</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Gets <code>data.providers</code> node.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Name of <code>data.providers</code> node is <code>providers</code> as expected.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Key of <code>data.providers</code> node is obvious.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Type of <code>data.providers</code> node is <code>LIST</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Gets <code>data.providers.0</code> node. It is the 1st element of <code>data.providers</code> list.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Name of <code>data.providers.0</code> node is <code>0</code>. It is node index of <code>data.providers</code> list.</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Key of <code>data.providers.0</code> node ends with index number (<code>0</code>) because it is 1st element of the list.</td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>Type of <code>data.providers.0</code> node is <code>OBJECT</code>.
The 1st element of <code>data.providers</code> list contains set of other properties.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_accessing_specified_config_node">Accessing specified Config node</h5>
<div class="paragraph">
<p>It is possible to repeat call of <code>Config.get(key)</code> method to get deeper in tree structure.</p>
</div>
<div class="listingblock">
<div class="title">Concatenate <code>get(key)</code> method calls</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// root node</span>
<span class="keyword">assert</span> config.get(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>) == config;                                             <i class="conum" data-value="1"></i><b>(1)</b>
<span class="comment">// always `data.providers.0.name` node</span>
Config provName1 = config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">data.providers.0.name</span><span class="delimiter">&quot;</span></span>);                      <i class="conum" data-value="2"></i><b>(2)</b>
Config provName2 = config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">data.providers.0</span><span class="delimiter">&quot;</span></span>).get(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>);               <i class="conum" data-value="2"></i><b>(2)</b>
Config provName3 = config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">data.providers</span><span class="delimiter">&quot;</span></span>).get(<span class="string"><span class="delimiter">&quot;</span><span class="content">0.name</span><span class="delimiter">&quot;</span></span>);               <i class="conum" data-value="2"></i><b>(2)</b>
Config provName4 = config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>).get(<span class="string"><span class="delimiter">&quot;</span><span class="content">providers.0</span><span class="delimiter">&quot;</span></span>).get(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>);        <i class="conum" data-value="2"></i><b>(2)</b>
Config provName5 = config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>).get(<span class="string"><span class="delimiter">&quot;</span><span class="content">providers</span><span class="delimiter">&quot;</span></span>).get(<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>).get(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Empty key means current node, i.e. root config node in this case.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>All <code>provName*</code> (<code>1</code>-<code>5</code>) instances references same configuration node.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Method <code>Config.get(key)</code> never throws exception even in case a user accesses non existing (missing) configuration node.
Existence or non-existence of configuration node is evaluated later by requesting property value, e.g. <code>config.asString()</code>.</p>
</div>
<div class="paragraph">
<p>It means it is possible to get <code>Config</code> instance that represents missing node.</p>
</div>
<div class="listingblock">
<div class="title">Get missing configuration node</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config missing = config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">wrong.unknown</span><span class="delimiter">&quot;</span></span>);            <i class="conum" data-value="1"></i><b>(1)</b>

<span class="keyword">assert</span> missing.name().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">unknown</span><span class="delimiter">&quot;</span></span>);                 <i class="conum" data-value="2"></i><b>(2)</b>
<span class="keyword">assert</span> missing.key().toString().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">wrong.unknown</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="2"></i><b>(2)</b>
<span class="keyword">assert</span> missing.type() == Config.Type.MISSING;            <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Getting missing configuration node, does not cause any exception throw.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Node <code>key</code> and <code>name</code> as expected. There is no difference to existing nodes.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Node <code>type</code> is <code>MISSING</code>.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Accessing value on missing node</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">try</span> {
    config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">wrong.unknown</span><span class="delimiter">&quot;</span></span>)
            .asString();             <i class="conum" data-value="1"></i><b>(1)</b>
} <span class="keyword">catch</span> (MissingValueException ex) { <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="comment">//EXPECTED</span>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Method <code>Config.asString()</code> invoked on <code>MISSING</code> node throws <code>MissingValueException</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_other_hierarchical_methods">Other hierarchical methods</h5>
<div class="paragraph">
<p><code>Config</code> API provides set of methods to react on different node types.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="img/config/Config-hierarchical.png" alt="Config hierarchical methods" width="292" height="280">
</div>
<div class="title">Config hierarchical methods</div>
</div>
<div class="paragraph">
<p>Let&#8217;s examine if configuration node exists or is leaf node.</p>
</div>
<div class="listingblock">
<div class="title">Checking type of Config node</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// exists</span>
<span class="keyword">assert</span> config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">wrong.unknown</span><span class="delimiter">&quot;</span></span>).exists()         == <span class="predefined-constant">false</span>;                   <i class="conum" data-value="1"></i><b>(1)</b>
<span class="keyword">assert</span> config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">data.providers.0</span><span class="delimiter">&quot;</span></span>).exists()      == <span class="predefined-constant">true</span>;                    <i class="conum" data-value="2"></i><b>(2)</b>
<span class="keyword">assert</span> config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">data.providers.0.name</span><span class="delimiter">&quot;</span></span>).exists() == <span class="predefined-constant">true</span>;                    <i class="conum" data-value="2"></i><b>(2)</b>

<span class="comment">// isLeaf</span>
<span class="keyword">assert</span> config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">wrong.unknown</span><span class="delimiter">&quot;</span></span>).isLeaf()         == <span class="predefined-constant">false</span>;                   <i class="conum" data-value="3"></i><b>(3)</b>
<span class="keyword">assert</span> config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">data.providers.0</span><span class="delimiter">&quot;</span></span>).isLeaf()      == <span class="predefined-constant">false</span>;                   <i class="conum" data-value="4"></i><b>(4)</b>
<span class="keyword">assert</span> config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">data.providers.0.name</span><span class="delimiter">&quot;</span></span>).isLeaf() == <span class="predefined-constant">true</span>;                    <i class="conum" data-value="5"></i><b>(5)</b>

<span class="comment">// ifExists</span>
config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">wrong.unknown</span><span class="delimiter">&quot;</span></span>)
        .ifExists(node -&gt; <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">NOT INVOKED</span><span class="delimiter">&quot;</span></span>));                   <i class="conum" data-value="6"></i><b>(6)</b>
config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">data.providers.0.name</span><span class="delimiter">&quot;</span></span>)
        .ifExists(node -&gt; <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Name: </span><span class="delimiter">&quot;</span></span> + node.asString()));      <i class="conum" data-value="7"></i><b>(7)</b>

<span class="comment">// ifExistsOrElse</span>
config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">wrong.unknown</span><span class="delimiter">&quot;</span></span>)
        .ifExistsOrElse(node -&gt; <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">NOT INVOKED</span><span class="delimiter">&quot;</span></span>),
                        () -&gt; <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">MISSING 'wrong.unknown'</span><span class="delimiter">&quot;</span></span>));   <i class="conum" data-value="8"></i><b>(8)</b>
config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">data.providers.0.name</span><span class="delimiter">&quot;</span></span>)
        .ifExistsOrElse(node -&gt; <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Name: </span><span class="delimiter">&quot;</span></span> + node.asString()),
                        () -&gt; <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">NOT INVOKED</span><span class="delimiter">&quot;</span></span>));               <i class="conum" data-value="9"></i><b>(9)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><em>Missing</em> node does not exist.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><em>Existing</em> (object, list or value) nodes exist.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><em>Missing</em> node is not leaf node.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><em>Object</em> (or <em>list</em>) nodes are not leaf nodes.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><em>Value</em> node is leaf node.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><code>Consumer&lt;Config&gt;</code> parameter of <code>Config.ifExists</code> method is not invoked on <em>missing</em> node.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Invoked on <em>existing</em> node prints <code>Name: Provider1</code> to console.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The second <code>Runnable</code> parameter of <code>Config.ifExistsOrElse</code> method is invoked on <em>missing</em> node
and prints <code>MISSING 'wrong.unknown'</code> to console.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Again, invoked on <em>existing</em> node prints <code>Name: Provider1</code> to console.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Property <code>app.basic-range</code> is list of primitive values. It is easy to get at as list of <code>String</code>-s.</p>
</div>
<div class="listingblock">
<div class="title">Get property as list of <code>String</code>-s</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; basicRanges = config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">app.basic-range</span><span class="delimiter">&quot;</span></span>)
        .asStringList();                                 <i class="conum" data-value="1"></i><b>(1)</b>
<span class="keyword">assert</span> basicRanges.get(<span class="integer">0</span>).equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">-20</span><span class="delimiter">&quot;</span></span>);                 <i class="conum" data-value="2"></i><b>(2)</b>
<span class="keyword">assert</span> basicRanges.get(<span class="integer">1</span>).equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span>);                  <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Gets <code>app.basic-range</code> property as <code>List</code> of <code>String</code>-s.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>List contains elementary values: <code>"-10"</code> and <code>"10"</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Example shows how to get list of <code>String</code>-s even originally values are integers.
See <a href="#Config-PropertyMapping">Property Mapping</a> section for details how to retrieve property value in different types.</p>
</div>
<div class="paragraph">
<p>Another option how access configuration nodes is to list children nodes.</p>
</div>
<div class="listingblock">
<div class="title">List children nodes on <em>object</em> node</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; appNodeNames = config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">app</span><span class="delimiter">&quot;</span></span>)
        .asNodeList()                             <i class="conum" data-value="1"></i><b>(1)</b>
        .stream().map(Config::name).sorted()      <i class="conum" data-value="2"></i><b>(2)</b>
        .collect(Collectors.toList());            <i class="conum" data-value="2"></i><b>(2)</b>

<span class="keyword">assert</span> appNodeNames.get(<span class="integer">0</span>).equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">basic-range</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="3"></i><b>(3)</b>
<span class="keyword">assert</span> appNodeNames.get(<span class="integer">1</span>).equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">greeting</span><span class="delimiter">&quot;</span></span>);    <i class="conum" data-value="3"></i><b>(3)</b>
<span class="keyword">assert</span> appNodeNames.get(<span class="integer">2</span>).equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">page-size</span><span class="delimiter">&quot;</span></span>);   <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get children nodes of <code>app</code> <em>object</em> node as a <code>List</code> of <code>Config</code>-s.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Via Java <code>Stream</code> API collect all children names.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>List contains children names: <code>basic-range</code>, <code>greeting</code> and <code>page-size</code>.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">List children nodes on <em>list</em> node</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;Config&gt; providers = config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">data.providers</span><span class="delimiter">&quot;</span></span>)
        .asNodeList();                                               <i class="conum" data-value="1"></i><b>(1)</b>

<span class="keyword">assert</span> providers.get(<span class="integer">0</span>).key().toString().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">data.providers.0</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="2"></i><b>(2)</b>
<span class="keyword">assert</span> providers.get(<span class="integer">1</span>).key().toString().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">data.providers.1</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get children nodes of <code>data.providers</code> <em>list</em> node as a <code>List</code> of <code>Config</code>-s.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>List contains children nodes, <code>data.providers.0</code> and <code>data.providers.1</code> keys.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And the last option is iterative deepening depth-first search.
Method <code>traverse()</code> returns a stream of all sub-nodes of current configuration node.
Depending on structure of loaded configuration it returns mix of object, list or leaf value nodes.</p>
</div>
<div class="listingblock">
<div class="title">Traverse from <em>list</em> node</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">data.providers</span><span class="delimiter">&quot;</span></span>)
        .traverse()                                                             <i class="conum" data-value="1"></i><b>(1)</b>
        .forEach(node -&gt; <span class="predefined-type">System</span>.out.println(node.type() + <span class="string"><span class="delimiter">&quot;</span><span class="content"> </span><span class="char">\t</span><span class="delimiter">&quot;</span></span> + node.key())); <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Visit all sub-nodes of <code>data.providers</code> <em>list</em> node.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Prints out following list of nodes (type and key):</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>OBJECT 	data.providers.0
VALUE 	data.providers.0.name
VALUE 	data.providers.0.class
OBJECT 	data.providers.1
VALUE 	data.providers.1.name
VALUE 	data.providers.1.class</pre>
</div>
</div>
<div class="paragraph">
<p>Traversing through each node can be stopped by specified <code>predicate</code> with method <code>traverse(Predicate&lt;Config&gt;)</code>.</p>
</div>
<div class="listingblock">
<div class="title">Traverse <em>root</em> (<em>object</em>) node, skip whole <code>data</code> tree structure</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">config.traverse(node -&gt; !node.name().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>))                            <i class="conum" data-value="1"></i><b>(1)</b>
        .forEach(node -&gt; <span class="predefined-type">System</span>.out.println(node.type() + <span class="string"><span class="delimiter">&quot;</span><span class="content"> </span><span class="char">\t</span><span class="delimiter">&quot;</span></span> + node.key())); <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Visit all <em>root</em> sub-nodes, excluding whole <code>data</code> tree structure.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Prints out following list of nodes (type and key):</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>OBJECT 	app
VALUE 	app.page-size
VALUE 	app.greeting
LIST 	app.basic-range
VALUE 	app.basic-range.0
VALUE 	app.basic-range.1</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Config-PropertyMapping">2.2.5. Configuration Property Mapping</h4>
<div class="paragraph">
<p>In <a href="#Config-Basics">Basics</a> section it was shown that <code>Config</code> API allows to
get property value also as <code>boolean</code>, <code>int</code>, <code>long</code> and <code>double</code>.</p>
</div>
<div class="sect4">
<h5 id="_built_in_config_mappers">Built-in Config Mappers</h5>
<div class="paragraph">
<p>The <code>Config</code> API allows to map original <code>String</code> value into other Java types.</p>
</div>
<div class="paragraph">
<p>Following examples work again with <code>application.properties</code> used in <a href="#Config-Basics">Basics</a> section.</p>
</div>
<div class="listingblock">
<div class="title">Access <code>bl.initial-id</code> property value as a <code>BigDecimal</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">BigDecimal</span> initialId = config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">bl.initial-id</span><span class="delimiter">&quot;</span></span>)
        .as(<span class="predefined-type">BigDecimal</span>.class);                             <i class="conum" data-value="1"></i><b>(1)</b>

<span class="keyword">assert</span> initialId.equals(<span class="predefined-type">BigDecimal</span>.valueOf(<span class="integer">10000000000L</span>));</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get <code>bl.initial-id</code> property value as a <code>BigDecimal</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Method <code>T as(Class&lt;T&gt;)</code> accepts class of target Java object to be current Config node mapped to.
In case it is not possible to map Config node into requested type a <code>ConfigMappingException</code> is thrown.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 1. List of all types supported by built-in config mappers:</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.j4c.config.Config</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.io.File</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Boolean</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Byte</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Character</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Class</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Double</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Float</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Integer</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Long</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Short</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.String</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.math.BigDecimal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.math.BigInteger</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.net.URI</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.net.URL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.nio.charset.Charset</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.nio.file.Path</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.time.Duration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.time.Instant</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.time.LocalDate</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.time.LocalDateTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.time.LocalTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.time.OffsetDateTime</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.time.OffsetTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.time.Period</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.time.ZoneId</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.time.ZoneOffset</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.time.ZonedDateTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Calendar</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Date</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.GregorianCalendar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Map</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.OptionalDouble</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.OptionalInt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.OptionalLong</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Properties</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.SimpleTimeZone</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.TimeZone</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.UUID</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.regex.Pattern</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Mentioned mappers are implemented by <a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/ConfigMappers.html">ConfigMappers</a> helper class.</p>
</div>
</div>
<div class="sect4">
<h5 id="_custom_config_mapper">Custom Config Mapper</h5>
<div class="paragraph">
<p>Another option to map original <code>String</code> value into Java type is to implement custom Config Mapper.</p>
</div>
<div class="listingblock">
<div class="title">Access <code>bl.initial-id</code> property value as a <code>BigDecimal</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">int</span> debug = config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">web.debug</span><span class="delimiter">&quot;</span></span>)
        .map((<span class="predefined-type">String</span> value) -&gt; value.equalsIgnoreCase(<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>) ? <span class="integer">1</span> : <span class="integer">0</span>); <i class="conum" data-value="1"></i><b>(1)</b>

<span class="keyword">assert</span> debug == <span class="integer">1</span>;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get <code>web.debug</code> property value as an <code>int</code>. (Value <code>"true"</code> is mapped to <code>1</code> otherwise to <code>0</code>.)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>Config</code> method <code>T map(Function&lt;String, T&gt; mapper)</code> accepts <code>Function</code> to map <code>String</code> value to target Java object.</p>
</div>
<div class="paragraph">
<p>It is even possible to provide complex mapper that converts <code>Config</code> node to target Java object.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say we want to load <code>web</code> properties into <code>WebConfig</code> class.</p>
</div>
<div class="listingblock">
<div class="title">Java bean to load <code>web</code> propeties into</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">WebConfig</span> {
    <span class="directive">private</span> <span class="type">boolean</span> debug;
    <span class="directive">private</span> <span class="type">int</span> pageSize;
    <span class="directive">private</span> <span class="type">double</span> ratio;

    <span class="directive">private</span> WebConfig(<span class="type">boolean</span> debug, <span class="type">int</span> pageSize, <span class="type">double</span> ratio) { <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="local-variable">this</span>.debug = debug;
        <span class="local-variable">this</span>.pageSize = pageSize;
        <span class="local-variable">this</span>.ratio = ratio;
    }

    <span class="directive">public</span> <span class="type">boolean</span> isDebug() {
        <span class="keyword">return</span> debug;
    }

    <span class="directive">public</span> <span class="type">int</span> getPageSize() {
        <span class="keyword">return</span> pageSize;
    }

    <span class="directive">public</span> <span class="type">double</span> getRatio() {
        <span class="keyword">return</span> ratio;
    }

    <span class="directive">public</span> <span class="directive">static</span> WebConfig from(Config config) {                  <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="keyword">return</span> <span class="keyword">new</span> WebConfig(config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">debug</span><span class="delimiter">&quot;</span></span>)
                                     .asBoolean(<span class="predefined-constant">false</span>),            <i class="conum" data-value="3"></i><b>(3)</b>
                             config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">page-size</span><span class="delimiter">&quot;</span></span>)
                                     .asInt(<span class="integer">10</span>),                   <i class="conum" data-value="4"></i><b>(4)</b>
                             config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">ratio</span><span class="delimiter">&quot;</span></span>)
                                     .asDouble(<span class="float">1.0</span>));              <i class="conum" data-value="5"></i><b>(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>WebConfig</code> has private constructor.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>And provides factory method <code>from</code> to create new instance from Config node.
It is expected it is already <code>web</code> node. It does not need to specify <code>web.</code> prefix on subsequent <code>get(key)</code> calls.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Get <code>debug</code> as <code>boolean</code> with specified default <code>false</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Get <code>page-size</code> as <code>int</code> with specified default <code>10</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Get <code>ratio</code> as <code>double</code> with specified default <code>1.0</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The factory method <code>WebConfig from(Config)</code> that creates new instance of <code>WebConfig</code> class from specified <code>web</code> Config node
can be used as a <a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/ConfigMapper.html">ConfigMapper</a>.</p>
</div>
<div class="listingblock">
<div class="title">Map <code>web</code> config node into <code>WebConfig</code> class</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">WebConfig web = config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">web</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
        .map(WebConfig::from);    <i class="conum" data-value="2"></i><b>(2)</b>

<span class="keyword">assert</span> web.isDebug() == <span class="predefined-constant">true</span>;     <i class="conum" data-value="3"></i><b>(3)</b>
<span class="keyword">assert</span> web.getPageSize() == <span class="integer">20</span>;   <i class="conum" data-value="3"></i><b>(3)</b>
<span class="keyword">assert</span> web.getRatio() == <span class="float">1.3</span>;     <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get just <code>web</code> sub-node to be mapped into <code>WebConfig</code> class.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Map <code>web</code> node into <code>WebConfig</code> instance using factory method <code>WebConfig.from(Config)</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Default values are overwritten by values from <code>application.properties</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>Config</code> method <code>T map(ConfigMapper&lt;T&gt; mapper)</code> accepts <code>ConfigMapper</code> to map <code>Config</code> node to target Java object.</p>
</div>
</div>
<div class="sect4">
<h5 id="_registering_config_mapper">Registering Config Mapper</h5>
<div class="paragraph">
<p>It is possible to register prepared Config Mapper by <code>Config.Builder</code> to be used always and available for <code>T as(Class&lt;T&gt;)</code> method
same way as built-in mappers.</p>
</div>
<div class="listingblock">
<div class="title">Map <code>web</code> config node into <code>WebConfig</code> class</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.withSources(classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">application.properties</span><span class="delimiter">&quot;</span></span>))
        .addMapper(WebConfig.class, WebConfig::from)                    <i class="conum" data-value="1"></i><b>(1)</b>
        .build();

WebConfig web = config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">web</span><span class="delimiter">&quot;</span></span>)
        .as(WebConfig.class);                                           <i class="conum" data-value="2"></i><b>(2)</b>

<span class="keyword">assert</span> web.isDebug() == <span class="predefined-constant">true</span>;
<span class="keyword">assert</span> web.getPageSize() == <span class="integer">20</span>;
<span class="keyword">assert</span> web.getRatio() == <span class="float">1.3</span>;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Register custom <code>WebConfig</code> class mapper.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Requesting <code>web</code> node as <code>WebConfig</code> instance transparently invokes registered mapper.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="Config-PropertyMapping-Generic">Implicit Custom Config Mapper</h5>
<div class="paragraph">
<p>If developer of Java bean fulfills one of following rules it is not necessary to explicitly register custom mapper.</p>
</div>
<div class="paragraph">
<p>It uses Java reflection API to find public constructor or public static method to construct bean instance from config node:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>a static method named <code>from</code> with a single <code>Config</code> argument that returns an instance of the bean.</p>
</li>
<li>
<p>a constructor that accepts a single <code>Config</code> argument.</p>
</li>
<li>
<p>a static method named <code>valueOf</code> with a single <code>Config</code> argument that returns an instance of the bean.</p>
</li>
<li>
<p>a static method named <code>fromConfig</code> with a single <code>Config</code> argument that returns an instance of the bean.</p>
</li>
<li>
<p>a static method named <code>from</code> with a single <code>String</code> argument that returns an instance of the bean.</p>
</li>
<li>
<p>a constructor that accepts a single <code>String</code> argument.</p>
</li>
<li>
<p>a static method named <code>valueOf</code> with a single <code>String</code> argument that returns an instance of the bean.</p>
</li>
<li>
<p>a static method named <code>fromString</code> with a single <code>String</code> argument that returns an instance of the bean.</p>
</li>
<li>
<p>a static method <code>builder()</code> that creates instance of a builder class.
Generic JavaBean deserialization is applied on the builder instance using config sub-nodes.
Builder has <code>build()</code> method to create new instance of a bean.</p>
</li>
<li>
<p>a factory method <code>from(&#8230;&#8203;)</code> with parameters (loaded from config sub-nodes) creates new instance of a bean.</p>
</li>
<li>
<p>a <em>factory</em> constructor with parameters (loaded from config sub-nodes).</p>
</li>
<li>
<p>a no-parameter constructor to create new instance of type and apply recursively same mapping behaviour
described above on each JavaBean property of such object,
a.k.a. <a href="#Config-PropertyMapping-Deserialization">JavaBean deserialization</a>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It means that in out <code>WebConfig</code> mapper example it is not necessary to register custom mapper.</p>
</div>
<div class="listingblock">
<div class="title">Implicit custom <code>WebConfig</code> mapper is used</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.from(classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">application.properties</span><span class="delimiter">&quot;</span></span>));

WebConfig web = config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">web</span><span class="delimiter">&quot;</span></span>)
        .as(WebConfig.class);                                     <i class="conum" data-value="1"></i><b>(1)</b>

<span class="keyword">assert</span> web.isDebug() == <span class="predefined-constant">true</span>;
<span class="keyword">assert</span> web.getPageSize() == <span class="integer">20</span>;
<span class="keyword">assert</span> web.getRatio() == <span class="float">1.3</span>;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Implicit <code>WebConfig</code> mapper is used. Because <code>WebConfig</code> contains
<em>a static method named <code>from</code> with a single <code>Config</code> argument that returns an instance of the bean</em> (option no. 1).</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="Config-PropertyMapping-Deserialization">JavaBean Deserialization</h6>
<div class="paragraph">
<p>Config support 3 different generic approaches how to map config node structure into JavaBean instance.</p>
</div>
<div class="sect6">
<h7 id="_generic_support">Generic Support</h7>
<div class="paragraph">
<p>Generic Config to JavaBean deserialization works just with class with no-parameter constructor.
Each JavaBean property value is then set by value mapped from appropriate configuration node.
Each public setter method and public non-final fields are taken as JavaBean properties that will be set.
The deserialization process is applied recursively on each property.</p>
</div>
<div class="paragraph">
<p>Annotation <a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/Config.Value.html">Config.Value</a> can be used to
customize behaviour of JavaBean deserialization support.
Use <a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/Config.Transient.html">Config.Transient</a>
annotation to exclude setter or field from set of processed JavaBean properties.</p>
</div>
<div class="paragraph">
<p>By default JavaBean property name is used as config key to get configuration node.
The config key can be customized by <code>key</code> attribute of <code>@Value</code> annotation.
Use the annotation on public setter or public field.
Annotation used on method has precedence over annotation used on field. The second one is ignored.</p>
</div>
<div class="paragraph">
<p>If the appropriate configuration node does not exist it is possible to specify default value
using <code>@Value</code> annotation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>withDefaultSupplier</code> attribute - instance of supplier class is used to get default value of target type; or</p>
</li>
<li>
<p><code>withDefault</code> attribute - default value in <code>String</code> form that will be mapped to target type
by associated <code>ConfigMapper</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In case of both <em>default</em> attributes are set the <code>withDefaultSupplier</code> is used and the <code>withDefault</code> is ignored.</p>
</div>
<div class="paragraph">
<p>The <code>@Transient</code> annotation can not be applied on same JavaBean property together with <code>@Value</code> annotation.</p>
</div>
<div class="listingblock">
<div class="title">Java bean to load <code>app</code> propeties into via setters</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {
    <span class="directive">private</span> Instant timestamp;
    <span class="directive">private</span> <span class="predefined-type">String</span> greeting;
    <span class="directive">private</span> <span class="type">int</span> pageSize;
    <span class="directive">private</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; basicRange;

    <span class="directive">public</span> AppConfig() {                                          <i class="conum" data-value="1"></i><b>(1)</b>
    }

    <span class="directive">public</span> <span class="type">void</span> setGreeting(<span class="predefined-type">String</span> greeting) {                    <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="local-variable">this</span>.greeting = greeting;
    }
    <span class="directive">public</span> <span class="predefined-type">String</span> getGreeting() {
        <span class="keyword">return</span> greeting;
    }

    <span class="annotation">@Config</span>.Value(key = <span class="string"><span class="delimiter">&quot;</span><span class="content">page-size</span><span class="delimiter">&quot;</span></span>,                              <i class="conum" data-value="3"></i><b>(3)</b>
                  withDefault = <span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span>)                             <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="directive">public</span> <span class="type">void</span> setPageSize(<span class="type">int</span> pageSize) {
        <span class="local-variable">this</span>.pageSize = pageSize;
    }
    <span class="directive">public</span> <span class="type">int</span> getPageSize() {
        <span class="keyword">return</span> pageSize;
    }

    <span class="annotation">@Config</span>.Value(key = <span class="string"><span class="delimiter">&quot;</span><span class="content">basic-range</span><span class="delimiter">&quot;</span></span>,                            <i class="conum" data-value="5"></i><b>(5)</b>
                  withDefaultSupplier = BasicRangeSupplier.class) <i class="conum" data-value="6"></i><b>(6)</b>
    <span class="directive">public</span> <span class="type">void</span> setBasicRange(<span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; basicRange) {
        <span class="local-variable">this</span>.basicRange = basicRange;
    }
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; getBasicRange() {
        <span class="keyword">return</span> basicRange;
    }

    <span class="annotation">@Config</span>.Transient                                             <i class="conum" data-value="7"></i><b>(7)</b>
    <span class="directive">public</span> <span class="type">void</span> setTimestamp(Instant timestamp) {
        <span class="local-variable">this</span>.timestamp = timestamp;
    }
    <span class="directive">public</span> Instant getTimestamp() {
        <span class="keyword">return</span> timestamp;
    }

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">BasicRangeSupplier</span>
            <span class="directive">implements</span> Supplier&lt;<span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt;&gt; {                  <i class="conum" data-value="8"></i><b>(8)</b>
        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; get() {
            <span class="keyword">return</span> <span class="predefined-type">List</span>.of(-<span class="integer">10</span>, <span class="integer">10</span>);
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>JavaBean has public no-parameter constructor.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Property <code>greeting</code> is not customized. Will be set from config node with <code>greeting</code> key, if exists.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Property <code>pageSize</code> customizes key of config node to <code>page-size</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>If the config node does not exist, value <code>10</code> will be mapped to <code>int</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Property <code>basicRange</code> customizes key of config node to <code>basic-range</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>If the config node does not exist, <code>BasicRangeSupplier</code> instance will be used to get default value.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The <code>setTimestamp(Instant)</code> method is never called during deserialization,
even if <code>timestamp</code> configuration value is set.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td><code>BasicRangeSupplier</code> is used to supply <code>List&lt;Integer&gt;</code> value.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Example application loads <code>application.conf</code> file. Section <code>app</code> is loaded into <code>AppConfig</code> class.</p>
</div>
<div class="listingblock">
<div class="title">Map <code>app</code> config node into <code>AppConfig</code> class</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.from(classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">application.conf</span><span class="delimiter">&quot;</span></span>));

AppConfig app = config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">app</span><span class="delimiter">&quot;</span></span>)
        .as(AppConfig.class);                               <i class="conum" data-value="1"></i><b>(1)</b>

<span class="comment">//assert that all values are loaded from file</span>
<span class="keyword">assert</span> app.getGreeting().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span>);
<span class="keyword">assert</span> app.getPageSize() == <span class="integer">20</span>;
<span class="keyword">assert</span> app.getBasicRange().size() == <span class="integer">2</span>
        &amp;&amp; app.getBasicRange().get(<span class="integer">0</span>) == -<span class="integer">20</span>
        &amp;&amp; app.getBasicRange().get(<span class="integer">1</span>) == <span class="integer">20</span>;

<span class="comment">//assert that Transient property is not set</span>
<span class="keyword">assert</span> app.getTimestamp() == <span class="predefined-constant">null</span>;                          <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Config automatically deserialize the node to new <code>AppConfig</code> instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Transient property <code>timestamp</code> is not set during deserialization.</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="_builder_pattern_support">Builder Pattern Support</h7>
<div class="paragraph">
<p>The second option is <em>Builder pattern</em> support that is based on the first deserialization option, <em>Generic support</em>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>JavaBean contains public static <code>builder()</code> method that creates instance of any builder class.</p>
</li>
<li>
<p>Generic JavaBean deserialization is applied on the builder instance using config sub-nodes.
I.e. setter are invoked or public fields are set from configuration sub-nodes.
Similar to generic deserialization support a user can use <code>@Value</code> annotation to customize configuration sub-node key
and/or specify default value of a property.</p>
</li>
<li>
<p>The Builder has <code>build()</code> method to create new instance of the java bean.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Java bean to load <code>app</code> propeties into via <code>Builder</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {
    <span class="directive">private</span> <span class="predefined-type">String</span> greeting;
    <span class="directive">private</span> <span class="type">int</span> pageSize;
    <span class="directive">private</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; basicRange;

    <span class="directive">private</span> AppConfig(<span class="predefined-type">String</span> greeting, <span class="type">int</span> pageSize, <span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; basicRange) { <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="local-variable">this</span>.greeting = greeting;
        <span class="local-variable">this</span>.pageSize = pageSize;
        <span class="local-variable">this</span>.basicRange = basicRange;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getGreeting() {
        <span class="keyword">return</span> greeting;
    }

    <span class="directive">public</span> <span class="type">int</span> getPageSize() {
        <span class="keyword">return</span> pageSize;
    }

    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; getBasicRange() {
        <span class="keyword">return</span> basicRange;
    }

    <span class="directive">public</span> <span class="directive">static</span> Builder builder() {                                            <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="keyword">return</span> <span class="keyword">new</span> Builder();
    }

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">Builder</span> {                                                <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="directive">private</span> <span class="predefined-type">String</span> greeting;
        <span class="directive">private</span> <span class="type">int</span> pageSize;
        <span class="directive">private</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; basicRange;

        <span class="directive">private</span> Builder() {
        }

        <span class="directive">public</span> <span class="type">void</span> setGreeting(<span class="predefined-type">String</span> greeting) {                               <i class="conum" data-value="4"></i><b>(4)</b>
            <span class="local-variable">this</span>.greeting = greeting;
        }

        <span class="annotation">@Config</span>.Value(key = <span class="string"><span class="delimiter">&quot;</span><span class="content">page-size</span><span class="delimiter">&quot;</span></span>,
                      withDefault = <span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span>)
        <span class="directive">public</span> <span class="type">void</span> setPageSize(<span class="type">int</span> pageSize) {                                  <i class="conum" data-value="5"></i><b>(5)</b>
            <span class="local-variable">this</span>.pageSize = pageSize;
        }

        <span class="annotation">@Config</span>.Value(key = <span class="string"><span class="delimiter">&quot;</span><span class="content">basic-range</span><span class="delimiter">&quot;</span></span>,
                      withDefaultSupplier = BasicRangeSupplier.class)
        <span class="directive">public</span> <span class="type">void</span> setBasicRange(<span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; basicRange) {                    <i class="conum" data-value="6"></i><b>(6)</b>
            <span class="local-variable">this</span>.basicRange = basicRange;
        }

        <span class="directive">public</span> AppConfig build() {                                               <i class="conum" data-value="7"></i><b>(7)</b>
            <span class="keyword">return</span> <span class="keyword">new</span> AppConfig(greeting, pageSize, basicRange);
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A JavaBean constructor can be <code>private</code> because an instance is created from a Builder.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The JavaBean must contain <code>public static</code> method <code>builder()</code>.
It can return any class that has public method <code>build()</code> that returns instance of the JavaBean.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Builder can be any class with public setters or public non-final fields (see <em>Generic Support</em> section),
with public method <code>build()</code> that returns instance of the JavaBean.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Property <code>greeting</code> is not customized. Will be set from config node with <code>greeting</code> key, if exists.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Property <code>pageSize</code> customizes key of config node to <code>page-size</code>.
If the config node does not exist, value <code>10</code> will be mapped to <code>int</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Property <code>basicRange</code> customizes key of config node to <code>basic-range</code>.
If the config node does not exist, <code>BasicRangeSupplier</code> instance will be used to get default value.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>And finally, public method <code>build()</code> that creates new instance of <code>AppConfig</code>.</td>
</tr>
</table>
</div>
<hr>
<div class="paragraph">
<p>In case a JavaBean cannot provide <code>builder()</code> method it is possible to couple mapped type with <em>external</em> builder.</p>
</div>
<div class="listingblock">
<div class="title">Mapped type <code>IAppConfig</code> can be interface</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">IAppConfig</span> {
    <span class="predefined-type">String</span> getGreeting();
    <span class="type">int</span> getPageSize();
    <span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; getBasicRange();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mapped type <code>IAppConfig</code> has no connection to following <code>BuilderImpl</code>.</p>
</div>
<div class="listingblock">
<div class="title">External <code>BuilderImpl</code> with custom <code>AppConfigImpl</code> implementation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">BuilderImpl</span> {                                        <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">private</span> <span class="predefined-type">String</span> greeting;
    <span class="directive">private</span> <span class="type">int</span> pageSize;
    <span class="directive">private</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; basicRange;

    <span class="directive">public</span> BuilderImpl() {                                        <i class="conum" data-value="1"></i><b>(1)</b>
    }

    <span class="annotation">@Config</span>.Value(key = <span class="string"><span class="delimiter">&quot;</span><span class="content">greeting</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> BuilderImpl greeting(<span class="predefined-type">String</span> greeting) {                <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="local-variable">this</span>.greeting = greeting;
        <span class="keyword">return</span> <span class="local-variable">this</span>;
    }

    <span class="annotation">@Config</span>.Value(key = <span class="string"><span class="delimiter">&quot;</span><span class="content">page-size</span><span class="delimiter">&quot;</span></span>, withDefault = <span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> BuilderImpl pageSize(<span class="type">int</span> pageSize) {                   <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="local-variable">this</span>.pageSize = pageSize;
        <span class="keyword">return</span> <span class="local-variable">this</span>;
    }

    <span class="annotation">@Config</span>.Value(key = <span class="string"><span class="delimiter">&quot;</span><span class="content">basic-range</span><span class="delimiter">&quot;</span></span>,
                  withDefaultSupplier = BasicRangeSupplier.class)
    <span class="directive">public</span> BuilderImpl basicRange(<span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; basicRange) {     <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="local-variable">this</span>.basicRange = basicRange;
        <span class="keyword">return</span> <span class="local-variable">this</span>;
    }

    <span class="directive">public</span> IAppConfig build() {                                   <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="keyword">return</span> <span class="keyword">new</span> AppConfigImpl(greeting, pageSize, basicRange);
    }

    <span class="comment">/**
     * Private implementation provided by {@link BuilderImpl}.
     */</span>
    <span class="directive">private</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">AppConfigImpl</span> <span class="directive">implements</span> IAppConfig {    <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="directive">private</span> <span class="predefined-type">String</span> greeting;
        <span class="directive">private</span> <span class="type">int</span> pageSize;
        <span class="directive">private</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; basicRange;

        <span class="directive">private</span> AppConfigImpl(<span class="predefined-type">String</span> greeting,
                              <span class="type">int</span> pageSize,
                              <span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; basicRange) {
            <span class="local-variable">this</span>.greeting = greeting;
            <span class="local-variable">this</span>.pageSize = pageSize;
            <span class="local-variable">this</span>.basicRange = basicRange;
        }
        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">String</span> getGreeting() {
            <span class="keyword">return</span> greeting;
        }
        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">int</span> getPageSize() {
            <span class="keyword">return</span> pageSize;
        }
        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; getBasicRange() {
            <span class="keyword">return</span> basicRange;
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Class <code>BuilderImpl</code> must not be public API but must be public including public constructor
because it is instantiated by Config support.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Builder can contain even common <em>builder</em> methods (not usual setter, returns builder instance).
In such case, even <code>greeting</code> method needs to be annotated by <code>@Config.Value</code> to identify setter method.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Method <code>build()</code> returns <code>AppConfigImpl</code> instance, <code>IAppConfig</code> implementation.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Class <code>AppConfigImpl</code> can be private because it is instantiated by <code>BuilderImpl</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is then necessary to register <code>BuilderImpl</code> as a builder for building <code>IAppConfig</code> interface.</p>
</div>
<div class="listingblock">
<div class="title">Register <code>BuilderImpl</code> as <code>IAppConfig</code> mapper</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.withSources(classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">application.conf</span><span class="delimiter">&quot;</span></span>))
        .addMapper(IAppConfig.class,                                        <i class="conum" data-value="1"></i><b>(1)</b>
                   ConfigMappers.from(IAppConfig.class, BuilderImpl.class)) <i class="conum" data-value="2"></i><b>(2)</b>
        .build();

IAppConfig app = config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">app</span><span class="delimiter">&quot;</span></span>)
        .as(IAppConfig.class);                                              <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Programmatically register mapper for <code>IAppConfig</code> interface.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create config mapper for <em>`IAppConfig`</em> that is provided by <em>BuilderImpl</em>,
using method <code>ConfigMappers.from(type, builder)</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Requested <em>`IAppConfig`</em> interface instance is provided by registered <em>BuilderImpl</em>.</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="_factory_method_pattern_support">Factory Method Pattern Support</h7>
<div class="paragraph">
<p>The third option is <em>Factory method</em> pattern. A JavaBean contains <code>public static</code> method <code>from</code> with parameters
set from appropriate configuration sub-nodes. Related config key and/or default can be customized by <code>@Value</code> annotation.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is highly recommended to use <code>@Value</code> annotation on each parameter in this use-case.</p>
</div>
<div class="paragraph">
<p>It is not guarantied to access original parameter names. Usually it is <code>arg0</code>, <code>arg1</code>, etc.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Java bean to load <code>app</code> propeties into via factory method <code>from</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">AppConfig</span> {
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> greeting;
    <span class="directive">private</span> <span class="directive">final</span> <span class="type">int</span> pageSize;
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; basicRange;

    <span class="directive">private</span> AppConfig(<span class="predefined-type">String</span> greeting, <span class="type">int</span> pageSize, <span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; basicRange) { <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="local-variable">this</span>.greeting = greeting;
        <span class="local-variable">this</span>.pageSize = pageSize;
        <span class="local-variable">this</span>.basicRange = basicRange;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getGreeting() {
        <span class="keyword">return</span> greeting;
    }

    <span class="directive">public</span> <span class="type">int</span> getPageSize() {
        <span class="keyword">return</span> pageSize;
    }

    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; getBasicRange() {
        <span class="keyword">return</span> basicRange;
    }

    <span class="directive">public</span> <span class="directive">static</span> AppConfig from(                                                <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="annotation">@Config</span>.Value(key = <span class="string"><span class="delimiter">&quot;</span><span class="content">greeting</span><span class="delimiter">&quot;</span></span>)
                    <span class="predefined-type">String</span> greeting,                                             <i class="conum" data-value="3"></i><b>(3)</b>
            <span class="annotation">@Config</span>.Value(key = <span class="string"><span class="delimiter">&quot;</span><span class="content">page-size</span><span class="delimiter">&quot;</span></span>,
                          withDefault = <span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span>)
                    <span class="type">int</span> pageSize,                                                <i class="conum" data-value="4"></i><b>(4)</b>
            <span class="annotation">@Config</span>.Value(key = <span class="string"><span class="delimiter">&quot;</span><span class="content">basic-range</span><span class="delimiter">&quot;</span></span>,
                          withDefaultSupplier = BasicRangeSupplier.class)
                    <span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; basicRange) {                                  <i class="conum" data-value="5"></i><b>(5)</b>
        <span class="keyword">return</span> <span class="keyword">new</span> AppConfig(greeting, pageSize, basicRange);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A JavaBean constructor can be <code>private</code> because an instance is created from a factory method.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Factory method <code>from(&#8230;&#8203;)</code> that creates new instance of <code>AppConfig</code>
from parameters loaded from appropriate config sub-nodes.
It is recommended to use <code>@Value</code> on each parameter to at least specify config sub-node key.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Property <code>greeting</code> does not specify default value (just config node to <code>greeting</code>).
I.e. the property is <strong>mandatory</strong> and must be specified in configuration source.
Otherwise <code>ConfigMappingException</code> is thrown.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Property <code>pageSize</code> customizes key of config node to <code>page-size</code>.
If the config node does not exist, value <code>10</code> will be mapped to <code>int</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Property <code>basicRange</code> customizes key of config node to <code>basic-range</code>.
If the config node does not exist, <code>BasicRangeSupplier</code> instance will be used to get default value.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Same rule can be applied on public constructor with annotated parameters instead of static factory method <code>from(&#8230;&#8203;)</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Config-MutabilitySupport">2.2.6. Configuration Mutability Support</h4>
<div class="paragraph">
<p>Loaded <code>Config</code> instance is immutable. It is snapshot of data loaded from specified config sources at appropriate time.
Timestamp of <code>Config</code> instance is available by method <code>Config.timestamp()</code> (returns Java <code>Instance</code>).
It does not matter if any of specified config sources has changed since <code>Config</code> instance has been loaded.
Instance of <code>Config</code> has all data loaded in memory. Existing <code>Config</code> instance can not be influenced by future changes
in config sources.</p>
</div>
<div class="paragraph">
<p>Configuration API allows to listen on changes of configuration sources. <code>Config</code> instance can then listen on such changes.
And if a user wants to be notified about these changes it is possible to listen on <code>Config.changes</code>.
In such case user will receive new instance of <code>Config</code> that is loaded from same configuration source(s) as original <code>Config</code>
instance. (It uses identical <code>Config.Builder</code> setup as original <code>Config</code> instance was build from.)</p>
</div>
<div class="sect4">
<h5 id="_config_source_with_polling_strategy">Config source with Polling strategy</h5>
<div class="paragraph">
<p>Story starts on config source side. User need to specify how often or when to check if config source data has changed.
The logic is implemented by <a href="#Config-SPI-PollingStrategy">PollingStrategy SPI</a>.
Configuration core provides following built-in implementations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>regular(Duration interval)</code> - generic scheduled polling strategy with specified constant interval.</p>
</li>
<li>
<p><code>watch(Path watchedPath)</code> - filesystem specific polling strategy to watch specified path.
Can be used with <code>file</code> and <code>classpath</code> built-in config sources.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use <code>PollingStrategies</code> factory methods to initialize described polling strategies.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="img/config/PollingStrategies.png" alt="PollingStrategies API" width="180" height="105">
</div>
<div class="title">PollingStrategies API</div>
</div>
<div class="listingblock">
<div class="title">Initialize <code>Config</code> with specified <code>PollingStrategy</code> for each config source</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.from(
        ConfigSources.file(<span class="string"><span class="delimiter">&quot;</span><span class="content">conf/dev.properties</span><span class="delimiter">&quot;</span></span>)
                .pollingStrategy(PollingStrategies.regular(<span class="predefined-type">Duration</span>.ofSeconds(<span class="integer">2</span>))) <i class="conum" data-value="1"></i><b>(1)</b>
                .optional(),
        ConfigSources.file(<span class="string"><span class="delimiter">&quot;</span><span class="content">conf/config.properties</span><span class="delimiter">&quot;</span></span>)
                .pollingStrategy(PollingStrategies::watch)                         <i class="conum" data-value="2"></i><b>(2)</b>
                .optional(),
        ConfigSources.classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">application.properties</span><span class="delimiter">&quot;</span></span>)
                .pollingStrategy(PollingStrategies::nop));                         <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Optional <code>file</code> source <code>conf/dev.properties</code> will be checked for changes every <code>2</code> seconds.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Optional <code>file</code> source <code>conf/config.properties</code> will be watched by Java <code>WatchService</code> for changes on filesystem.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>And <code>classpath</code> resource <code>application.properties</code> will not be checked for changes.
I.e. even if <code>application.properties</code> has changed it will not be reloaded from.
<code>PollingStrategies.nop()</code> polling strategy is default and must not be specified.</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Be aware of used polling strategies. Config listeners are based on it.
If there is no (<code>nop</code>) polling strategy subscriber will never receive any event!</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Instance <code>config</code> is ready to accept subscribes to be notified about changes.</p>
</div>
</div>
<div class="sect4">
<h5 id="_config_changes">Config Changes</h5>
<div class="paragraph">
<p>Config change events are fired via <code>Flow.Publisher&lt;Config&gt;</code> API provided by <code>Config.changes()</code> method.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="img/config/Config-changes.png" alt="Config Changes API" width="446" height="139">
</div>
<div class="title">Config Changes API</div>
</div>
<div class="paragraph">
<p>Subscribe custom implementation of <code>Flow.Subscriber&lt;Config&gt;</code>.</p>
</div>
<div class="listingblock">
<div class="title">Subscribe on <code>greeting</code> property changes</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">greeting</span><span class="delimiter">&quot;</span></span>)                                                             <i class="conum" data-value="1"></i><b>(1)</b>
        .changes()                                                                 <i class="conum" data-value="2"></i><b>(2)</b>
        .subscribe(<span class="keyword">new</span> Flow.Subscriber&lt;&gt;() {                                       <i class="conum" data-value="3"></i><b>(3)</b>
            Flow.Subscription subscription;

            <span class="annotation">@Override</span>
            <span class="directive">public</span> <span class="type">void</span> onSubscribe(Flow.Subscription subscription) {              <i class="conum" data-value="4"></i><b>(4)</b>
                <span class="local-variable">this</span>.subscription = subscription;
                subscription.request(<span class="integer">1</span>);
            }

            <span class="annotation">@Override</span>
            <span class="directive">public</span> <span class="type">void</span> onNext(Config changedNode) {                               <i class="conum" data-value="5"></i><b>(5)</b>
                <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Node </span><span class="delimiter">&quot;</span></span> + changedNode.key() + <span class="string"><span class="delimiter">&quot;</span><span class="content"> has changed!</span><span class="delimiter">&quot;</span></span>);
                subscription.request(<span class="integer">1</span>);
            }

            <span class="annotation">@Override</span>
            <span class="directive">public</span> <span class="type">void</span> onError(<span class="predefined-type">Throwable</span> throwable) {                             <i class="conum" data-value="6"></i><b>(6)</b>
            }

            <span class="annotation">@Override</span>
            <span class="directive">public</span> <span class="type">void</span> onComplete() {                                             <i class="conum" data-value="7"></i><b>(7)</b>
            }
        });</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Select <code>Config</code> node an application wants to listen on, <code>greeting</code> node in this case.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Request node <code>changes</code> as a reactive stream API (<code>Flow.Publisher&lt;Config&gt;</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Subscribe with custom <code>Flow.Subscriber&lt;Config&gt;</code> implementation.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Request new events in <code>onSubscribe</code> method.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Method <code>onNext</code> is invoked each time the <code>greeting</code> node has changed.
The <code>changedNode</code> is a new instance of <code>Config</code> node again of <code>greeting</code> key.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Method <code>onError</code> is never called.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Method <code>onComplete</code> is called in case all config source(s) signals <em>there will be no other change event</em>.
There will be no other change event on Config side as well.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It does not matter what instance version of <code>Config</code> (related to single <code>Config.Builder</code> initialization)
a user subscribes on. It is enough to subscribe just on single (e.g. on the first) <code>Config</code> instance.
There is no added value to subscribe again and again on new <code>Config</code> instances.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using low level <code>Flow.Subscriber</code> API a user has whole subscription under full control.
It is also possible to use rich API of 3rd party libraries,
for example <a href="https://projectreactor.io/">Reactor</a>
or <a href="https://github.com/ReactiveX/RxJava">RxJava</a>.</p>
</div>
<div class="paragraph">
<p>Easiest way is to use simplified API <code>Config.onChange</code>.</p>
</div>
<div class="listingblock">
<div class="title">Subscribe on <code>greeting</code> property changes via <code>onChange</code> method</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">greeting</span><span class="delimiter">&quot;</span></span>)                                                         <i class="conum" data-value="1"></i><b>(1)</b>
        .onChange((changedNode) -&gt; {                                           <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Node </span><span class="delimiter">&quot;</span></span> + changedNode.key() + <span class="string"><span class="delimiter">&quot;</span><span class="content"> has changed!</span><span class="delimiter">&quot;</span></span>);
            <span class="keyword">return</span> <span class="predefined-constant">true</span>;                                                       <i class="conum" data-value="3"></i><b>(3)</b>
        });</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Select <code>Config</code> node an application wants to listen on, <code>greeting</code> node in this case.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Method <code>onChange</code> accepts function (<code>Function&lt;Config, Boolean&gt;</code>) that is invoked always with new <code>Config</code> instance.
This is similar to <code>onNext</code> of <code>Flow.Subscriber&lt;Config&gt;</code>.
The <code>changedNode</code> is a new instance of <code>Config</code> node again of <code>greeting</code> key.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Return <code>true</code> in case an application requests another change event to be received.
Returned <code>false</code> means an application wants to <code>cancel</code> a subscription (<code>Flow.Subscription</code>).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It&#8217;s up to user what config node wants to listen on. It is possible to listen on leaf node, on middle branch node or even on root.
Listening on not leaf nodes means user is notified about change of any sub-node.</p>
</div>
</div>
<div class="sect4">
<h5 id="_access_config_value_via_supplier">Access config value via Supplier</h5>
<div class="paragraph">
<p>Another option how to access the latest value of appropriate <code>Config</code> node is to use <code>Supplier</code> accessor method.
Each common <code>Config</code> accessor method has <code>Supplier</code> <em>mirror</em> variant.
For example common <code>Config.asString()</code> method that returns <code>String</code>
is mirrored by <code>Config.asStringSupplier()</code> method that returns <code>Supplier&lt;String&gt;</code>.</p>
</div>
<div class="listingblock">
<div class="title">Access <code>greeting</code> property as <code>Supplier&lt;String&gt;</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Supplier&lt;<span class="predefined-type">String</span>&gt; greetingSupplier = config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">greeting</span><span class="delimiter">&quot;</span></span>)                     <i class="conum" data-value="1"></i><b>(1)</b>
        .asStringSupplier();                                                   <i class="conum" data-value="2"></i><b>(2)</b>

<span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Always actual greeting value: </span><span class="delimiter">&quot;</span></span> + greetingSupplier.get()); <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Select <code>Config</code> node an application wants to access always the last value, <code>greeting</code> node in this case.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Access <code>greeting</code> property as <code>Supplier&lt;String&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Calling <code>get()</code> on <code>Supplier</code> always returns the loaded value of the node.</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Supplier support is also based on same Config changes and it is also necessary
to properly use Polling Strategies on appropriate config sources.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Config-AdvancedTopics">2.2.7. Advanced Configuration Topics</h4>
<div class="sect4">
<h5 id="Config-Advanced-ConfigSources">Advanced Config Source Topics</h5>
<div class="paragraph">
<p>Config API provides rich API around config sources. In this section all options are described.</p>
</div>
<div class="sect5">
<h6 id="_directory_config_source">Directory Config Source</h6>
<div class="paragraph">
<p>It is possible to load configuration from directory on file system.
All files placed directly in the directory are used.
File name is used as config key and it&#8217;s whole content as an <code>String</code> value.
It is possible to parse individual files.
See <a href="#Config-Advanced-Sources-SuitableParser">Find suitable Config Parser</a> section.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say an application want to load files from <code>secrets</code> directory.
(This could example of applications Kubernetes Secrets mounted on Pod&#8217;s filesystem.)
Directory config source works as any other built-in config source including listening on filesystem <em>changes</em>.</p>
</div>
<div class="paragraph">
<p>Directory <code>conf/secrets</code> contains two files:</p>
</div>
<div class="listingblock">
<div class="title">File <code>secrets/username</code></div>
<div class="content">
<pre class="CodeRay highlight"><code>jose</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">File <code>secrets/password</code></div>
<div class="content">
<pre class="CodeRay highlight"><code>^ery$ecretP&amp;ssword</code></pre>
</div>
</div>
<div class="paragraph">
<p>And can be loaded using Config API:</p>
</div>
<div class="listingblock">
<div class="title">Using <code>directory</code> config source</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config secrets = Config.withSources(
        ConfigSources.directory(<span class="string"><span class="delimiter">&quot;</span><span class="content">conf/secrets</span><span class="delimiter">&quot;</span></span>)) <i class="conum" data-value="1"></i><b>(1)</b>
        .disableEnvironmentVariablesSource()     <i class="conum" data-value="2"></i><b>(2)</b>
        .disableSystemPropertiesSource()         <i class="conum" data-value="2"></i><b>(2)</b>
        .build();

<span class="keyword">assert</span> secrets.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>).asString()        <i class="conum" data-value="3"></i><b>(3)</b>
        .equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">jose</span><span class="delimiter">&quot;</span></span>);
<span class="keyword">assert</span> secrets.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>).asString()        <i class="conum" data-value="4"></i><b>(4)</b>
        .equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">^ery$ecretP&amp;ssword</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Load all files from <code>conf/secrets</code> directory.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Do not use <em>environment variables</em> and <em>system properties</em> sources in final <code>Config</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Content of <code>username</code> file is <code>jose</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Content of <code>password</code> file is <code>^ery$ecretP&amp;ssword</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_prefixed_config_source">Prefixed Config Source</h6>
<div class="paragraph">
<p>Let&#8217;s say an application contains following two configuration files:</p>
</div>
<div class="listingblock">
<div class="title">File <code>app.conf</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="hocon">#
# Copyright (c) 2017,2018 Oracle and/or its affiliates. All rights reserved.
#

greeting = &quot;Hello&quot;
page-size = 20
basic-range = [ -20, 20 ]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">File <code>data.conf</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="hocon">#
# Copyright (c) 2017,2018 Oracle and/or its affiliates. All rights reserved.
#

providers: [
    {
        name = &quot;Provider1&quot;
        class = &quot;this.is.my.Provider1&quot;
    },
    {
        name = &quot;Provider2&quot;
        class = &quot;this.is.my.Provider2&quot;
    }
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>And these files should be loaded into single <code>Config</code> instance but to different configuration <em>namespaces</em>, under dedicated keys.</p>
</div>
<div class="listingblock">
<div class="title">Using <code>prefixed</code> config source</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.from(
        ConfigSources.prefixed(<span class="string"><span class="delimiter">&quot;</span><span class="content">app</span><span class="delimiter">&quot;</span></span>,                    <i class="conum" data-value="1"></i><b>(1)</b>
                               classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">app.conf</span><span class="delimiter">&quot;</span></span>)),   <i class="conum" data-value="2"></i><b>(2)</b>
        ConfigSources.prefixed(<span class="string"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>,                   <i class="conum" data-value="3"></i><b>(3)</b>
                               classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">data.conf</span><span class="delimiter">&quot;</span></span>))); <i class="conum" data-value="4"></i><b>(4)</b>

<span class="keyword">assert</span> config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">app.greeting</span><span class="delimiter">&quot;</span></span>).asString()             <i class="conum" data-value="5"></i><b>(5)</b>
        .equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span>);

<span class="keyword">assert</span> config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">data.providers.0.name</span><span class="delimiter">&quot;</span></span>).asString()    <i class="conum" data-value="6"></i><b>(6)</b>
        .equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Provider1</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Whole content of <code>app.conf</code> file is placed under <em>namespace</em> <code>app</code>.
This <em>namespace</em> is used as key prefix for each <code>app.conf</code> property.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The second parameter is any <code>ConfigSource</code> supplier, in this case file <code>app.conf</code> loaded from <code>classpath</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Whole content of <code>data.conf</code> file is placed under <em>namespace</em> <code>data</code>.
This <em>namespace</em> is used as key prefix for each <code>data.conf</code> property.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>File <code>app.conf</code> loaded from <code>classpath</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Key <code>app.greeting</code> is combination of <code>app</code> prefix and <code>greeting</code> property from <code>app.conf</code> file.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Key <code>data.providers.0.name</code> is combination of <code>data</code> prefix and <code>providers.0.name</code> property from <code>data.conf</code> file.</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_in_memory_config_sources">In-memory Config Sources</h6>
<div class="listingblock">
<div class="title">In-memory config sources example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config anotherConfig = Config.from(classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">application.conf</span><span class="delimiter">&quot;</span></span>));

Config config = Config.from(
        ConfigSources.from(anotherConfig.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>)),                            <i class="conum" data-value="1"></i><b>(1)</b>
        ConfigSources.from(<span class="predefined-type">System</span>.getProperties())                                <i class="conum" data-value="2"></i><b>(2)</b>
                .lax(),                                                           <i class="conum" data-value="3"></i><b>(3)</b>
        ConfigSources.from(<span class="string"><span class="delimiter">&quot;</span><span class="content">app.greeting = Hi</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">text/x-java-properties</span><span class="delimiter">&quot;</span></span>),        <i class="conum" data-value="4"></i><b>(4)</b>
        ConfigSources.from(<span class="predefined-type">Map</span>.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">app.page-size</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span>)),                        <i class="conum" data-value="5"></i><b>(5)</b>
        ConfigSources.from(ObjectNode.builder()                                   <i class="conum" data-value="6"></i><b>(6)</b>
                                   .addList(<span class="string"><span class="delimiter">&quot;</span><span class="content">app.basic-range</span><span class="delimiter">&quot;</span></span>, ListNode.builder()
                                           .addValue(<span class="string"><span class="delimiter">&quot;</span><span class="content">-20</span><span class="delimiter">&quot;</span></span>)
                                           .addValue(<span class="string"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span>)
                                           .build())
                                   .build()));

<span class="keyword">assert</span> config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">app.greeting</span><span class="delimiter">&quot;</span></span>)                                                 <i class="conum" data-value="7"></i><b>(7)</b>
        .asString().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hi</span><span class="delimiter">&quot;</span></span>);
<span class="keyword">assert</span> config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">app.page-size</span><span class="delimiter">&quot;</span></span>)                                                <i class="conum" data-value="8"></i><b>(8)</b>
        .asInt() == <span class="integer">20</span>;
<span class="keyword">assert</span> config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">app.basic-range.0</span><span class="delimiter">&quot;</span></span>)                                            <i class="conum" data-value="9"></i><b>(9)</b>
        .asInt() == -<span class="integer">20</span>;
<span class="keyword">assert</span> config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">app.basic-range.1</span><span class="delimiter">&quot;</span></span>)                                            <i class="conum" data-value="9"></i><b>(9)</b>
        .asInt() == <span class="integer">20</span>;
<span class="keyword">assert</span> config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">data.providers.0.name</span><span class="delimiter">&quot;</span></span>)                                        <i class="conum" data-value="10"></i><b>(10)</b>
        .asString().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Provider1</span><span class="delimiter">&quot;</span></span>);
<span class="keyword">assert</span> config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">user.name</span><span class="delimiter">&quot;</span></span>).asString()                                         <i class="conum" data-value="11"></i><b>(11)</b>
        .equals(<span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">user.name</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Existing <code>Config</code> instance can be used as a config source for building new Config instance.
In this case just <code>data</code> sub-node has been used.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Config source from <code>Properties</code> instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Config source from <code>Properties</code> or from <code>Map</code> returns <code>ConfigSources.MapBuilder</code> instance.
The builder allows to switches off strict mode to lax one.
In lax mode it does not fail in case of properties overlap, just logs warning.
Example of overlap properties are <code>app.port = 8080</code> and <code>app = app-name</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Config source loaded from specified <code>String</code>.
In this case <code>String</code> is in Java Properties format, <code>text/x-java-properties</code>.
Built-in Java Properties parser (<code>ConfigParsers.properties()</code>)
associated with specified media type (<code>text/x-java-properties</code>) is automatically used.
Also <code>java.lang.Readable</code> instance can be used instead of <code>String</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Config source from <code>Map</code> instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>It is possible to use <code>ConfigNode.ObjectNode</code> and <code>ConfigNode.ListNode</code> SPI to build configuration structure
usually used by <code>ConfigSource</code> or <code>ConfigParser</code> implementations.
It is useful for testing purposes.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Property <code>app.greeting</code> loaded from a <code>String</code> source.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Property <code>app.page-size</code> loaded from a <code>Map</code> source.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Property <code>app.basic-range</code> loaded from a SPI <code>ObjectNode</code> source.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Property <code>data.providers</code> loaded from another <code>Config</code> instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Property <code>user.name</code> loaded from a <code>System.getProperties()</code> source.</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_composite_config_source">Composite Config Source</h6>
<div class="paragraph">
<p>It has already been show that final <code>Config</code> instance is loaded from more than one config source.
Such config source list is wrapped by single composite config source instance on background.
It is also possible to explicitly create composite config source using <code>ConfigSources.from(sources&#8230;&#8203;)</code> method.
The method returns <code>ConfigSources.CompositeBuilder</code> instance. It is possible to programmatically
add another source instances and customize <code>MergingStrategy</code>.
Merging strategy allows a user to implement merging of list of root nodes loaded by appropriate config sources
into single node structure.</p>
</div>
<div class="paragraph">
<p>Default implementation used by <code>CompositeBuilder</code> is fallback merging strategy.
Configuration sources found earlier in the list are considered to have a higher priority than the latter ones.
I.e., when resolving a value of a key, the sources are consulted in the order they have been provided
and as soon as the value is found in a configuration source,
the value immediately is returned without consulting any of the remaining configuration sources in the prioritized collection.</p>
</div>
<div class="listingblock">
<div class="title">Composite config source example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.from(                                                 <i class="conum" data-value="1"></i><b>(1)</b>
        ConfigSources.from(file(<span class="string"><span class="delimiter">&quot;</span><span class="content">conf/dev.properties</span><span class="delimiter">&quot;</span></span>).optional(),           <i class="conum" data-value="2"></i><b>(2)</b>
                           file(<span class="string"><span class="delimiter">&quot;</span><span class="content">conf/config.properties</span><span class="delimiter">&quot;</span></span>).optional())        <i class="conum" data-value="2"></i><b>(2)</b>
                .add(classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">application.properties</span><span class="delimiter">&quot;</span></span>))                    <i class="conum" data-value="3"></i><b>(3)</b>
                .mergingStrategy(ConfigSources.MergingStrategy.fallback())); <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create new <code>Config</code> instance from single composite config source.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Method <code>ConfigSources.from(sources&#8230;&#8203;)</code> returns <code>CompositeBuilder</code> instance initialized with
two sources (from <code>dev.properties</code> and <code>config.properties</code> files).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Programmatically add third config source (<code>application.properties</code> on classpath) to <code>CompositeBuilder</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Customize <code>mergingStrategy</code>. In this case it explicitly uses default fallback merging strategy (<code>MergingStrategy.fallback()</code>).</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="Config-Advanced-Sources-SuitableParser">Find suitable Config Parser</h6>
<div class="paragraph">
<p>Formatted document loaded from common config source (file, classpath, url, etc)
needs to be parsed into internal node structure (<code>ConfigNode.ObjectNode</code>).
I.e. config source implementation uses <a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/spi/ConfigContext.html">ConfigContext</a>
to find appropriate parser instance.</p>
</div>
<div class="paragraph">
<p>Glue between formatted document and appropriate parser is media-type.
Config source needs to know media type of loaded document. And <code>Config.Builder</code> needs to provide parser instance
for requested media type. If there is no suitable <code>ConfigParser</code> instance then <code>ConfigException</code> is thrown during
<code>Config</code> initialization. See <a href="#Config-Advanced-Config-Builder">Config Builder</a> section for more information about
Config initialization options, including registering <code>ConfigParser</code> implementations.</p>
</div>
<hr>
<div class="paragraph">
<p>By default config source implementations use JDK <code>java.nio.file.Files.probeContentType(Path)</code> API to guess
source media type from it&#8217;s path. Usually it guesses media type from file extension. This approach is extensible.
A user can implement and register custom implementation of <code>java.nio.file.spi.FileTypeDetector</code> SPI.
(Similarly to Configuration library that registers file type detectors for all supported formats:
<code>.properties</code>, <code>.yaml</code>, <code>.json</code> and <code>.conf</code> extensions.)</p>
</div>
<hr>
<div class="paragraph">
<p>Almost all built-in config sources and override sources extend common
<a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/spi/AbstractSource.html">super class</a> and are usually initialized by
extension of common source <a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/spi/AbstractSource.Builder.html">Builder</a>.
It allows another options how to find appropriate parser instance.</p>
</div>
<div class="paragraph">
<p>In case it is not possible to guess document media type from source path a user can explicitly specify it
using source Builder API.</p>
</div>
<div class="listingblock">
<div class="title">Specify <code>mediaType</code> for selected config source</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.from(classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">props</span><span class="delimiter">&quot;</span></span>)                             <i class="conum" data-value="1"></i><b>(1)</b>
                                    .mediaType(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/x-java-properties</span><span class="delimiter">&quot;</span></span>)); <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>It is not possible to guess media type for file <code>props</code> on classpath.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We know <code>props</code> file is in Java Properties format, i.e. we specify it&#8217;s media type (<code>text/x-java-properties</code>).
Registered Java Properties parser will be used.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Specify <code>parser</code> for selected config source</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.from(classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">props</span><span class="delimiter">&quot;</span></span>)                            <i class="conum" data-value="1"></i><b>(1)</b>
                                    .parser(ConfigParsers.properties())); <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>It is not possible to guess media type for file <code>props</code> on classpath.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We know <code>props</code> file is in Java Properties format, i.e. we specify concrete parser instance to be used.
In this case it is built-in Java Properties implementation (<code>ConfigParsers.properties()</code>)
that is usually used to parser <code>text/x-java-properties</code> documents.</td>
</tr>
</table>
</div>
<hr>
<div class="paragraph">
<p>It is even possible to apply config parser on any config leaf value node on already parsed document.
This is really advanced feature that can be useful in specific use-case,
e.g. a user wants to load YAML file and one of it&#8217;s property value is formatted JSON document.
Config API allows to expand such leaf value into rich object structure.</p>
</div>
<div class="listingblock">
<div class="title">YAML file with included JSON formated property</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="comment">#</span>
<span class="comment"># Copyright (c) 2017,2018 Oracle and/or its affiliates. All rights reserved.</span>
<span class="comment">#</span>

<span class="key">secrets</span>:
    <span class="key">username</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">jose</span><span class="delimiter">&quot;</span></span>
    <span class="key">password</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">^ery$ecretP&amp;ssword</span><span class="delimiter">&quot;</span></span>

<span class="key">app</span>: <span class="string"><span class="delimiter">&gt;</span></span>                             <i class="conum" data-value="1"></i><b>(1)</b>
    {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">greeting</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span><span class="string"><span class="content">,</span></span>
        <span class="key"><span class="delimiter">&quot;</span><span class="content">page-size</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="content">20,</span></span>
        <span class="key"><span class="delimiter">&quot;</span><span class="content">basic-range</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="content">[ -20, 20 ]</span></span>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Property <code>app</code> is internally formatted as JSON document.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">JSON formatted property is loaded as leaf value by default</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.from(classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">application.yaml</span><span class="delimiter">&quot;</span></span>)); <i class="conum" data-value="1"></i><b>(1)</b>

<span class="keyword">assert</span> config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">secrets.username</span><span class="delimiter">&quot;</span></span>).asString()            <i class="conum" data-value="2"></i><b>(2)</b>
        .equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">jose</span><span class="delimiter">&quot;</span></span>);
<span class="keyword">assert</span> config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">secrets.password</span><span class="delimiter">&quot;</span></span>).asString()            <i class="conum" data-value="2"></i><b>(2)</b>
        .equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">^ery$ecretP&amp;ssword</span><span class="delimiter">&quot;</span></span>);

<span class="keyword">assert</span> config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">app</span><span class="delimiter">&quot;</span></span>).type() == <span class="predefined-type">Type</span>.VALUE;              <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>File <code>application.yaml</code> is loaded without any additional settings.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>secrets</code> properties are loaded as expected.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Property <code>app</code> is loaded as plain leaf value node.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Specify JSON formatted property' media type</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.from(
        classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">application.yaml</span><span class="delimiter">&quot;</span></span>)
                .mediaTypeMapping(                          <i class="conum" data-value="1"></i><b>(1)</b>
                        key -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">app</span><span class="delimiter">&quot;</span></span>.equals(key.toString()) <i class="conum" data-value="2"></i><b>(2)</b>
                                ? <span class="string"><span class="delimiter">&quot;</span><span class="content">application/json</span><span class="delimiter">&quot;</span></span>
                                : <span class="predefined-constant">null</span>));

<span class="keyword">assert</span> config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">secrets.username</span><span class="delimiter">&quot;</span></span>).asString()            <i class="conum" data-value="3"></i><b>(3)</b>
        .equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">jose</span><span class="delimiter">&quot;</span></span>);
<span class="keyword">assert</span> config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">secrets.password</span><span class="delimiter">&quot;</span></span>).asString()            <i class="conum" data-value="3"></i><b>(3)</b>
        .equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">^ery$ecretP&amp;ssword</span><span class="delimiter">&quot;</span></span>);

<span class="keyword">assert</span> config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">app</span><span class="delimiter">&quot;</span></span>).type() == <span class="predefined-type">Type</span>.OBJECT;             <i class="conum" data-value="4"></i><b>(4)</b>

<span class="keyword">assert</span> config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">app.greeting</span><span class="delimiter">&quot;</span></span>)                           <i class="conum" data-value="5"></i><b>(5)</b>
        .asString().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span>);
<span class="keyword">assert</span> config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">app.page-size</span><span class="delimiter">&quot;</span></span>)                          <i class="conum" data-value="5"></i><b>(5)</b>
        .asInt() == <span class="integer">20</span>;
<span class="keyword">assert</span> config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">app.basic-range.0</span><span class="delimiter">&quot;</span></span>)                      <i class="conum" data-value="5"></i><b>(5)</b>
        .asInt() == -<span class="integer">20</span>;
<span class="keyword">assert</span> config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">app.basic-range.1</span><span class="delimiter">&quot;</span></span>)                      <i class="conum" data-value="5"></i><b>(5)</b>
        .asInt() == <span class="integer">20</span>;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Method <code>mediaTypeMapping</code> accepts function that can return appropriate media-type for selected config nodes (keys).
If the functions return a media type then appropriate parser is used to parse content of the config leaf value node.
Parsed config object node then replaces original leaf value node. Returned <code>null</code> value means <em>let a value node as is</em>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>In this case <code>app</code> property value is JSON document, it&#8217;s media type is <code>application/json</code>.
Registered JSON parser will be automatically used.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>secrets</code> properties are loaded as expected.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Property <code>app</code> is now an structured object node.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>And <code>app</code> properties are loaded as expected.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Specify JSON formatted property' parser instance</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.from(
        classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">application.yaml</span><span class="delimiter">&quot;</span></span>)
                .parserMapping(                                           <i class="conum" data-value="1"></i><b>(1)</b>
                        key -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">app</span><span class="delimiter">&quot;</span></span>.equals(key.toString())               <i class="conum" data-value="2"></i><b>(2)</b>
                                ? HoconConfigParserBuilder.buildDefault()
                                : <span class="predefined-constant">null</span>));</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Complementary option is to use <code>parserMapping</code> method
that accepts function that can return appropriate parser instance for selected config nodes (keys).
Parsed config object node then replaces original leaf value node. Returned <code>null</code> value means <em>let a value node as is</em>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>In this case <code>app</code> property value is JSON document and concrete JSON parser instance is used.
(HOCON config parser supports also JSON format because HOCON is the JSON superset.)</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_retry_policies">Retry Policies</h6>
<div class="paragraph">
<p>The retry policy offers the user a way to configure how the failed remote call will be handled. We provide two basic
implementations</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="img/config/RetryPolicies.png" alt="io.j4c.config.RetryPolicies" width="137" height="92">
</div>
<div class="title">io.j4c.config.RetryPolicies</div>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/RetryPolicies.html#justCall--">RetryPolicies.justCall()</a> - this implementation
executes just one call - it is the default retry policy</p>
</li>
<li>
<p><a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/RetryPolicies.html#repeat-int-">RetryPolicies.repeat(int retries)</a> - a basic implementation
can be configured using several parameters -  see below</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example how to use a default implementation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.from(
        ConfigSources
                .url(<span class="keyword">new</span> <span class="predefined-type">URL</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://config-service/application.yaml</span><span class="delimiter">&quot;</span></span>))
                .retryPolicy(RetryPolicies.repeat(<span class="integer">2</span>)                         <i class="conum" data-value="1"></i><b>(1)</b>
                                     .delay(<span class="predefined-type">Duration</span>.ofMillis(<span class="integer">100</span>))          <i class="conum" data-value="2"></i><b>(2)</b>
                                     .delayFactor(<span class="integer">2</span>)                         <i class="conum" data-value="3"></i><b>(3)</b>
                                     .callTimeout(<span class="predefined-type">Duration</span>.ofMillis(<span class="integer">100</span>))    <i class="conum" data-value="4"></i><b>(4)</b>
                                     .overallTimeout(<span class="predefined-type">Duration</span>.ofSeconds(<span class="integer">1</span>))) <i class="conum" data-value="5"></i><b>(5)</b>
                .optional()
                .build());</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A mandatory parameter says how many times at the most should be the call repeated at maximum</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>An initial delay between the first and second call (the default value: 200ms)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The delay might be changed with every other round (the default value: 2.0)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Every call ha to be executed within this timeout (the default value: 500ms)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>An overall timeout includes all delays and durations of all calls (the default value: 2s)</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For an information how to implement a custom retry policy see <a href="#Config-SPI-RetryPolicy">RetryPolicy SPI</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="Config-Advanced-Sources-MetaSource">Load Config Sources from meta-configuration</h6>
<div class="paragraph">
<p>Configuration sources can be loaded from meta configuration. Meta configuration is externalized configuration
that describes ordered list of config sources to be used to load target <code>Config</code> instance from.</p>
</div>
<div class="paragraph">
<p>Such meta-configuration contains <code>sources</code> property that is array (ordered list) of objects.
Each object of an array describes single config source.</p>
</div>
<div class="paragraph">
<p>A config source meta config should contain one of following top level properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>type</code> - specify type of loaded config source implementation.
It can contain identification of one of built-in sources, or id of custom config source implementation.
See below for more details.</p>
</li>
<li>
<p><code>class</code> - fully qualified class name of custom config source implementation, or a builder class that has <code>build()</code> method
returning <code>ConfigSource</code> instance. <code>ConfigMapper</code> support is used to initialize the class instance.
See <a href="#Config-PropertyMapping-Generic">Implicit Custom Config Mapper</a> section for details about generic mapping support.</p>
</li>
<li>
<p><code>properties</code> - object node of another properties used to initialize appropriate config source instance from.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use exclusively <code>type</code> or <code>class</code> property. If used both, <code>class</code> is ignored. There are following built-in config sources,
i.e. supported <code>type</code> values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>system-properties</code> - system properties config source, see <code>ConfigSources.systemProperties()</code>.
No additional properties are supported.</p>
</li>
<li>
<p><code>environment-variables</code> - environment variables config source, see <code>ConfigSources.environmentVariables()</code>.
No additional properties are supported.</p>
</li>
<li>
<p><code>classpath</code> - classpath config source, see <code>ConfigSources.classpath(String)</code>.</p>
<div class="paragraph">
<p>Mandatory properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>resource</code> - type <code>String</code></p>
<div class="paragraph">
<p>Optional properties: see <code>AbstractParsableConfigSource.Builder.init(Config)</code>.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><code>file</code> - file config source, see ConfigSources.file(String).</p>
<div class="paragraph">
<p>Mandatory properties:
** <code>path</code> - type <code>Path</code></p>
</div>
<div class="paragraph">
<p>+
Optional properties: see <code>AbstractParsableConfigSource.Builder.init(Config)</code>.</p>
</div>
</li>
<li>
<p><code>directory</code> - directory config source, see <code>ConfigSources.directory(String)</code>.</p>
<div class="paragraph">
<p>Mandatory properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>path</code> - type <code>Path</code></p>
<div class="paragraph">
<p>Optional properties: see <code>AbstractParsableConfigSource.Builder.init(Config).</code></p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><code>url</code> - url config source, see <code>ConfigSources.url(URL)</code>.</p>
<div class="paragraph">
<p>Mandatory properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>url</code> - type <code>URL</code></p>
<div class="paragraph">
<p>Optional properties: see <code>AbstractParsableConfigSource.Builder.init(Config)</code>.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><code>prefixed</code> - prefixed config source, see <code>ConfigSources.prefixed(String, Supplier)</code>.</p>
<div class="paragraph">
<p>Mandatory properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>key</code> - type <code>String</code></p>
</li>
<li>
<p><code>type</code> or <code>class</code> - type <code>String</code>. Specify any other config source discussed in the current section.</p>
</li>
<li>
<p><code>properties</code> - other config source properties used to initialize it.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example configuration in HOCON format:</p>
</div>
<div class="listingblock">
<div class="title">Meta-configuration <code>config-meta-all.conf</code> with all built-in sources available on classpath</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="hocon">#
# Copyright (c) 2017,2018 Oracle and/or its affiliates. All rights reserved.
#

sources = [
    {
        type = &quot;environment-variables&quot;
    }
    {
        type = &quot;system-properties&quot;
    }
    {
        type = &quot;directory&quot;
        properties {
            path = &quot;conf/secrets&quot;
            media-type-mapping {
                yaml = &quot;application/x-yaml&quot;
                password = &quot;application/base64&quot;
            }
            polling-strategy {
                type = &quot;regular&quot;
                properties {
                    interval = &quot;PT15S&quot;
                }
            }
        }
    }
    {
        type = &quot;url&quot;
        properties {
            url = &quot;http://config-service/my-config&quot;
            media-type = &quot;application/hocon&quot;
            optional = true
            retry-policy {
                type = &quot;repeat&quot;
                properties {
                    retries = 3
                }
            }
        }
    }
    {
        type = &quot;file&quot;
        properties {
            path = &quot;conf/env.yaml&quot;
            polling-strategy {
                type = &quot;watch&quot;
            }
        }
    }
    {
        type = &quot;prefixed&quot;
        properties {
            key = &quot;app&quot;
            type = &quot;classpath&quot;
            properties {
                resource = &quot;app.conf&quot;
            }
        }
    }
    {
        type = &quot;classpath&quot;
        properties {
            resource = &quot;application.conf&quot;
        }
    }
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example also demonstrates using of built-in <code>polling-strategy</code>-ies: <code>regular</code> and <code>watch</code>.
See below for details about all supported properties and custom implementation support.
Example also demonstrates using of built-in <code>retry-policy</code> <code>repeat</code>.
See below for details about all supported properties and custom implementation support.</p>
</div>
<div class="paragraph">
<p>Custom config source is represented by fully qualified <code>class</code> name, instead of <code>type</code> attribute.
Via <code>META-INF/resources/meta-config-sources.properties</code> file on classpath it is possible to provide custom <code>type</code> values.
File <code>meta-config-sources.properties</code> contains properties where a property key is newly defined <code>type</code>
and a property value is fully qualified <code>class</code> name of custom config source implementation or its builder.</p>
</div>
<div class="paragraph">
<p>For example, module <code>j4c-config-git</code> provides <code>META-INF/resources/meta-config-sources.properties</code> file:</p>
</div>
<div class="listingblock">
<div class="title">Module <code>j4c-config-git</code> contains <code>META-INF/resources/meta-config-sources.properties</code></div>
<div class="content">
<pre class="CodeRay highlight"><code>git = io.j4c.config.git.GitConfigSourceBuilder</code></pre>
</div>
</div>
<div class="paragraph">
<p>I.e. it is possible to configure Git config source using <code>type = "git"</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="hocon">{
    type = &quot;git&quot;
    properties {
        path = &quot;application.conf&quot;
        directory = &quot;/app-config&quot;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>instead of <code>class = "io.j4c.config.git.GitConfigSourceBuilder"</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="hocon">{
    class = &quot;io.j4c.config.git.GitConfigSourceBuilder&quot;
    properties {
        path = &quot;application.conf&quot;
        directory = &quot;/app-config&quot;
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Loading config source from meta-configuration file on classpath</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ConfigSource loadedSource = ConfigSources.load(     <i class="conum" data-value="1"></i><b>(1)</b>
        classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">config-meta-all.conf</span><span class="delimiter">&quot;</span></span>)).build(); <i class="conum" data-value="2"></i><b>(2)</b>

Config config = Config.from(loadedSource);          <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Method <code>ConfigSources.load</code> accepts meta-configuration(s) that will be used to load <code>sources</code> array property.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Loading from <code>config-meta-etcd.yaml</code> file available on classpath.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Source <code>loadedSource</code> already contains all already merged sources described in <code>config-meta-etcd.yaml</code> file.
Such source can be used to initialize <code>Config</code> instance as usual.</td>
</tr>
</table>
</div>
<hr>
<div class="paragraph">
<p>All built-in <strong>polling strategies</strong> are supported as well as custom implementations of polling strategies.
The support is tightly connected with <code>AbstractSource</code> extensions and will not be automatically provided by any another
config source implementations. Meta configuration property <code>polling-strategy</code> can be configured using following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>type</code> - specify type of loaded polling strategy implementation. It can contain identification of one of built-in strategies.</p>
</li>
<li>
<p><code>class</code> - fully qualified class name of custom polling strategy implementation,
or a builder class that has <code>build()</code> method returning <code>PollingStrategy</code> instance.</p>
</li>
<li>
<p><code>properties</code> - object node of another properties used to initialize appropriate strategy instance from.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use exclusively <code>type</code> or <code>class</code> property. If used both, <code>class</code> is ignored.
There are following built-in polling strategies, i.e. supported <code>type</code> values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>regular</code> - regular scheduled polling strategy, see PollingStrategies.regular(Duration).</p>
<div class="paragraph">
<p>Mandatory properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>interval</code> - type <code>Duration</code>, e.g. <code>PT15S</code> means <code>15 seconds</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>watch</code> - filesystem watch polling strategy, see <code>PollingStrategies.watch(Path)</code>.
Polling strategy can be used just with config sources built by <code>AbstractSource.Builder</code> extension parametrized
by <code>Path</code> for source target. For example <code>classpath</code>, <code>file</code> or <code>directory</code> config sources.
No additional properties are supported.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Custom polling strategy is represented by fully qualified <code>class</code> name.
<code>io.j4c.config.ConfigMapper</code> support is used to initialize the class instance.
See <a href="#Config-PropertyMapping-Generic">Implicit Custom Config Mapper</a> section for details about generic mapping support.
Such polling strategy is applied as common polling strategy.
In case of <em>target</em> specific implementation of polling strategy (similar to <code>Path</code> specific filesystem watch polling strategy)
an implementation class must has public constructor with single parameter of target type.</p>
</div>
<hr>
<div class="paragraph">
<p>All built-in <strong>retry policies</strong> are supported as well as custom implementations of retry policies.
The support is tightly connected with <code>AbstractSource</code> extensions and will not be automatically provided by any another
config source implementations. Meta configuration property <code>retry-policy</code> can be configured using following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>type</code> - specify type of loaded retry policy implementation. It can contain identification of one of built-in policies.</p>
</li>
<li>
<p><code>class</code> - fully qualified class name of custom retry policy implementation,
or a builder class that has <code>build()</code> method returning <code>PollingStrategy</code> instance.</p>
</li>
<li>
<p><code>properties</code> - object node of another properties used to initialize appropriate retry policy instance from.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use exclusively <code>type</code> or <code>class</code> property. If used both, <code>class</code> is ignored.
There are following built-in retry policies, i.e. supported <code>type</code> values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>repeat</code> - regular scheduled retry policy, see <code>RetryPolicies.repeat(int)</code>.</p>
<div class="paragraph">
<p>Mandatory properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>retries</code> - type <code>int</code></p>
<div class="paragraph">
<p>Optional properties:</p>
</div>
</li>
<li>
<p><code>delay</code> - type <code>Duration</code>, see <code>RetryPolicies.Builder.delay(Duration)</code></p>
</li>
<li>
<p><code>delay-factor</code> - type <code>double</code>, see <code>RetryPolicies.Builder.delayFactor(double)</code></p>
</li>
<li>
<p><code>call-timeout</code> - type <code>Duration</code>, see <code>RetryPolicies.Builder.callTimeout(Duration)</code></p>
</li>
<li>
<p><code>overall-timeout</code> - type <code>Duration</code>, see <code>RetryPolicies.Builder.overallTimeout(Duration)</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Custom retry policy is represented by fully qualified <code>class</code> name.
<code>io.j4c.config.ConfigMapper</code> support is used to initialize the class instance.
See <a href="#Config-PropertyMapping-Generic">Implicit Custom Config Mapper</a> section for details about generic mapping support.
Such retry policy is applied as common retry policy.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Config-Advanced-Config">Advanced Config Topics</h5>
<div class="sect5">
<h6 id="_config_core_accessor_methods">Config Core Accessor Methods</h6>
<div class="paragraph">
<p>Basic <code>Config</code> accessor methods are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>value()</code> - returns a <code>String</code> value of leaf <code>VALUE</code> node. Returned value is wrapped by JDK <code>Optional</code>.
I.e. in case of <code>MISSING</code> config node it returns <code>Optional.empty()</code>.
In case of <code>LIST</code> node or <code>OBJECT</code> node the method throws <code>ConfigMappingException</code>.</p>
</li>
<li>
<p><code>nodeList()</code> - returns a list of sub-nodes (<code>List&lt;Config&gt;</code>). No matter if the node is a list node or an object node.
For a <code>LIST</code> node it returns list items. List index (start from <code>0</code>) is used as node name.
For an <code>OBJECT</code> node it returns object members.
Returned <code>List</code> is wrapped by JDK <code>Optional</code>. I.e. in case of <code>MISSING</code> config node it returns <code>Optional.empty()</code>.
In case of leaf <code>VALUE</code> node the method throws <code>ConfigMappingException</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All other accessor methods are based on these two methods together with associated config mappers to be able
convert original value(s) to requested target type.
See complete set of accessor methods bellow.</p>
</div>
<div class="paragraph">
<p>The last special accessor method is <code>node()</code>.
Returns existing current config node as a <code>Optional</code> instance or <code>Optional.empty()</code> in case of <code>MISSING</code> node.</p>
</div>
<div class="listingblock">
<div class="title">Using <code>Config.node()</code> method</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// old school way</span>
<span class="keyword">if</span> (config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">data.providers</span><span class="delimiter">&quot;</span></span>).exists()) {             <i class="conum" data-value="1"></i><b>(1)</b>
    processDataProviders(config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">data.providers</span><span class="delimiter">&quot;</span></span>));
} <span class="keyword">else</span> {
    noDataProvidersFallback();
}
<span class="comment">// using `node()`</span>
config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">data.providers</span><span class="delimiter">&quot;</span></span>)
        .node()                                          <i class="conum" data-value="2"></i><b>(2)</b>
        .ifPresentOrElse(Main::processDataProviders,
                         Main::noDataProvidersFallback);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Process <code>data.providers</code> configuration (method <code>processDataProviders</code>) if exists,
otherwise do fallback (method <code>noDataProvidersFallback</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This implements same behaviour but it is more functional style based on <code>node()</code> method.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Another from core accessor methods are <code>asMap()</code>, <code>asMap(default)</code> and <code>asOptionalMap()</code>.
Returned map contains all leaf values of current node. Fully qualified key of config node is used as a key in returned Map.</p>
</div>
<div class="listingblock">
<div class="title">Using <code>Config.asMap()</code> method</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; map = config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">app</span><span class="delimiter">&quot;</span></span>).asMap(); <i class="conum" data-value="1"></i><b>(1)</b>

<span class="keyword">assert</span> map.size() == <span class="integer">4</span>;                              <i class="conum" data-value="2"></i><b>(2)</b>
<span class="keyword">assert</span> map.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">app.greeting</span><span class="delimiter">&quot;</span></span>).equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span>);      <i class="conum" data-value="2"></i><b>(2)</b>
<span class="keyword">assert</span> map.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">app.page-size</span><span class="delimiter">&quot;</span></span>).equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span>);        <i class="conum" data-value="2"></i><b>(2)</b>
<span class="keyword">assert</span> map.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">app.basic-range.0</span><span class="delimiter">&quot;</span></span>).equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">-20</span><span class="delimiter">&quot;</span></span>);   <i class="conum" data-value="2"></i><b>(2)</b>
<span class="keyword">assert</span> map.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">app.basic-range.1</span><span class="delimiter">&quot;</span></span>).equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span>);    <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get all <code>app</code> sub-leaf values as a <code>Map</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Map contains 4 properties. Keys are still prefixed by <code>app.</code>.
Each list item is a single map entry.</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="Config-Advanced-Config-Accessors">All Config Accessor Methods</h6>
<div class="paragraph">
<p>Complete set of <code>Config</code> accessor methods.</p>
</div>
<div class="sect6">
<h7 id="_common_accessor_methods">Common Accessor Methods</h7>
<table class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 2. Config accessor methods to get a single value</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Common</th>
<th class="tableblock halign-left valign-top">With Default</th>
<th class="tableblock halign-left valign-top">Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generic (<code>T</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>as(Class&lt;T&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>as(Class&lt;T&gt;,T)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asOptional(Class&lt;T&gt;)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asBoolean()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asBoolean(boolean)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asOptionalBoolean()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Double</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asDouble()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asDouble(double)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asOptionalDouble()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asInt()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asInt(int)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asOptionalInt()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Long</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asLong()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asLong(long)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asOptionalLong()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Map</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asMap()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asMap(Map&lt;String,String&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asOptionalMap()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asString()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asString(String)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asOptionalString()</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 3. Config accessor methods to get a list of values</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Common</th>
<th class="tableblock halign-left valign-top">With Default</th>
<th class="tableblock halign-left valign-top">Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generic (<code>List&lt;T&gt;</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asList(Class&lt;T&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asList(Class&lt;T&gt;,List&lt;T&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asOptionalList(Class&lt;T&gt;)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>List&lt;Config&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asNodeList()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asNodeList(List&lt;Config&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asOptionalNodeList()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>List&lt;String&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asStringList()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asStringList(List&lt;String&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asOptionalStringList()</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 4. Config accessor methods to map a single value</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Common</th>
<th class="tableblock halign-left valign-top">With Default</th>
<th class="tableblock halign-left valign-top">Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Complex <code>ConfigMapper</code> (<code>T</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>map(ConfigMapper&lt;T&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>map(ConfigMapper&lt;T&gt;,T)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mapOptional(ConfigMapper&lt;T&gt;)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Simple <code>Function</code> (<code>T</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>map(Function&lt;String,T&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>map(Function&lt;String,T&gt;,T)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mapOptional(Function&lt;String,T&gt;)</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 5. Config accessor methods to map a list of values</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Common</th>
<th class="tableblock halign-left valign-top">With Default</th>
<th class="tableblock halign-left valign-top">Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Complex <code>ConfigMapper</code> (<code>List&lt;T&gt;</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mapList(ConfigMapper&lt;T&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mapList(ConfigMapper&lt;T&gt;,List&lt;T&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mapOptionalList(ConfigMapper&lt;T&gt;)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Simple <code>Function</code> (<code>List&lt;T&gt;</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mapList(Function&lt;String,T&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mapList(Function&lt;String,T&gt;,List&lt;T&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mapOptionalList(Function&lt;String,T&gt;)</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect6">
<h7 id="_supplier_accessor_methods">Supplier Accessor Methods</h7>
<table class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 6. Config accessor methods to get a single value</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Common</th>
<th class="tableblock halign-left valign-top">With Default</th>
<th class="tableblock halign-left valign-top">Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generic (<code>T</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asSupplier(Class&lt;T&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asSupplier(Class&lt;T&gt;,T)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asOptionalSupplier(Class&lt;T&gt;)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asBooleanSupplier()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asBooleanSupplier(boolean)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asOptionalBooleanSupplier()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Double</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asDoubleSupplier()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asDoubleSupplier(double)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asOptionalDoubleSupplier()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asIntSupplier()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asIntSupplier(int)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asOptionalIntSupplier()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Long</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asLongSupplier()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asLongSupplier(long)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asOptionalLongSupplier()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Map</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asMapSupplier()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asMapSupplier(Map&lt;String,String&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asOptionalMapSupplier()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asStringSupplier()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asStringSupplier(String)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asOptionalStringSupplier()</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 7. Config accessor methods to get a list of values</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Common</th>
<th class="tableblock halign-left valign-top">With Default</th>
<th class="tableblock halign-left valign-top">Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generic (<code>List&lt;T&gt;</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asListSupplier(Class&lt;T&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asListSupplier(Class&lt;T&gt;,List&lt;T&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asOptionalListSupplier(Class&lt;T&gt;)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>List&lt;Config&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asNodeListSupplier()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asNodeListSupplier(List&lt;Config&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asOptionalNodeListSupplier()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>List&lt;String&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asStringListSupplier()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asStringListSupplier(List&lt;String&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asOptionalStringListSupplier()</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 8. Config accessor methods to map a single value</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Common</th>
<th class="tableblock halign-left valign-top">With Default</th>
<th class="tableblock halign-left valign-top">Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Complex <code>ConfigMapper</code> (<code>T</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mapSupplier(ConfigMapper&lt;T&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mapSupplier(ConfigMapper&lt;T&gt;,T)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mapOptionalSupplier(ConfigMapper&lt;T&gt;)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Simple <code>Function</code> (<code>T</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mapSupplier(Function&lt;String,T&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mapSupplier(Function&lt;String,T&gt;,T)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mapOptionalSupplier(Function&lt;String,T&gt;)</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 9. Config accessor methods to map a list of values</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Common</th>
<th class="tableblock halign-left valign-top">With Default</th>
<th class="tableblock halign-left valign-top">Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Complex <code>ConfigMapper</code> (<code>List&lt;T&gt;</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mapListSupplier(ConfigMapper&lt;T&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mapListSupplier(ConfigMapper&lt;T&gt;,List&lt;T&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mapOptionalListSupplier(ConfigMapper&lt;T&gt;)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Simple <code>Function</code> (<code>List&lt;T&gt;</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mapListSupplier(Function&lt;String,T&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mapListSupplier(Function&lt;String,T&gt;,List&lt;T&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mapOptionalListSupplier(Function&lt;String,T&gt;)</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_config_key">Config Key</h6>
<div class="paragraph">
<p>Configuration is loaded from config source into tree-like hierarchical structure.
Each config node has it&#8217;s name (or key token). And each config node has fully qualified unique key.
Root node&#8217;s name and key is empty (<code>``</code>) <code>String</code>.</p>
</div>
<div class="paragraph">
<p>Whole key is a list of key tokens (node names) separated by &#8220;.&#8221; (dot character).
Depending on context the key token is evaluated one by one:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>in <code>OBJECT</code> node the token represents a <strong>name of object member</strong>;</p>
</li>
<li>
<p>in <code>LIST</code> node the token represents an zero-based <strong>index of list element</strong>,
an unsigned base-10 integer value, leading zeros are not allowed.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">The ABNF syntax of config key</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="abnf">config-key = *1( key-token *( &quot;.&quot; key-token ) )
 key-token = *( unescaped / escaped )
 unescaped = %x00-2D / %x2F-7D / %x7F-10FFFF
           ; %x2E ('.') and %x7E ('~') are excluded from 'unescaped'
   escaped = &quot;~&quot; ( &quot;0&quot; / &quot;1&quot; )
           ; representing '~' and '.', respectively</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To emphasize, dot character (&#8220;.&#8221;) has special meaning. It is used as key token separator.
In case a dot character should be a part of node name it must be escaped by &#8220;~1&#8221;.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Following configuration file contains two object nodes named <code>oracle</code> and <code>oracle.com</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example JSON configuration <code>application.json</code> with dot character in node name</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">oracle</span><span class="delimiter">&quot;</span></span> : {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">com</span><span class="delimiter">&quot;</span></span> : <span class="value">true</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">cz</span><span class="delimiter">&quot;</span></span> : <span class="value">false</span>
    },
    <span class="key"><span class="delimiter">&quot;</span><span class="content">oracle.com</span><span class="delimiter">&quot;</span></span> : {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">secured</span><span class="delimiter">&quot;</span></span> : <span class="value">true</span>
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Working with configuration with dot character in node name</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.from(classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">application.json</span><span class="delimiter">&quot;</span></span>));

<span class="comment">// node `oracle`</span>
<span class="keyword">assert</span> config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">oracle.com</span><span class="delimiter">&quot;</span></span>).asBoolean() == <span class="predefined-constant">true</span>;                         <i class="conum" data-value="1"></i><b>(1)</b>
<span class="keyword">assert</span> config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">oracle</span><span class="delimiter">&quot;</span></span>).get(<span class="string"><span class="delimiter">&quot;</span><span class="content">com</span><span class="delimiter">&quot;</span></span>).asBoolean() == <span class="predefined-constant">true</span>;                  <i class="conum" data-value="1"></i><b>(1)</b>
<span class="keyword">assert</span> config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">oracle.com</span><span class="delimiter">&quot;</span></span>).type() == <span class="predefined-type">Type</span>.VALUE;                        <i class="conum" data-value="2"></i><b>(2)</b>
<span class="keyword">assert</span> config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">oracle.com</span><span class="delimiter">&quot;</span></span>).name().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">com</span><span class="delimiter">&quot;</span></span>);                        <i class="conum" data-value="3"></i><b>(3)</b>
<span class="comment">// node `oracle.com`</span>
<span class="keyword">assert</span> config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">oracle~1com.secured</span><span class="delimiter">&quot;</span></span>).asBoolean() == <span class="predefined-constant">true</span>;                <i class="conum" data-value="4"></i><b>(4)</b>
<span class="keyword">assert</span> config.get(<span class="predefined-type">Key</span>.escapeName(<span class="string"><span class="delimiter">&quot;</span><span class="content">oracle.com</span><span class="delimiter">&quot;</span></span>))                              <i class="conum" data-value="5"></i><b>(5)</b>
        .get(<span class="string"><span class="delimiter">&quot;</span><span class="content">secured</span><span class="delimiter">&quot;</span></span>).asBoolean() == <span class="predefined-constant">true</span>;
<span class="keyword">assert</span> config.get(<span class="predefined-type">Key</span>.escapeName(<span class="string"><span class="delimiter">&quot;</span><span class="content">oracle.com</span><span class="delimiter">&quot;</span></span>)).type() == <span class="predefined-type">Type</span>.OBJECT;       <i class="conum" data-value="6"></i><b>(6)</b>
<span class="keyword">assert</span> config.get(<span class="predefined-type">Key</span>.escapeName(<span class="string"><span class="delimiter">&quot;</span><span class="content">oracle.com</span><span class="delimiter">&quot;</span></span>)).name().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">oracle.com</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="7"></i><b>(7)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Work with the first <code>oracle</code> object as usual.
It is possible to use fully-qualified key <code>oracle.com</code> or concatenate <code>get(key)</code> calls to access <code>com</code> property value.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Config node <code>"oracle"</code> / <code>"com"</code> type is leaf <code>VALUE</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Config node <code>"oracle"</code> / <code>"com"</code> name is same as the last key token <code>com</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The second object name is <code>oracle.com</code>. Dot character is automatically escaped during document parsing.
I.e. on <code>Config</code> API we need to use escaped node name <code>oracle~1com</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>A user can use utility method <code>Config.Key.escapeName(name)</code> to escape original node name <code>oracle.com</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Config node <code>"oracle.com"</code> type is <code>OBJECT</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Config node <code>"oracle.com"</code> name is original <code>oracle.com</code> (loaded from JSON file).</td>
</tr>
</table>
</div>
<hr>
<div class="paragraph">
<p>Method <code>Config.key()</code> always returns fully-qualified key - whole node path.
In some cases you do not want to show full context the configuration node has been placed in.
Method <code>Config.detach()</code> helps to hide the context. Returns new instance of same Config node with <em>reset</em> config key.
Returned config&#8217;s key is empty string, i.e. it looks like <em>local</em> root node. Original config node is not affected.</p>
</div>
<div class="listingblock">
<div class="title">Using <code>Config.detach()</code> method</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.from(classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">application.conf</span><span class="delimiter">&quot;</span></span>));

Config root = config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">app</span><span class="delimiter">&quot;</span></span>)
        .detach();                                          <i class="conum" data-value="1"></i><b>(1)</b>

<span class="keyword">assert</span> root.name().equals(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>);                              <i class="conum" data-value="2"></i><b>(2)</b>
<span class="keyword">assert</span> root.key().name().equals(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>);                        <i class="conum" data-value="2"></i><b>(2)</b>
<span class="keyword">assert</span> root.key().toString().equals(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>);                    <i class="conum" data-value="2"></i><b>(2)</b>

<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; map = root.asMap();                     <i class="conum" data-value="3"></i><b>(3)</b>

<span class="keyword">assert</span> map.size() == <span class="integer">4</span>;                                     <i class="conum" data-value="4"></i><b>(4)</b>
<span class="keyword">assert</span> map.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">greeting</span><span class="delimiter">&quot;</span></span>).equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span>);                 <i class="conum" data-value="4"></i><b>(4)</b>
<span class="keyword">assert</span> map.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">page-size</span><span class="delimiter">&quot;</span></span>).equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span>);                   <i class="conum" data-value="4"></i><b>(4)</b>
<span class="keyword">assert</span> map.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">basic-range.0</span><span class="delimiter">&quot;</span></span>).equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">-20</span><span class="delimiter">&quot;</span></span>);              <i class="conum" data-value="4"></i><b>(4)</b>
<span class="keyword">assert</span> map.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">basic-range.1</span><span class="delimiter">&quot;</span></span>).equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span>);               <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This is modified <code>asMap</code> example. Get <code>app</code> config node and <code>detach</code> it from original node structure.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Returned node is local root node, i.e. it&#8217;s key and name is empty string.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Get all original <code>app</code> sub-leaf values as a <code>Map</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Map contains 4 properties.
The <code>root</code> is <em>local</em> root node, i.e. there is no <code>app.</code> prefix in returned <code>Map</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="Config-Advanced-Config-MetaConfig">Create Config from meta-configuration</h6>
<div class="paragraph">
<p>In <a href="#Config-Basics-DefaultConfig">Access default configuration</a> section the <code>Config.create()</code> has been introduced.
It creates <code>Config</code> instance from well known configuration file, if available.
It&#8217;s functionality is little bit more complex than already explained.
The method also supports loading configuration from well known <a href="#Config-Advanced-Sources-MetaSource">meta-configuration</a> file,
if available.</p>
</div>
<div class="paragraph">
<p>I.e. <code>Config.create()</code> creates <code>Config</code> instance from following sources, in order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Tries to load configuration from meta one of following meta configuration files on classpath, checked in order:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>meta-config.yaml</code> - meta configuration file in YAML format</p>
</li>
<li>
<p><code>meta-config.conf</code> - meta configuration file in HOCON format</p>
</li>
<li>
<p><code>meta-config.json</code> - meta configuration file in JSON format</p>
</li>
<li>
<p><code>meta-config.properties</code> - meta configuration file in Java Properties format</p>
</li>
</ol>
</div>
</li>
<li>
<p>Otherwise, configuration consists of:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Environment variables</p>
</li>
<li>
<p>Java System properties</p>
</li>
<li>
<p>one of following files on classpath, checked in order:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><code>application.yaml</code> - configuration file in YAML format</p>
</li>
<li>
<p><code>application.conf</code> - configuration file in HOCON format</p>
</li>
<li>
<p><code>application.json</code> - configuration file in JSON format</p>
</li>
<li>
<p><code>application.properties</code> - configuration file in Java Properties format</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>It uses the first and only one file that exists and there is a <code>ConfigParser</code> available
that supports appropriate configuration file format (media type).
Available parser means that the parser:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>is loaded as a service using <code>java.util.ServiceLoader</code>;</p>
</li>
<li>
<p>or if it does not exist, a config core built-in parser is used, if exists.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Every call of this method creates new object. Nor polling strategy neither retry policy are applied on created configuration.</p>
</div>
<hr>
<div class="paragraph">
<p>It is also possible to specify custom meta-configuration file(s) to load configuration from using
method <code>Config.loadSourcesFrom(meta-sources)</code>.</p>
</div>
<div class="listingblock">
<div class="title">Load configuration from sources described in meta-configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.loadSourcesFrom(           <i class="conum" data-value="1"></i><b>(1)</b>
        file(<span class="string"><span class="delimiter">&quot;</span><span class="content">conf/meta-config.yaml</span><span class="delimiter">&quot;</span></span>).optional(), <i class="conum" data-value="2"></i><b>(2)</b>
        classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">meta-config.yaml</span><span class="delimiter">&quot;</span></span>));           <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Method <code>loadSourcesFrom</code> accepts ordered list of meta configuration sources.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Load meta-configuration from file <code>conf/meta-config.yaml</code> on filesystem, if available.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>As a fallback meta-configuration can be loaded from <code>meta-config.yaml</code> file that is always part of an example application.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is also possible to initialize <code>Builder</code> using meta-configuration file(s) via
method <code>Config.loadSources(meta-sources)</code>, see below.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Meta-configuration support is in detail described in dedicated
<a href="#Config-Advanced-Config-MetaConfig">Create Config from meta-configuration</a> section.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="Config-Advanced-Config-Builder">Config Builder</h6>
<div class="paragraph">
<p>Interface <code>Config.Builder</code> allows to fully customize <code>Config</code> instance initialization.
There are several options to create <code>Builder</code> instance.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>builder()</code> - Creates new instance of <code>Builder</code> to be used to bootstrap <code>Config</code> instance.</p>
</li>
<li>
<p><code>withSources(sources&#8230;&#8203;)</code> - Creates new instance of <code>Builder</code> to be used to bootstrap <code>Config</code> instance
with specified ordered list of <code>ConfigSource</code> instances.</p>
</li>
<li>
<p><code>loadSources(meta-sources&#8230;&#8203;)</code> - Creates new instance of <code>Builder</code> to be used to bootstrap <code>Config</code> instance
with ordered list of <code>ConfigSource</code> instances loaded from specified ordered list of meta configurations.
<em>This is extended variant of <code>Config.loadSourcesFrom(meta-sources&#8230;&#8203;)</code> factory method
that returns <code>Builder</code> instead of <code>Config</code> instance.</em></p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="img/config/Config-Builder.png" alt="Config Builder factory methods" width="635" height="374">
</div>
<div class="title">Config Builder factory methods</div>
</div>
<div class="paragraph">
<p>Builder API allows to configure following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>overrides</strong> - Instance of override source (<code>OverrideSource</code>).</p>
</li>
<li>
<p><strong>sources</strong> - Instances of configuration source (<code>ConfigSource</code>).</p>
</li>
<li>
<p><strong>mappers</strong> - Ordered list of configuration node mappers (<code>ConfigMapper</code>).
It is also possible to disable (<code>disableMapperServices()</code>) loading of <code>ConfigMapperProvider</code>-s as a service.
Programmatically registered mappers or mapper providers have higher priority
over mapper providers loaded by <code>java.util.ServiceLoader</code>.</p>
</li>
<li>
<p><strong>parsers</strong> - ordered list of configuration content parsers (<code>ConfigParser</code>).
It is also possible to disable (<code>disableParserServices()</code>) loading of <code>ConfigParser</code>-s as a service.
Programmatically registered parsers have higher priority over parsers loaded by <code>java.util.ServiceLoader</code>.</p>
</li>
<li>
<p><strong>filters</strong> - ordered list of configuration value filters (<code>ConfigFilter</code>).</p>
</li>
<li>
<p><strong>token reference resolving</strong> - a resolving of reference tokens in a key can be disabled (<code>disableKeyResolving()</code>).</p>
</li>
<li>
<p><strong>caching</strong> - if can be elementary configuration value processed by filter cached (<code>disableCaching</code>).</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Using aditional <code>Builder</code> methods</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.withSources(ConfigSources.empty())
        .disableMapperServices()                                    <i class="conum" data-value="1"></i><b>(1)</b>
        .disableParserServices()                                    <i class="conum" data-value="2"></i><b>(2)</b>
        .disableCaching()                                           <i class="conum" data-value="3"></i><b>(3)</b>
        .disableKeyResolving()                                      <i class="conum" data-value="4"></i><b>(4)</b>
        .addParser(<span class="keyword">new</span> ConfigParser() {                             <i class="conum" data-value="5"></i><b>(5)</b>
            <span class="annotation">@Override</span>
            <span class="directive">public</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; getSupportedMediaTypes() {           <i class="conum" data-value="6"></i><b>(6)</b>
                <span class="keyword">return</span> <span class="predefined-type">Set</span>.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/x-java-properties</span><span class="delimiter">&quot;</span></span>);
            }
            <span class="annotation">@Override</span>
            <span class="directive">public</span> ObjectNode parse(Content content)                <i class="conum" data-value="7"></i><b>(7)</b>
                    <span class="directive">throws</span> ConfigParserException {
                ObjectNode.Builder onb = ObjectNode.builder();
                <span class="comment">//... parse content and build ObjectNode</span>
                <span class="keyword">return</span> onb.build();
            }
        })
        .addFilter(<span class="keyword">new</span> ConfigFilter() {                             <i class="conum" data-value="8"></i><b>(8)</b>
            <span class="annotation">@Override</span>
            <span class="directive">public</span> <span class="predefined-type">String</span> apply(Config.Key key, <span class="predefined-type">String</span> value) {
                <span class="keyword">return</span> key.name().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">level</span><span class="delimiter">&quot;</span></span>)
                        ? value.toUpperCase()
                        : value;
            }
        })
        .addFilter(<span class="keyword">new</span> Function&lt;Config, ConfigFilter&gt;() {           <i class="conum" data-value="9"></i><b>(9)</b>
            <span class="annotation">@Override</span>
            <span class="directive">public</span> ConfigFilter apply(Config config) {
                <span class="keyword">return</span> initFilterUsingConfig(config);
            }
        })
        .addMapper(<span class="predefined-type">Integer</span>.class, <span class="keyword">new</span> Function&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt;() { <i class="conum" data-value="10"></i><b>(10)</b>
            <span class="annotation">@Override</span>
            <span class="directive">public</span> <span class="predefined-type">Integer</span> apply(<span class="predefined-type">String</span> value) {
                <span class="keyword">return</span> <span class="predefined-type">Integer</span>.parseInt(value) + <span class="integer">1</span>;
            }
        })
        .addMapper(<span class="keyword">new</span> ConfigMapperProvider() {                     <i class="conum" data-value="11"></i><b>(11)</b>
            <span class="annotation">@Override</span>
            <span class="directive">public</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">Class</span>&lt;?&gt;, ConfigMapper&lt;?&gt;&gt; getMappers() {
                <span class="keyword">return</span> <span class="predefined-type">Map</span>.of(
                        <span class="predefined-type">Long</span>.class, customLongMapper(),
                        <span class="predefined-type">Double</span>.class, customDoubleMapper());
            }
        })
        .build();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Do not automatically load and register mapper implementations available on classpath or on module path.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Do not automatically load and register parser implementations available on classpath or on module path.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Do not cache filtered values. It means filter can return different values in time to a user.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Do not resolve references used in property keys.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Registering custom parser implementation with higher priority.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>This is custom Java Properties parser that will be used instead of built-in one.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Parser implementation loads <code>Readable Content.asReadable()</code> and using <code>ObjectNode.Builder</code> builds <code>ObjectNode</code> instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Register simple filter. This filter will be called first.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Register another filter that will be called next.
This a function that returns filter instance that can be initialized by already loaded <code>Config</code> instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>It is even possible to register mapper implementation for types with built-in support.
This <code>Integer</code> config mapper implementation has higher priority over built-in one.</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Another option how to register custom config mapper implementations is to use <code>ConfigMapperProvider</code> implementation.
It allows to register more than config mapper implementation at once.</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_config_context">Config Context</h6>
<div class="paragraph">
<p>Interface <code>Config.Context</code> is config changes support foundation API.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="img/config/Config-Context.png" alt="Config Context API" width="147" height="105">
</div>
<div class="title">Config Context API</div>
</div>
<div class="paragraph">
<p>Context is accessible via <code>Config.context()</code> method. Context instance is associated with specific <code>Config</code> node.
The interface supports:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>timestamp()</code> - Returns timestamp of the last loaded configuration.
It returns same value as the last loaded <code>Config.timestamp()</code>.</p>
</li>
<li>
<p><code>last()</code> - Returns the last loaded instance of <code>Config</code> node
related to same Config key as original config node used to get Context from - <code>node.context()</code>.
If the configuration has not been reloaded yet it returns original Config node instance.</p>
</li>
<li>
<p><code>reload()</code> - Requests reloading of whole configuration and returns new instance of Config node
related to same Config key as original config node used to get Context from - <code>node.context()</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Initial <em>filename</em> content</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">#
# Copyright (c) 2018 Oracle and/or its affiliates. All rights reserved.
#

app.greeting = Hi</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example of <code>Config.context()</code> use</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config greeting = Config.from(file(filename))
        .get(<span class="string"><span class="delimiter">&quot;</span><span class="content">app.greeting</span><span class="delimiter">&quot;</span></span>);                            <i class="conum" data-value="1"></i><b>(1)</b>
Config.Context context = greeting.context();             <i class="conum" data-value="2"></i><b>(2)</b>

<span class="keyword">assert</span> greeting.asString().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hi</span><span class="delimiter">&quot;</span></span>);                 <i class="conum" data-value="3"></i><b>(3)</b>
<span class="keyword">assert</span> greeting.timestamp().equals(context.timestamp()); <i class="conum" data-value="4"></i><b>(4)</b>
<span class="keyword">assert</span> greeting == context.last();                       <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Load configuration from <em>filename</em> and get <code>greeting</code> sub-node.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Get <code>Context</code> instance related to <code>greeting</code> config node.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Initial <code>greeting</code> property value is <code>Hi</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Timestamp of <code>greeting</code> config node is equal to <code>Context</code> timestamp because config has not been reloaded yet.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Current <code>greeting</code> node is equal to <code>Context</code> last node because config has not been reloaded yet.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Updated <em>filename</em> content</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">#
# Copyright (c) 2018 Oracle and/or its affiliates. All rights reserved.
#

app.greeting = Hello</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Configuration programatically reloaded</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">context.reload();                                          <i class="conum" data-value="1"></i><b>(1)</b>

<span class="keyword">assert</span> greeting.asString().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hi</span><span class="delimiter">&quot;</span></span>);                   <i class="conum" data-value="2"></i><b>(2)</b>
<span class="keyword">assert</span> greeting.timestamp().isBefore(context.timestamp()); <i class="conum" data-value="3"></i><b>(3)</b>
<span class="keyword">assert</span> greeting != context.last();                         <i class="conum" data-value="4"></i><b>(4)</b>
<span class="keyword">assert</span> context.last().asString().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span>);          <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Programmatically <code>reload</code> configuration.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Previously loaded config node <code>greeting</code> is still <code>Hi</code>.
Already loaded <code>Config</code> instances are not affected by configuration reloading.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Timestamp of previously loaded config node is older than the last loaded configuration (<code>Config.timestamp()</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Previously loaded config node <code>greeting</code> is different than the last loaded one.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Newly loaded <code>greeting</code> property value (available through <code>Config.last()</code>) is <code>Hello</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Config-Advanced-OverrideSources">Override Sources</h5>
<div class="sect5">
<h6 id="_overrides">Overrides</h6>
<div class="paragraph">
<p>Overrides is a feature that allow user to replace an original value with a new one. This is similar behavior as a ConfigFilter,
but the <code>overrides</code> definitions are specified as a <a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/spi/OverrideSource.html">OverrideSource</a>
with the ability to poll new content. The overridden keys can be specified with wildcards, where only existing config keys is affected
(no config nodes will be created).
Override definitions consist of pairs of the wildcard and the new value. Definitions are in java properties format
and the order is important. Every wildcard/value pair is tested one by one in specified order and the first pair,
matching the configuration key, specifies the new value.</p>
</div>
</div>
<div class="sect5">
<h6 id="_token_reference_resolving">Token reference resolving</h6>
<div class="paragraph">
<p>A token reference is a key token starting with <code>$</code> and can be enclosed between <code>{</code> and <code>}</code>, i.e. <code>$ref</code>, <code>${ref}</code>. Even a key
composed of more than one token can be referenced in another key, i.e. <code>${env.ref}</code>.</p>
</div>
<div class="paragraph">
<p>The token references may be used to declare the default values (see <code>resolving-tokens.yaml</code> below), whilst the references may be
resolved in another config source, which identifies a current environment (see <code>env.yaml</code> examples below).</p>
</div>
<div class="paragraph">
<p>Overrides then can be shared for both environment <code>test</code> and <code>prod</code>. The configuration in each environment is then overridden with
a different values using wildcards (see <code>overrides.properties</code> below).</p>
</div>
</div>
<div class="sect5">
<h6 id="_initialize_config_with_overrides">Initialize Config with overrides</h6>
<div class="paragraph">
<p>Following code explicitly loads <code>Config</code> from a set of config sources and sets overrides
from <code>overrides.properties</code> file.</p>
</div>
<div class="listingblock">
<div class="title">Initialize <code>Config</code> with override definition from <code>overrides.properties</code> file</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.builder()
        .overrides(OverrideSources.file(<span class="string"><span class="delimiter">&quot;</span><span class="content">conf/overrides.properties</span><span class="delimiter">&quot;</span></span>)) <i class="conum" data-value="1"></i><b>(1)</b>
        .sources(file(<span class="string"><span class="delimiter">&quot;</span><span class="content">conf/env.yaml</span><span class="delimiter">&quot;</span></span>),                               <i class="conum" data-value="2"></i><b>(2)</b>
                 classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">resolving-tokens.yaml</span><span class="delimiter">&quot;</span></span>))                  <i class="conum" data-value="3"></i><b>(3)</b>
        .build();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specifying of <em>overrides</em> source loaded from file on the filesystem.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A deployment specific environment configuration on the filesystem.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A default configuration with token references to the environment specific configuration.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>OverrideSources</code> provides factory methods for built-in implementations of override sources.
It is possible to load override definitions from file on <code>classpath</code>, from specified <code>file</code> path on filesystem or from HTTP <code>url</code>.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="img/config/OverrideSources.png" alt="io.j4c.config.OverrideSources" width="187" height="139">
</div>
<div class="title">io.j4c.config.OverrideSources</div>
</div>
<div class="paragraph">
<p>See <a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/OverrideSources.html">OverrideSources</a> javadoc for more information.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>overrides.properties</code> file</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">#
# Copyright (c) 2018 Oracle and/or its affiliates. All rights reserved.
#

# Override 'cert' for any _pod_ in `prod` environment    <i class="conum" data-value="1"></i><b>(1)</b>
prod.*.data.providers.*.cert = prod.crt

# Override 'cert' for any _pod_ in `test` environment    <i class="conum" data-value="2"></i><b>(2)</b>
test.*.data.providers.*.cert = test.crt

# Override 'cert' for any _pod_ in any other environment <i class="conum" data-value="3"></i><b>(3)</b>
*.*.data.providers.0.cert = another.crt</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This definition overrides any <code>providers</code> <code>cert</code> property in <code>prod</code> environment,
originally defined in <code>resolving-tokens.yaml</code> file.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This definition overrides any <code>providers</code> <code>cert</code> property in <code>test</code> environment,
originally defined in <code>resolving-tokens.yaml</code> file.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This definition is ignored on <code>test</code> environment, because the previous definition is taken.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>File <code>env.yaml</code> contains deployment deployment specific values.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>env.yaml</code> file - <code>test</code> environment</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="comment">#</span>
<span class="comment"># Copyright (c) 2017,2018 Oracle and/or its affiliates. All rights reserved.</span>
<span class="comment">#</span>

<span class="key">env</span>: <span class="string"><span class="content">test   </span></span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="key">pod</span>: <span class="string"><span class="content">qwerty </span></span><i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Example for testing environment.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>And concrete id of current <code>pod</code> the application is running on.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example <code>env.yaml</code> file - <code>prod</code> environment</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="comment">#</span>
<span class="comment"># Copyright (c) 2017,2018 Oracle and/or its affiliates. All rights reserved.</span>
<span class="comment">#</span>

<span class="key">env</span>: <span class="string"><span class="content">prod</span></span>
<span class="key">pod</span>: <span class="string"><span class="content">asdfgh</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Default application values are placed in <code>resolving-tokens.yaml</code> file on classpath.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>resolving-tokens.yaml</code> file</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="comment">#</span>
<span class="comment"># Copyright (c) 2017,2018 Oracle and/or its affiliates. All rights reserved.</span>
<span class="comment">#</span>

<span class="error">$env</span>:                                           <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="error">$pod</span>:                                       <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="key">data</span>:
            <span class="key">providers</span>:
                - <span class="string"><span class="content">name: &quot;Provider1&quot;</span></span>
                  <span class="key">class</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">this.is.my.Provider1</span><span class="delimiter">&quot;</span></span>
                  <span class="key">cert</span>: <span class="string"><span class="content">s2s.crt                 </span></span><i class="conum" data-value="3"></i><b>(3)</b>
                - <span class="string"><span class="content">name: &quot;Provider2&quot;</span></span>
                  <span class="key">class</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">this.is.my.Provider2</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Token <code>$env</code> may be resolved in any config source (see <code>env.yaml</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Token <code>$pod</code> may be resolved in any config source (see <code>env.yaml</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This value is overridden by <code>overrides.properties</code> depends on the resolving tokens <code>$env</code> and <code>$pod</code>.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Access application properties - skip <code>$env.$pod</code> prefix</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> env = config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">env</span><span class="delimiter">&quot;</span></span>).asString(); <i class="conum" data-value="1"></i><b>(1)</b>
<span class="predefined-type">String</span> pod = config.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">pod</span><span class="delimiter">&quot;</span></span>).asString(); <i class="conum" data-value="2"></i><b>(2)</b>

Config root = config.get(env).get(pod)     <i class="conum" data-value="3"></i><b>(3)</b>
        .detach();                         <i class="conum" data-value="4"></i><b>(4)</b>

<span class="keyword">assert</span> root                                <i class="conum" data-value="5"></i><b>(5)</b>
        .get(<span class="string"><span class="delimiter">&quot;</span><span class="content">data.providers.0.cert</span><span class="delimiter">&quot;</span></span>)
        .asString().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">test.crt</span><span class="delimiter">&quot;</span></span>);    <i class="conum" data-value="6"></i><b>(6)</b>

<span class="keyword">assert</span> root
        .get(<span class="string"><span class="delimiter">&quot;</span><span class="content">data.providers.1.cert</span><span class="delimiter">&quot;</span></span>)
        .exists() == <span class="predefined-constant">false</span>;                <i class="conum" data-value="7"></i><b>(7)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Read current environment id (<code>env</code>) used to resolve <code>$env</code> in key.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Read current pod instance id (<code>pod</code>) used to resolve <code>$pod</code> in key.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Get new configuration <em>root</em> (for loaded <code>env</code> and <code>pod</code> value) to be used by application later.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>It is possible to <code>detach</code> new <code>root</code> from original configuration to reset <code>$env.$pod</code> prefix from it&#8217;s key.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Use new <code>root</code> configuration to load application config properties.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Value of <code>data.providers.0.cert</code> originated in <code>resolving-tokens.yaml</code>
(where the key <code>$env.$pod.data.providers.0.cert</code> is defined as <code>s2s.crt</code> - a default value for all environments and all pods),
however a token reference resolving make in the current environment (see <code>env.yaml</code>) the entry key looks like
<code>test.qwerty.data.providers.0.cert</code>,
but <code>overrides.properties</code> overrides the value for all pods in test environment to <code>test.crt</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Value of <code>test.qwerty.data.providers.1.cert</code> does not exists, because it was never defined, see <code>resolving-tokens.yaml</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Config-Advanced-Executors">Managing Executors</h5>
<div class="paragraph">
<p><a href="#Config-MutabilitySupport">Processing configuration changes</a> is asynchronous process.
Each asynchronous task is executed using Java <code>java.util.concurrent.Executor</code> or <code>java.util.concurrent.ScheduledExecutorService</code>.
User can provide custom executor instance for individual use-cases.</p>
</div>
<div class="sect5">
<h6 id="_polling_strategy_custom_executor">Polling Strategy Custom Executor</h6>
<div class="paragraph">
<p>Scheduled polling strategy - method <code>PollingStrategies.regular(Duration)</code> returns
<a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/PollingStrategies.ScheduledBuilder.html">ScheduledBuilder</a>.
The builder allows to specify custom <code>ScheduledExecutorService</code> instance to be used to schedule polling ticks on.
By default it is a <em>new thread pool executor</em> per polling strategy instance.</p>
</div>
<div class="paragraph">
<p>Filesystem watch polling strategy - method <code>PollingStrategies.watch(Path)</code> returns
<a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/PollingStrategies.FilesystemWatchBuilder.html">FilesystemWatchBuilder</a>.
The builder allows to specify custom <code>ScheduledExecutorService</code> instance to be used to watch filesystem changes on.
By default it is a <em>new single-threaded executor</em> per polling strategy instance.</p>
</div>
<div class="listingblock">
<div class="title">Customize polling strategy executors</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">ScheduledExecutorService</span> executor = <span class="predefined-type">Executors</span>.newScheduledThreadPool(<span class="integer">2</span>); <i class="conum" data-value="1"></i><b>(1)</b>

Config config = Config.from(
        ConfigSources.file(<span class="string"><span class="delimiter">&quot;</span><span class="content">conf/dev.properties</span><span class="delimiter">&quot;</span></span>)
                .pollingStrategy(
                        PollingStrategies.regular(<span class="predefined-type">Duration</span>.ofSeconds(<span class="integer">2</span>)) <i class="conum" data-value="2"></i><b>(2)</b>
                                .executor(executor)),                    <i class="conum" data-value="3"></i><b>(3)</b>
        ConfigSources.file(<span class="string"><span class="delimiter">&quot;</span><span class="content">conf/config.properties</span><span class="delimiter">&quot;</span></span>)
                .pollingStrategy(
                        path -&gt; PollingStrategies.watch(path)            <i class="conum" data-value="4"></i><b>(4)</b>
                                .executor(executor)));                   <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Prepared a thread pool executor with core pool size set <code>2</code> to be shared by all polling strategies.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This is generic implementation of <code>PollingStrategy</code> that can be used with any config source.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Source file <code>dev.properties</code> uses regular polling strategy with custom <code>executor</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>This is config source specific implementation of <code>PollingStrategy</code>.
In this case <em>file</em> config source is customized by <em>Path</em> to configuration file.
This <em>path</em> can be used by specific polling strategy implementation.
In this case Java Filesystem <code>WatchService</code> is used to listen on set <em>Path</em>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Source file <code>config.properties</code> uses filesystem watch polling strategy with same custom <code>executor</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_sources_custom_executor">Sources Custom Executor</h6>
<div class="paragraph">
<p>Almost all built-in config sources and override sources extend common
<a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/spi/AbstractSource.html">super class</a> and are usually initialized by
extension of common source <a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/spi/AbstractSource.Builder.html">Builder</a>.
The builder allows to specify custom <em>observe-on</em> <code>Executor</code> instance to be used to deliver config or override source changes on.
The Executor is also used to process reloading of source triggered by polling strategy event.</p>
</div>
<div class="paragraph">
<p>By default dedicated thread pool that creates new threads as needed, but
will reuse previously constructed threads when they are available is used.
The dedicated thread pool is shared by any source instance even by more Config instances.</p>
</div>
<div class="paragraph">
<p>Each source subscriber has dedicated buffer for <em>changes</em> events. It is possible to customize <em>maximum capacity of the buffer</em>.
By default is <code>256</code>, see Java 9 <code>java.util.concurrent.Flow.DEFAULT_BUFFER_SIZE</code> constant.</p>
</div>
<div class="listingblock">
<div class="title">Customize config and override sources' executors</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Executor</span> executor = <span class="predefined-type">Executors</span>.newCachedThreadPool();               <i class="conum" data-value="1"></i><b>(1)</b>

Config config = Config.builder()
        .overrides(
                OverrideSources.file(<span class="string"><span class="delimiter">&quot;</span><span class="content">conf/overrides.properties</span><span class="delimiter">&quot;</span></span>)
                        .pollingStrategy(PollingStrategies::watch)
                        .changesExecutor(executor)                 <i class="conum" data-value="2"></i><b>(2)</b>
                        .changesMaxBuffer(<span class="integer">4</span>))                      <i class="conum" data-value="3"></i><b>(3)</b>
        .sources(
                ConfigSources.file(<span class="string"><span class="delimiter">&quot;</span><span class="content">conf/env.yaml</span><span class="delimiter">&quot;</span></span>)
                        .pollingStrategy(PollingStrategies::watch)
                        .changesExecutor(executor)                 <i class="conum" data-value="4"></i><b>(4)</b>
                        .changesMaxBuffer(<span class="integer">4</span>))                      <i class="conum" data-value="4"></i><b>(4)</b>
        .build();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Prepared a thread pool executor to be shared by all sources.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Override source file <code>overrides.properties</code> process file reloading on custom <code>executor</code>.
Source subscribers are also notified about source changes using the executor.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Subscriber&#8217;s buffer is shorten to just <code>4</code> events. Not consumed events will be dropped off.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Config source file <code>env.yaml</code> uses same <code>executor</code> as well as buffer capacity.</td>
</tr>
</table>
</div>
<div class="sect6">
<h7 id="_composite_config_source_executor">Composite Config Source Executor</h7>
<div class="paragraph">
<p>In case a Config is built from a list of more than 1 config sources it is automatically covered into composite config source.
Composite config source listens on each aggregated config source changes to be able to delegate a change event further.
I.e. similar attributes as for common config source needs to be set.</p>
</div>
<div class="paragraph">
<p>In such case a user needs to create instance of <a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/ConfigSources.CompositeBuilder.html">CompositeBuilder</a>.
The builder allows to specify custom <code>ScheduledExecutorService</code> instance to be used to execute config source reloading on.
By default dedicated thread pool is used. The pool is shared by each composite source instance even by more Config instances.</p>
</div>
<div class="paragraph">
<p>It is also possible to specifies debounce timeout for reloading composite config source in case any of aggregated config sources has changed.
Debouncing reduces number of change events published by <code>ConfigSource.changes()</code> because
it aggregates series of particular sub-events into single one.
Just in case there is no new sub-event during specified <em>debounce timeout</em> the reloading is processed
and aggregated event is published. By default <code>100</code> milliseconds is used.</p>
</div>
<div class="listingblock">
<div class="title">Customize composite source executors</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">ScheduledExecutorService</span> executor = <span class="predefined-type">Executors</span>.newScheduledThreadPool(<span class="integer">1</span>);       <i class="conum" data-value="1"></i><b>(1)</b>

Config config = Config.from(
        ConfigSources.from(file(<span class="string"><span class="delimiter">&quot;</span><span class="content">conf/dev.properties</span><span class="delimiter">&quot;</span></span>)                         <i class="conum" data-value="2"></i><b>(2)</b>
                                   .pollingStrategy(PollingStrategies::watch),
                           file(<span class="string"><span class="delimiter">&quot;</span><span class="content">conf/config.properties</span><span class="delimiter">&quot;</span></span>)                      <i class="conum" data-value="2"></i><b>(2)</b>
                                   .pollingStrategy(PollingStrategies::watch))
                .changesExecutor(executor)                                     <i class="conum" data-value="3"></i><b>(3)</b>
                .changesMaxBuffer(<span class="integer">4</span>)                                           <i class="conum" data-value="4"></i><b>(4)</b>
                .changesDebounce(<span class="predefined-type">Duration</span>.ofSeconds(<span class="integer">1</span>)));                      <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Prepared a thread pool executor.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Method <code>ConfigSources.from(Supplier&lt;ConfigSource&gt;&#8230;&#8203;)</code> accepts list of particular config source.
In this case it create composite config source from two file sources (<code>dev.properties</code> and <code>config.properties</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Composite config source uses specified <code>executor</code> to process changes events from <code>dev.properties</code> or <code>config.properties</code> on.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Subscriber&#8217;s buffer is shorten to just <code>4</code> events. Not consumed events will be dropped off.
(Again, default buffer capacity is <code>256</code>.)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Changes event will not be fire more than one per a second.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_config_custom_executor">Config Custom Executor</h6>
<div class="paragraph">
<p>And finally Config instance is subscribed on appropriate override and/or config sources changes.
A <a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/Config.Builder.html">Config.Builder</a> it allows to specify custom <em>observe-on</em> <code>Executor</code> instance
to be used to deliver config changes events to a subscriber on.
The Executor is also used to process changes events form it&#8217;s sources.</p>
</div>
<div class="paragraph">
<p>By default dedicated thread pool that creates new threads as needed,
but will reuse previously constructed threads when they are available is used.
The dedicated thread pool is shared by any config instance.</p>
</div>
<div class="paragraph">
<p>Each source subscriber has dedicated buffer for <em>changes</em> events. It is possible to customize <em>maximum capacity of the buffer</em>.
By default is <code>256</code>, see Java 9 <code>java.util.concurrent.Flow.DEFAULT_BUFFER_SIZE</code> constant.</p>
</div>
<div class="listingblock">
<div class="title">Customize config executor</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Executor</span> executor = <span class="predefined-type">Executors</span>.newCachedThreadPool();        <i class="conum" data-value="1"></i><b>(1)</b>

Config config = Config.withSources(
        file(<span class="string"><span class="delimiter">&quot;</span><span class="content">conf/config.properties</span><span class="delimiter">&quot;</span></span>)
                .pollingStrategy(PollingStrategies::watch))
        .changesExecutor(executor)                          <i class="conum" data-value="2"></i><b>(2)</b>
        .changesMaxBuffer(<span class="integer">16</span>)                               <i class="conum" data-value="3"></i><b>(3)</b>
        .build();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Prepared a thread pool executor.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Config uses specified <code>executor</code> to process changes events on as well as to notify subscribers on.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Subscriber&#8217;s buffer is shorten to just <code>16</code> events. Not consumed events will be dropped off.</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_retry_policy_custom_executor">Retry Policy Custom Executor</h6>
<div class="paragraph">
<p>The method <code>RetryPolicies.repeat(int retries)</code> returns <a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/RetryPolicies.Builder.html">RetryPolicies.Builder</a>.
The builder allows to specify a custom <code>ScheduledExecutorService</code> instance to be used to schedule and execute delayed retries.
By default it is a <em>new thread pool executor</em> per retry policy instance.</p>
</div>
<div class="listingblock">
<div class="title">Customize retry policy executors</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">ScheduledExecutorService</span> executor = <span class="predefined-type">Executors</span>.newScheduledThreadPool(<span class="integer">2</span>, myThreadFactory); <i class="conum" data-value="1"></i><b>(1)</b>

Config config = Config.from(
        ConfigSources.file(<span class="string"><span class="delimiter">&quot;</span><span class="content">conf/dev.properties</span><span class="delimiter">&quot;</span></span>)                                         <i class="conum" data-value="2"></i><b>(2)</b>
                .optional()                                                               <i class="conum" data-value="3"></i><b>(3)</b>
                .retryPolicy(RetryPolicies.repeat(<span class="integer">2</span>)                                      <i class="conum" data-value="4"></i><b>(4)</b>
                        .executor(executor)));                                            <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Prepared a thread pool executor with core pool size set <code>2</code> and custom <code>java.util.concurrent.ThreadFactory</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The built-in config source loading a content from file.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>When the source is flagged as <code>optional()</code>, the loading attempt will be repeated as the retry policy defines,
but an overall fail does not lead to failing initial load (or polled when configured).</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>This is a built-in implementation of <code>RetryPolicy</code> that can be used with any config source, but typically for that ones where
the repeating might help.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Source uses a retry policy with custom <code>executorService</code>.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Config-SPI">2.2.8. How to extend Configuration functionality (SPI)</h4>
<div class="paragraph">
<p>Configuration SPI allows to enhance Config functionality. It supports following extension points:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ConfigSource</code> - allows to implement custom mechanism to load configuration raw data from any source.</p>
</li>
<li>
<p><code>ConfigParser</code> - allows to provide a custom configuration format parser.</p>
</li>
<li>
<p><code>OverrideSource</code> - allows to implementing a custom mechanism to load override definitions from any source.</p>
</li>
<li>
<p><code>ConfigFilter</code> - allows to filter configuration values before it will accessible via Config API.</p>
</li>
<li>
<p><code>ConfigMapperProvider</code> - allows to register custom ConfigMapper implementations.</p>
</li>
<li>
<p><code>PollingStrategy</code> - allows to implement own policy for polling config or overrides source to load changed config data.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="Config-SPI-ConfigSource">ConfigSource SPI</h5>
<div class="paragraph">
<p><a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/spi/ConfigSource.html">ConfigSource</a> SPI allows to implement custom mechanism to load configuration
raw data from any source.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="img/config/spi-ConfigSource.png" alt="ConfigSource SPI" width="909" height="521">
</div>
<div class="title">ConfigSource SPI</div>
</div>
<div class="paragraph">
<p>Interface <code>ConfigNode</code> and extension interfaces <code>ObjectNode</code>, <code>ValueNode</code> and <code>ListNode</code> represents
internal model of loaded configuration data.</p>
</div>
</div>
<div class="sect4">
<h5 id="Config-SPI-ConfigParser">ConfigParser SPI</h5>
<div class="paragraph">
<p><a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/spi/ConfigParser.html">ConfigParser</a> SPI allows to provide a custom configuration format parser.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="img/config/spi-ConfigParser.png" alt="ConfigParser SPI" width="444" height="118">
</div>
<div class="title">ConfigParser SPI</div>
</div>
<div class="paragraph">
<p>Interface <code>ConfigParser.Content</code> represents content to be parsed by <code>ConfigParser</code> implementation
into internal model <code>ObjectNode</code>.</p>
</div>
<div class="paragraph">
<p>Parsers are programmatically registered (<code>Config.Builder#addParser(ConfigParser)</code>)
and / or automatically loaded as a <code>ServiceLoader</code> services if not
disabled by calling <code>Config.Builder#disableParserServices()</code>.</p>
</div>
<div class="paragraph">
<p>A parser can specify a <code>@javax.annotation.Priority</code>.
If no priority is explicitly assigned, the value of <code>100</code> is assumed.</p>
</div>
<div class="listingblock">
<div class="title">Reference custom parser implementation in <code>META-INF/services/io.j4c.config.spi.ConfigParser</code></div>
<div class="content">
<pre class="CodeRay highlight"><code>myModule.MyConfigParser</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Reference custom parser implementation in <code>module-info.java</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">module myModule {
    requires transitive io.j4c.config;
    provides io.j4c.config.spi.ConfigParser with myModule.MyConfigParser;
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Config-SPI-OverrideSource">OverrideSource SPI</h5>
<div class="paragraph">
<p><a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/spi/OverrideSource.html">OverrideSource</a> SPI allows to implementing
a custom mechanism to load override definitions from any source.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="img/config/spi-OverrideSource.png" alt="OverrideSource SPI" width="431" height="79">
</div>
<div class="title">OverrideSource SPI</div>
</div>
</div>
<div class="sect4">
<h5 id="Config-SPI-ConfigFilter">ConfigFilter SPI</h5>
<div class="paragraph">
<p><a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/spi/ConfigFilter.html">ConfigFilter</a> SPI allows to filter each configuration elementary (<code>String</code>)
values before it will accessible via <code>Config</code> API.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="img/config/spi-ConfigFilter.png" alt="ConfigFilter SPI" width="296" height="79">
</div>
<div class="title">ConfigFilter SPI</div>
</div>
<div class="paragraph">
<p>Filters are programmatically registered by calling <code>Config.Builder#addFilter(ConfigFilter)</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="Config-SPI-ConfigMapperProvider">ConfigMapperProvider SPI</h5>
<div class="paragraph">
<p><a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/spi/ConfigMapperProvider.html">ConfigMapperProvider</a> SPI allows to register custom <code>ConfigMapper</code>
implementations to map a configuration node to a Java type.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="img/config/spi-ConfigMapperProvider.png" alt="ConfigMapperProvider SPI" width="498" height="86">
</div>
<div class="title">ConfigMapperProvider SPI</div>
</div>
<div class="paragraph">
<p>Mappers are programmatically registered (<code>Config.Builder addMapper(Class&lt;T&gt; type, ConfigMapper&lt;T&gt; mapper)</code>)
and / or automatically loaded as a <code>ServiceLoader</code> services via <code>ConfigMapperProvider</code> SPI
if not disabled by calling <code>Config.Builder#disableMapperServices()</code>.</p>
</div>
<div class="paragraph">
<p>A mapper provider can specify a <code>@javax.annotation.Priority</code>.
If no priority is explicitly assigned, the value of <code>100</code> is assumed.</p>
</div>
<div class="listingblock">
<div class="title">Reference custom mapper provider implementation in <code>META-INF/services/io.j4c.config.spi.ConfigMapperProvider</code></div>
<div class="content">
<pre class="CodeRay highlight"><code>myModule.MyConfigMapperProvider</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Reference custom mapper provider implementation in <code>module-info.java</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">module myModule {
    requires transitive io.j4c.config;
    provides io.j4c.config.spi.ConfigMapperProvider with myModule.MyConfigMapperProvider;
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Config-SPI-PollingStrategy">PollingStrategy SPI</h5>
<div class="paragraph">
<p><a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/spi/PollingStrategy.html">PollingStrategy</a> SPI allows user to implement own policy
for polling <code>ConfigSource</code>(s) to load changed config data.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="img/config/spi-PollingStrategy.png" alt="PollingStrategy SPI" width="461" height="79">
</div>
<div class="title">PollingStrategy SPI</div>
</div>
<div class="paragraph">
<p><code>PollingStrategy</code> provides a <code>ticks()</code> of <code>PollingEvent</code>-s that are fired every time when
implementation of <code>PollingStrategy</code> decides. The event can be interpreted as
<em>"it is a time to check if the config source has changed"</em>.</p>
</div>
<div class="paragraph">
<p><code>PollingStrategy</code> must be supported by config source implementation. Abstract class <code>AbstractConfigSource</code> supports it.</p>
</div>
</div>
<div class="sect4">
<h5 id="Config-SPI-RetryPolicy">RetryPolicy SPI</h5>
<div class="paragraph">
<p><a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/spi/RetryPolicy.html">RetryPolicy</a> SPI allows user implementing own policy
for retrying <code>ConfigSource</code>(s) or <code>OverriddenSource</code>(s) to load from source when the loading fails.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="img/config/spi-RetryPolicy.png" alt="RetryPolicy SPI" width="299" height="92">
</div>
<div class="title">RetryPolicy SPI</div>
</div>
<div class="paragraph">
<p><code>RetryPolicy SPI</code> method <code>execute()</code> should execute the provided <code>Supplier&lt;T&gt;</code> as many times as the implementation should.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The first call, that is not technically 'a retry', should be handled by every implementation. The default implementation is
<code>RetryPolicies.justCall()</code> that is literally implemented as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>@Override
public &lt;T&gt; T execute(Supplier&lt;T&gt; call) {
    return call.get();
}</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An overall execution of <code>RetryPolicy</code> can be canceled by calling the method <code>boolean cancel(boolean mayInterruptIfRunning)</code>,
that implementation should provide a way how to cancel the execution of the retry policy, even the running load. The result
may be <code>true</code> when the cancelling was successful or <code>false</code> when the cancelling failed. The reason might be that task is already
done or cancelled).
]</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_extension_modules">2.2.9. Configuration Extension modules</h4>
<div class="paragraph">
<p>Configuration provides several extension modules that supports other configuration formats (parsers) and sources.</p>
</div>
<div class="sect4">
<h5 id="Config-ModuleYaml">YAML Configuration Parser</h5>
<div class="paragraph">
<p>YAML module implements Config Parser of sources in YAML format.</p>
</div>
<div class="sect5">
<h6 id="_coordinates_4">Coordinates</h6>
<div class="paragraph">
<p>YAML format support is covered by <code>yaml</code> module.</p>
</div>
<div class="listingblock">
<div class="title">Config Yaml Dependency in <code>pom.xml</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>io.j4c.config<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>j4c-config-yaml<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Config Yaml Dependency in <code>module-info.java</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">module myModule {
    requires io.j4c.config.yaml;
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_using_yaml_parser">Using YAML Parser</h6>
<div class="paragraph">
<p>The parser implementation supports Java <code>ServiceLoader</code>, i.e. <code>Config.Builder</code> can automatically load
and register YAML ConfigParser instance, if not disabled.
Priority of the parser to be used by <code>Config.Builder</code>, if loaded automatically as a service, is <code>200</code>.</p>
</div>
<div class="paragraph">
<p>The parser is used to parse following media types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>application/x-yaml</code> - YAML format</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">YAML Parser is automatically registered and used because of <code>.yaml</code> extension</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.from(classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">application.yaml</span><span class="delimiter">&quot;</span></span>)); <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>If config source file, uri or resource name ends with <code>.yaml</code> it is recognized as <code>application/x-yaml</code> type.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Specify parser used to parse appropriate config source</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.from(classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">my-config</span><span class="delimiter">&quot;</span></span>)                                    <i class="conum" data-value="1"></i><b>(1)</b>
                                    .parser(YamlConfigParserBuilder.buildDefault())); <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Unknown media type of source named <code>my-config</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Classpath file <code>my-config</code> will be parsed by registered YAML parser instance created by
<a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/yaml/YamlConfigParserBuilder.html">YamlConfigParserBuilder</a>.
Method <code>buildDefault()</code> creates config parser with default behaviour which is same as loaded by <code>ServiceLoader</code>.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Specify media type of appropriate config source</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.from(classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">my-config</span><span class="delimiter">&quot;</span></span>)                     <i class="conum" data-value="1"></i><b>(1)</b>
                                    .mediaType(<span class="string"><span class="delimiter">&quot;</span><span class="content">application/x-yaml</span><span class="delimiter">&quot;</span></span>)); <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Unknown media type of source named <code>my-config</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Classpath file <code>my-config</code> has specified media type and will be parsed by
globally registered parser that supports <code>application/x-yaml</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In cases an application disables automatic global parser registrations it is necessary to explicitly register
parser instance within <code>Config.Builder</code>.</p>
</div>
<div class="listingblock">
<div class="title">Register YAML parser wintin <code>Config.Builder</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.withSources(classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">application.yaml</span><span class="delimiter">&quot;</span></span>))
        .disableParserServices()                                  <i class="conum" data-value="1"></i><b>(1)</b>
        .addParser(YamlConfigParserBuilder.buildDefault())        <i class="conum" data-value="2"></i><b>(2)</b>
        .build();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Disables automatic parser lookup and registration.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Explicit registration of YAML parser.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Config-ModuleHocon">HOCON/JSON Configuration Parser</h5>
<div class="paragraph">
<p>HOCON module implements Config Parser of sources in HOCON (Typesafe Config) and JSON formats.</p>
</div>
<div class="sect5">
<h6 id="_coordinates_5">Coordinates</h6>
<div class="paragraph">
<p>HOCON and JSON format support is covered by <code>hocon</code> module.</p>
</div>
<div class="listingblock">
<div class="title">Config Hocon Dependency in <code>pom.xml</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>io.j4c.config<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>j4c-config-hocon<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Config Hocon Dependency in <code>module-info.java</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">module myModule {
    requires io.j4c.config.hocon;
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_using_hocon_json_parser">Using HOCON/JSON Parser</h6>
<div class="paragraph">
<p>The parser implementation supports Java <code>ServiceLoader</code>, i.e. <code>Config.Builder</code> can automatically load
and register HOCON ConfigParser instance, if not disabled.
Priority of the parser to be used by <code>Config.Builder</code>, if loaded automatically as a service, is <code>200</code>.</p>
</div>
<div class="paragraph">
<p>The parser is used to parse following media types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>application/hocon</code> - HOCON format</p>
</li>
<li>
<p><code>application/json</code> - JSON format</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">HOCON Parser is automatically registered and used because of <code>.conf</code> extension</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.from(classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">application.conf</span><span class="delimiter">&quot;</span></span>)); <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>If config source file, uri or resource name ends with <code>.conf</code> it is recognized as <code>application/hocon</code> type.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If config source file, uri or resource name ends with <code>.json</code> it is recognized as <code>application/json</code> type.</p>
</div>
<div class="listingblock">
<div class="title">Specify parser used to parse appropriate config source</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.from(classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">my-config</span><span class="delimiter">&quot;</span></span>)                                     <i class="conum" data-value="1"></i><b>(1)</b>
                                    .parser(HoconConfigParserBuilder.buildDefault())); <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Unknown media type of source named <code>my-config</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Classpath file <code>my-config</code> will be parsed by registered HOCON parser instance created by
<a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/hocon/HoconConfigParserBuilder.html">HoconConfigParserBuilder</a>.
Method <code>buildDefault()</code> creates config parser with default behaviour which is same as loaded by <code>ServiceLoader</code>.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Specify media type of appropriate config source</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.from(classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">my-config</span><span class="delimiter">&quot;</span></span>)                    <i class="conum" data-value="1"></i><b>(1)</b>
                                    .mediaType(<span class="string"><span class="delimiter">&quot;</span><span class="content">application/hocon</span><span class="delimiter">&quot;</span></span>)); <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Unknown media type of source named <code>my-config</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Classpath file <code>my-config</code> has specified media type and will be parsed by
globally registered parser that supports <code>application/hocon</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In cases an application disables automatic global parser registrations it is necessary to explicitly register
parser instance within <code>Config.Builder</code>.</p>
</div>
<div class="listingblock">
<div class="title">Register HOCON parser wintin <code>Config.Builder</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.withSources(classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">application.conf</span><span class="delimiter">&quot;</span></span>))
        .disableParserServices()                                  <i class="conum" data-value="1"></i><b>(1)</b>
        .addParser(HoconConfigParserBuilder.buildDefault())       <i class="conum" data-value="2"></i><b>(2)</b>
        .build();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Disables automatic parser lookup and registration.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Explicit registration of HOCON parser.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The builder allows to customize HOCON parser.</p>
</div>
<div class="listingblock">
<div class="title">Customize HOCON parser behaviour</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.withSources(classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">application.conf</span><span class="delimiter">&quot;</span></span>))
        .disableParserServices()
        .addParser(HoconConfigParserBuilder.create()              <i class="conum" data-value="1"></i><b>(1)</b>
                           .disableResolving()                    <i class="conum" data-value="2"></i><b>(2)</b>
                           .build())                              <i class="conum" data-value="3"></i><b>(3)</b>
        .build();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creates new instance of the builder.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Disables substitutions resolving,
see <a href="https://github.com/typesafehub/config/blob/master/HOCON.md#substitutions">HOCON documentation</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Build new instance of HOCON Config Parser.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is also possible to specify
<a href="https://typesafehub.github.io/config/latest/api/com/typesafe/config/ConfigResolveOptions.html">ConfigResolveOptions</a>
via <code>HoconConfigParserBuilder</code>, method <code>resolveOptions</code>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Config-ModuleEtcd">Etcd Configuration Source</h5>
<div class="paragraph">
<p>Etcd module implements Config Source to read configuration document from specified Etcd key.</p>
</div>
<div class="sect5">
<h6 id="_coordinates_6">Coordinates</h6>
<div class="paragraph">
<p>Etcd support is covered by <code>etcd</code> module.</p>
</div>
<div class="listingblock">
<div class="title">Config Etcd Dependency in <code>pom.xml</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>io.j4c.config<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>j4c-config-etcd<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Config Etcd Dependency in <code>module-info.java</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">module myModule {
    requires io.j4c.config.etcd;
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_using_etcd_config_source">Using Etcd Config Source</h6>
<div class="paragraph">
<p>Using <a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/etcd/EtcdConfigSourceBuilder.html">EtcdConfigSourceBuilder</a> initializes Etcd config source.</p>
</div>
<div class="listingblock">
<div class="title">Use Etcd config source</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.from(
        EtcdConfigSourceBuilder                             <i class="conum" data-value="1"></i><b>(1)</b>
                .from(<span class="predefined-type">URI</span>.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://my-etcd:2379</span><span class="delimiter">&quot;</span></span>),    <i class="conum" data-value="2"></i><b>(2)</b>
                      <span class="string"><span class="delimiter">&quot;</span><span class="content">/config.yaml</span><span class="delimiter">&quot;</span></span>,                       <i class="conum" data-value="3"></i><b>(3)</b>
                      EtcdConfigSourceBuilder.EtcdApi.v3)); <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use factory method <code>EtcdConfigSourceBuilder.from</code> to initialize builder.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Etcd endpoint address.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Etcd key of loaded document to be parsed later.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Version of Etcd API, <code>v2</code> and <code>v3</code> are supported.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="#Config-ModuleYaml">YAML Parser</a> will be automatically used in this example
because <code>.yaml</code> extension of loaded key.</p>
</div>
<div class="paragraph">
<p>The <code>EtcdConfigSourceBuilder</code> supports all common initialization properties because it extends
<a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/spi/AbstractParsableConfigSource.Builder.html">AbstractParsableConfigSource.Builder</a>
as all built-in sources does.</p>
</div>
</div>
<div class="sect5">
<h6 id="_watching_on_source_changes">Watching on Source Changes</h6>
<div class="listingblock">
<div class="title">Use Etcd config source</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.from(
        EtcdConfigSourceBuilder
                .from(<span class="predefined-type">URI</span>.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://my-etcd:2379</span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">/config.yaml</span><span class="delimiter">&quot;</span></span>, EtcdApi.v3)
                .pollingStrategy(EtcdWatchPollingStrategy::<span class="keyword">new</span>));                    <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>EtcdWatchPollingStrategy</code> as source <code>pollingStrategy</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_load_from_meta_configuration">Load from meta-configuration</h6>
<div class="paragraph">
<p>The config source provides <a href="#Config-Advanced-Config-MetaConfig">meta-configuration</a> support.</p>
</div>
<div class="paragraph">
<p>Set <code>type</code> to <code>etcd</code> in this case. <em>(Or <code>class</code> to <code>io.j4c.config.etcd.EtcdConfigSourceBuilder</code> instead)</em>
The config source supports following Etcd specific <code>properties</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>uri</code> (type <code>URI</code>) - Etcd endpoint URI.</p>
</li>
<li>
<p><code>key</code> (type <code>String</code>) - Etcd key that is associated to value with configuration.</p>
</li>
<li>
<p><code>api</code> (type <code>EtcdConfigSourceBuilder.EtcdApi</code>, i.e. <code>v2</code> or <code>v3</code>) - Etcd API version.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All of these are mandatory.
Other optional <code>properties</code> are inherited from <code>AbstractParsableConfigSource.Builder</code>, see
<a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/spi/AbstractParsableConfigSource.Builder.html#init-io.j4c.config.Config-">javadoc</a>.</p>
</div>
<div class="listingblock">
<div class="title">Load Config from meta-configuration <code>config-meta-etcd.yaml</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.loadSourcesFrom(classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">config-meta-etcd.yaml</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Loads configuration from meta-configuration file in YAML format.</p>
</div>
<div class="listingblock">
<div class="title">Etcd config source meta-configuration <code>config-meta-etcd.yaml</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="YAML"><span class="comment">#</span>
<span class="comment"># Copyright (c) 2017,2018 Oracle and/or its affiliates. All rights reserved.</span>
<span class="comment">#</span>

<span class="key">sources</span>:
    - <span class="string"><span class="content">type: &quot;etcd&quot;                                                 </span></span><i class="conum" data-value="1"></i><b>(1)</b>
      <span class="key">properties</span>:
          <span class="key">uri</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://my-etcd:2379</span><span class="delimiter">&quot;</span></span>                               <i class="conum" data-value="2"></i><b>(2)</b>
          <span class="key">key</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/config.yaml</span><span class="delimiter">&quot;</span></span>                                      <i class="conum" data-value="2"></i><b>(2)</b>
          <span class="key">api</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">v3</span><span class="delimiter">&quot;</span></span>                                                <i class="conum" data-value="2"></i><b>(2)</b>
          <span class="key">polling-strategy</span>:
              <span class="key">class</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">io.j4c.config.etcd.EtcdWatchPollingStrategy</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configuring <code>etcd</code> config source.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Etcd source specific (mandatory) <code>properties</code>: <code>uri</code>, <code>key</code> and <code>api</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Polling strategy <code>EtcdWatchPollingStrategy</code> is automatically initialized by specified mandatory <code>properties</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Config-ModuleGit">Git Configuration Source</h5>
<div class="paragraph">
<p>Git module implements Config Source to read a configuration file from a git repository.</p>
</div>
<div class="sect5">
<h6 id="_coordinates_7">Coordinates</h6>
<div class="paragraph">
<p>Git support is covered by <code>git</code> module.</p>
</div>
<div class="listingblock">
<div class="title">Config Git Dependency in <code>pom.xml</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>io.j4c.config<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>j4c-config-git<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Config Git Dependency in <code>module-info.java</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">module myModule {
    requires io.j4c.config.git;
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_using_git_config_source">Using Git Config Source</h6>
<div class="paragraph">
<p>Using <a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/git/GitConfigSourceBuilder.html">GitConfigSourceBuilder</a> initializes Git config source.</p>
</div>
<div class="listingblock">
<div class="title">Use of git config source</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.from(
        GitConfigSourceBuilder
                .from(<span class="string"><span class="delimiter">&quot;</span><span class="content">application.conf</span><span class="delimiter">&quot;</span></span>)                                           <i class="conum" data-value="1"></i><b>(1)</b>
                    .uri(<span class="predefined-type">URI</span>.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">https://github.com/okosatka/test-config.git</span><span class="delimiter">&quot;</span></span>)) <i class="conum" data-value="2"></i><b>(2)</b>
                    .directory(Paths.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">/config</span><span class="delimiter">&quot;</span></span>))                                <i class="conum" data-value="3"></i><b>(3)</b>
                    .branch(<span class="string"><span class="delimiter">&quot;</span><span class="content">dev</span><span class="delimiter">&quot;</span></span>));                                                <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use factory method <code>GitConfigSourceBuilder.from</code> to initialize the builder with a mandatory relative path to the configuration file.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Git repository URI.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A directory where the git repository is already cloned or it will be cloned.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>A git branch.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="#Config-ModuleHocon">HOCON Parser</a> will be automatically used in this example
because <code>.conf</code> extension of loaded key.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The HOCON module must be on module-path/classpath.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>GitConfigSourceBuilder</code> supports all common initialization properties because it extends
<a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/spi/AbstractParsableConfigSource.Builder.html">AbstractParsableConfigSource.Builder</a>
as all built-in sources does.</p>
</div>
</div>
<div class="sect5">
<h6 id="_polling_the_config_source">Polling the Config Source</h6>
<div class="listingblock">
<div class="title">Use of git config source with polling strategy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.from(
        GitConfigSourceBuilder
                .from(<span class="string"><span class="delimiter">&quot;</span><span class="content">application.conf</span><span class="delimiter">&quot;</span></span>)
                .uri(<span class="predefined-type">URI</span>.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">https://github.com/okosatka/test-config.git</span><span class="delimiter">&quot;</span></span>))
                .pollingStrategy(PollingStrategies.regular(<span class="predefined-type">Duration</span>.ofMinutes(<span class="integer">5</span>)))); <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>PollingStrategies.regular(Duration duration)</code> as a source <code>pollingStrategy</code>.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
An <a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/spi/PollingStrategy.html">SPI</a> allows implementing a custom polling strategy.
See <a href="#Config-MutabilitySupport">mutability support chapter</a> and <a href="#Config-SPI">SPI chapter</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_load_from_meta_configuration_2">Load from meta-configuration</h6>
<div class="paragraph">
<p>The config source provides <a href="#Config-Advanced-Config-MetaConfig">meta-configuration</a> support.</p>
</div>
<div class="paragraph">
<p>Set <code>type</code> to <code>git</code> in this case. <em>(Or <code>class</code> to <code>io.j4c.config.git.GitConfigSourceBuilder</code> instead)</em>
The config source supports following Git specific <code>properties</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>path</code> (type <code>String</code>) - Relative path to the configuration file in repository.</p>
</li>
<li>
<p><code>uri</code> (type <code>URI</code>) - URI to the Git repository.</p>
</li>
<li>
<p><code>directory</code> (type <code>Path</code>) - Directory with a cloned repository, by default it is a temporary directory.</p>
</li>
<li>
<p><code>branch</code> (type <code>String</code>) - Git branch, a default value is <code>master</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Property <code>path</code> is mandatory. And one of <code>uri</code> or <code>directory</code> property must be set.
Other optional <code>properties</code> are inherited from <code>AbstractParsableConfigSource.Builder</code>, see
<a href="http://sca00jue.us.oracle.com/j4c/apidocs/index.html?io/j4c/config/spi/AbstractParsableConfigSource.Builder.html#init-io.j4c.config.Config-">javadoc</a>.</p>
</div>
<div class="listingblock">
<div class="title">Load Config from meta-configuration <code>config-meta-git.yaml</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = Config.loadSourcesFrom(classpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">config-meta-git.yaml</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Loads configuration from meta-configuration file in YAML format.</p>
</div>
<div class="listingblock">
<div class="title">Git config source meta-configuration <code>config-meta-git.yaml</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="YAML"><span class="comment">#</span>
<span class="comment"># Copyright (c) 2017,2018 Oracle and/or its affiliates. All rights reserved.</span>
<span class="comment">#</span>

<span class="key">sources</span>:
    - <span class="string"><span class="content">type: &quot;git&quot;                                            </span></span><i class="conum" data-value="1"></i><b>(1)</b>
      <span class="key">properties</span>:
          <span class="key">path</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">application.conf</span><span class="delimiter">&quot;</span></span>                           <i class="conum" data-value="2"></i><b>(2)</b>
          <span class="key">uri</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://github.com/okosatka/test-config.git</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="2"></i><b>(2)</b>
          <span class="key">directory</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/config</span><span class="delimiter">&quot;</span></span>                               <i class="conum" data-value="2"></i><b>(2)</b>
          <span class="key">branch</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">dev</span><span class="delimiter">&quot;</span></span>                                      <i class="conum" data-value="2"></i><b>(2)</b>
          <span class="key">polling-strategy</span>:
              <span class="key">type</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">regular</span><span class="delimiter">&quot;</span></span>                                <i class="conum" data-value="3"></i><b>(3)</b>
              <span class="key">properties</span>:
                  <span class="key">interval</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">PT5M</span><span class="delimiter">&quot;</span></span>                           <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configuring <code>git</code> config source.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Git source specific <code>properties</code>: <code>path</code>, <code>uri</code>, <code>directory</code> and <code>branch</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Generic <code>regular</code> polling strategy that accepts <code>interval</code> property, in <code>Duration</code> format.
Value <code>PT5M</code> means <code>5 minutes</code> interval.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cloud_security">2.3. Cloud Security</h3>
<div class="paragraph">
<p>Cloud Security provides the following features</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Authentication - support for authenticating incoming requests, creating a security Subject with Principals representing current
user/service. The responsibility to create a principal and subject lies with AuthenticationProvider SPI.
The following Principals are expected and supported out of the box:</p>
</li>
<li>
<p>UserPrincipal - the party is an end-user (e.g. a person) - there can be zero to one user principals in a subject</p>
</li>
<li>
<p>ServicePrincipal - the party is a service (e.g. a computer program) - there can be zero to one service principals in a subject</p>
</li>
<li>
<p>RolePrincipal - the party acts in a role (e.g. "admin", "user", "manager") - there can be more than one role in a subject</p>
</li>
<li>
<p>Authorization - support for authorizing incoming requests. Out-of-the-box the security module support role based access control
(RBAC) through RolePrincipal (in case the authenticated user has a RolePrincipal in Subject, he/she is considered to be in that
role). Other approaches to authorization are handled through AuthorizationProvider SPI.</p>
</li>
<li>
<p>Outbound security - support for propagating identity or (in general) securing outbound requests. Modification of a request
to include outbound security is responsibility of OutboundSecurityProvider SPI</p>
</li>
<li>
<p>Audit - security module audits most important events through its own API (e.g. Authentication events, Authorization events,
outbound security events). A default AuditProvider is provided as well, logging to Java util logging (JUL) logger called
"AUDIT" (may be overriden through configuration). AuditProvider SPI may be implemented to support other auditing options.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Security module is quite HTTP centric (as most common use cases are related to HTTP REST), though it is not HTTP specific (the
security module may be used to secure even other transports, such as JMS, Kafka messages etc. if an appropriate integration module
is developed, as all APIs can be mapped to a non-HTTP protocol).
Nevertheless there may be security providers that only make sense with HTTP (such as HTTP digest authentication).</p>
</div>
<div class="sect3">
<h4 id="_how_to_use">2.3.1. How to use</h4>
<div class="paragraph">
<p>To integrate with a container, or to use Cloud Security standalone, we must create an instance
of security.
In general, Cloud Security supports two approaches</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a fluent-API builder pattern - you configure everything "by hand"</p>
</li>
<li>
<p>a configuration based pattern - you configure everything in a configuration file</p>
</li>
<li>
<p>hybrid - you load a builder from configuration and update in a program</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once a security instance is built, it can be used to initialize an <a href="#_cloud_security_container_integrations">integration with a container</a>,
or to use security from a program directly:</p>
</div>
<div class="listingblock">
<div class="title">Security direct usage</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// create a security context</span>
SecurityContext context = security.createContext(<span class="predefined-type">UUID</span>.randomUUID().toString());

<span class="comment">// use the context to authenticate a request</span>
context.authenticationClient()
        .transport(<span class="string"><span class="delimiter">&quot;</span><span class="content">http</span><span class="delimiter">&quot;</span></span>)
        .method(<span class="string"><span class="delimiter">&quot;</span><span class="content">get</span><span class="delimiter">&quot;</span></span>)
        .path(<span class="string"><span class="delimiter">&quot;</span><span class="content">/test</span><span class="delimiter">&quot;</span></span>)
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Authorization</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bearer abcdefgh</span><span class="delimiter">&quot;</span></span>)
        .submit()
        .whenComplete((response, exception) -&gt; {
            <span class="comment">// this is to show the features, not a real-world production code...</span>
            <span class="keyword">if</span> (<span class="predefined-constant">null</span> == exception) {
                <span class="keyword">if</span> (response.getStatus().isSuccess()) {
                    <span class="predefined-type">System</span>.out.println(response.getSubject());
                } <span class="keyword">else</span> {
                    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Authentication failed: </span><span class="delimiter">&quot;</span></span> + response.getDescription());
                }
            } <span class="keyword">else</span> {
                exception.printStackTrace();
            }
        });</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_builder_pattern">Builder pattern</h5>
<div class="listingblock">
<div class="title">Security through a builder</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Security</span> security = <span class="predefined-type">Security</span>.builder()
        <span class="comment">// create a provider instance based on the provider documentation</span>
        .addProvider(...)
        .build();</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_pattern">Configuration pattern</h5>
<div class="paragraph">
<p>See <a href="#_tools">Secure config</a> for details about encrypting passwords in configuration files.</p>
</div>
<div class="listingblock">
<div class="title">Security from configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// uses io.j4c.Config</span>
<span class="predefined-type">Security</span> security = <span class="predefined-type">Security</span>.fromConfig(config);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Security from configuration - configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="conf"># Uses secure config tool to encryp passwords
security.providers: [
    {
        name = &quot;basic&quot;
        class = &quot;io.j4c.security.httpauth.HttpAuthProvider&quot;
        http-basic-auth {
            realm = &quot;mic&quot;

            user-store {
                users: [
                    {
                        login = &quot;aUser&quot;
                        password = &quot;${CLEAR=somePassword}&quot;
                        roles = [&quot;theRole&quot;]

                    },
                    {
                        login = &quot;noRoles&quot;
                        password = &quot;${CLEAR=somePassword}&quot;
                        roles = []
                    }
                ]
            }
        }
    }
]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_hybrid_pattern_builder_configuration">Hybrid pattern (Builder &amp; Configuration)</h5>
<div class="listingblock">
<div class="title">Security from configuration and builder</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// uses io.j4c.Config</span>
<span class="predefined-type">Security</span> security = <span class="predefined-type">Security</span>.builderFromConfig(config)
                .addProvider(...)
                .build();

<span class="comment">// or reverse order:</span>
<span class="predefined-type">Security</span> security = <span class="predefined-type">Security</span>.builder()
                .addProvider()
                .config(config)
                .build();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cloud_security_installation">2.3.2. Cloud Security Installation</h4>
<div class="sect4">
<h5 id="_coordinates_8">Coordinates</h5>
<div class="paragraph">
<p>Latest version can be found at:</p>
</div>
<div class="paragraph">
<p><a href="https://artifactory-slc.oraclecorp.com/artifactory/api/search/latestVersion?g=io.j4c.security&amp;a=j4c-security&amp;repos=mic-release-local" class="bare">https://artifactory-slc.oraclecorp.com/artifactory/api/search/latestVersion?g=io.j4c.security&amp;a=j4c-security&amp;repos=mic-release-local</a></p>
</div>
<div class="paragraph">
<p>Version at the time this document was written: 0.1.0-b111</p>
</div>
<div class="listingblock">
<div class="title">Maven Dependency</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>io.j4c.security<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>j4c-security<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;version&gt;</span>${version}<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_requirements_3">Requirements</h5>
<div class="paragraph">
<p>The following java version was used to build and test the latest release.</p>
</div>
<div class="listingblock">
<div class="title">Java 9 Required</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">$ java -version
java version &quot;9-ea&quot;
Java(TM) SE Runtime Environment (build 9-ea+174-jigsaw-nightly-h6526-20170617)
Java HotSpot(TM) 64-Bit Server VM (build 9-ea+174-jigsaw-nightly-h6526-20170617, mixed mode)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cloud_security_container_integrations">2.3.3. Cloud Security Container Integrations</h4>
<div class="paragraph">
<p>The following containers are integrated with Cloud Security:</p>
</div>
<div class="sect4">
<h5 id="_web_server_2">Web server</h5>
<div class="paragraph">
<p>Integration of <a href="#_rx_web_server">reactive web server</a></p>
</div>
<div class="listingblock">
<div class="title">Maven Dependency</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>io.j4c.security<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>j4c-security-integration-webserver<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;version&gt;</span>${version}<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_bootstrapping">Bootstrapping</h6>
<div class="paragraph">
<p>There are two steps to configure security with web server:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create security instance and register it with server</p>
</li>
<li>
<p>Protect routes of web server with various security features</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Example using builders</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// web server's Routing</span>
Routing.builder()
    <span class="comment">// This is step 1 - register security instance with web server processing</span>
    <span class="comment">// security - instance of security either from config or from a builder</span>
    <span class="comment">// gateDefaults - default enforcement for each route that hase a security gate</span>
    <span class="comment">// (to be changed in the future to &quot;securedDefaults&quot; and &quot;secured&quot;)</span>
    .register(WebSecurity.from(security).gateDefaults(WebSecurity.authenticate()))
    <span class="comment">// this is step 2 - protect a route</span>
    <span class="comment">// protect this route with authentication (from defaults) and role &quot;user&quot;</span>
    .get(<span class="string"><span class="delimiter">&quot;</span><span class="content">/service1</span><span class="delimiter">&quot;</span></span>, WebSecurity.rolesAllowed(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>), (req, res) -&gt; {
        processService1Request(req, res);
    })
    .build();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example using configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Routing.builder()
    <span class="comment">// helper method to load both security and web server security from configuration</span>
    .register(WebSecurity.from(config))
    <span class="comment">// continue with web server route configuration</span>
    .build();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example using configuration - configuration (HOCON)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="conf"># This may change in the future - to align with web server configuration, once it is supported
security.web-server {
    # Configuration of integration with web server
    defaults {
        authenticate = true
    }
    paths: [
        {
            path = &quot;/service1&quot;
            methods = [&quot;get&quot;]
            roles-allowed = [&quot;user&quot;]
        }
    ]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_jersey">Jersey</h5>
<div class="paragraph">
<p>Integration of Jersey (JAX-RS implementation) both for inbound and outbound security.</p>
</div>
<div class="listingblock">
<div class="title">Maven Dependency</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>io.j4c.security<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>j4c-security-integration-jersey<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;version&gt;</span>${version}<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_inbound_security">Inbound security</h6>
<div class="listingblock">
<div class="title">Integrate with Jersey</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ResourceConfig resourceConfig = <span class="keyword">new</span> ResourceConfig()
    <span class="comment">// register JAX-RS resource</span>
    .register(JaxRsResource.class)
    <span class="comment">// integrate security</span>
    .register(<span class="keyword">new</span> io.j4c.security.jersey.SecurityFeature(security));</code></pre>
</div>
</div>
<div class="sect6">
<h7 id="_protecting_a_resource">Protecting a resource</h7>
<div class="paragraph">
<p>The current approach does not have a configuration option. The security must be configured through
annotations.
Security currently supports @Secured. When a resource is annotated with this annotation
(application class, resource class, or resource method), security will be triggered.</p>
</div>
<div class="listingblock">
<div class="title">Securing a resource method</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// this is sufficient for security to be triggered, see javadoc for further details</span>
<span class="annotation">@Secured</span>
<span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/{name}</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@GET</span>
<span class="annotation">@Produces</span>(MediaType.TEXT_PLAIN)
<span class="comment">// due to Jersey approach to path matching, we need two methods to match both the &quot;root&quot; and &quot;root&quot; + subpaths</span>
<span class="directive">public</span> <span class="predefined-type">String</span> getHelloName(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> name) {
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="delimiter">&quot;</span></span> + name + <span class="string"><span class="delimiter">&quot;</span><span class="content">, your current subject: </span><span class="delimiter">&quot;</span></span> + securityContext.getSubject();
}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_access_context">Access context</h7>
<div class="listingblock">
<div class="title">Support in a JAX-RS resource</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// inject io.j4c.security.SecurityContext</span>
<span class="annotation">@Context</span>
<span class="directive">private</span> SecurityContext securityContext;

<span class="comment">// inject security feature to invoke outbound calls (see below)</span>
<span class="annotation">@Context</span>
<span class="directive">private</span> ClientSecurityFeature clientFeature;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_outbound_security">Outbound security</h6>
<div class="sect6">
<h7 id="_within_jax_rs_resource_served_by_jersey">Within JAX-RS Resource served by Jersey</h7>
<div class="listingblock">
<div class="title">Call remote target with outbound security</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// I expect you have injected the ClientSecurityFeature as shown above</span>
Client client = ClientBuilder.newClient()
    <span class="comment">// integrate security</span>
    .register(clientFeature);

<span class="keyword">try</span> {
    <span class="comment">// call the resource, will propagate identity as configured in Security</span>
    <span class="predefined-type">String</span> response = client.target(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.google.com</span><span class="delimiter">&quot;</span></span>)
        .request()
        .get(<span class="predefined-type">String</span>.class);
} <span class="keyword">finally</span> {
    client.close();
}</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_standalone_jersey_client">Standalone Jersey Client</h7>
<div class="listingblock">
<div class="title">Call remote target with outbound security</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Each integration has access to SecurityContext, or you already have one created from security instance</span>
<span class="comment">// the context knows whether we are authenticated...</span>
SecurityContext context = ....;
Client client = ClientBuilder.newBuilder()
        .register(<span class="keyword">new</span> ClientSecurityFeature(context))
        .build();
<span class="keyword">try</span> {
    <span class="comment">// call the resource, will propagate identity as configured in Security</span>
    <span class="predefined-type">String</span> response = client.target(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.google.com</span><span class="delimiter">&quot;</span></span>)
        .request()
        .get(<span class="predefined-type">String</span>.class);
} <span class="keyword">finally</span> {
    client.close();
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cloud_security_providers">2.3.4. Cloud Security Providers</h4>
<div class="paragraph">
<p>The following providers are implemented:</p>
</div>
<div class="sect4">
<h5 id="_http_signatures">HTTP Signatures</h5>
<div class="paragraph">
<p>Support for HTTP Signatures (both inbound and outbound).</p>
</div>
<div class="listingblock">
<div class="title">Maven Dependency</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>io.j4c.security<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>j4c-security-provider-http-signature<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;version&gt;</span>${version}<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_signature_basics">Signature basics</h6>
<div class="ulist">
<ul>
<li>
<p>standard: based on <a href="https://tools.ietf.org/html/draft-cavage-http-signatures-03" class="bare">https://tools.ietf.org/html/draft-cavage-http-signatures-03</a></p>
</li>
<li>
<p>key-id: an arbitrary string used to locate signature configuration - when a request is received
the provider locates validation configuration based on this id (e.g. HMAC shared secret or RSA
public key). Commonly used meanings are: key fingerprint (RSA); API Key</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_inbound_signatures">Inbound signatures</h6>
<div class="paragraph">
<p>We act as a server and another party is calling us with a signed HTTP request.
We validate the signature and assume identity of the caller.</p>
</div>
<div class="paragraph">
<p>Builder example, starting from inside out:</p>
</div>
<div class="listingblock">
<div class="title">Inbound signature configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Configuration of public key certificate to vaidate inbound requests</span>
keyConfig = KeyConfig.builder()
                         .keystorePath(Paths.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">keystore.p12</span><span class="delimiter">&quot;</span></span>))
                         .keystorePassphrase(<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>.toCharArray())
                         .certificateAlias(<span class="string"><span class="delimiter">&quot;</span><span class="content">service_cert</span><span class="delimiter">&quot;</span></span>)
                         .build();

<span class="comment">// Create inbound client definition (e.g. map key-id to a public key and principal name)</span>
rsaInbound = InboundClientDefinition.builder(<span class="string"><span class="delimiter">&quot;</span><span class="content">service1-rsa</span><span class="delimiter">&quot;</span></span>)
                          .principalName(<span class="string"><span class="delimiter">&quot;</span><span class="content">Service1</span><span class="delimiter">&quot;</span></span>)
                          .publicKeyConfig(keyConfig)
                          .build();

<span class="comment">// Now create a HTTP signature provider with inbound support (with a single supported signature)</span>
HttpSignProvider.builder()
             .addInbound(rsaInbound)
             .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Configuration examples for hmac-sha256 and rsa-sha256 algorithms (as supported by this provider):</p>
</div>
<div class="listingblock">
<div class="title">Inbound signature configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="conf">http-signatures {
    inbound {
        keys: [
            {
                key-id = &quot;service1-hmac&quot;
                # name of principal of the connecting party
                principal-name = &quot;Service1&quot;
                # SERVICE or USER, defaults to SERVICE
                principal-type = SERVICE
                # defaults to the one we configure (e.g. if hmac.secret is configured
                # it is hmac-sha256; if public-key is configured, it is rsa-sha256)
                algorithm = &quot;hmac-sha256&quot;
                # shared secret for symmetric signatures
                hmac.secret = &quot;${CLEAR=encryptMe}&quot;
            },
            {
                key-id = &quot;service1-rsa&quot;
                principal-name = &quot;Service1&quot;
                # configuration of public key to validate signature
                public-key {
                    # path to keystore
                    keystore-path = &quot;src/main/resources/keystore.p12&quot;
                    # defaults to PKCS12
                    keystore-type = &quot;PKCS12&quot;
                    # password of the keystore
                    # the ${CLEAR=} is a feature of
                    keystore-passphrase = &quot;${CLEAR=password}&quot;
                    # alias of the certificate to get public key from
                    cert-alias = &quot;service_cert&quot;
                }
            }
        ]
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_outbound_signatures">Outbound signatures</h6>
<div class="paragraph">
<p>We act as a client and we sign our outgoing requests.</p>
</div>
<div class="paragraph">
<p>Builder example, starting from inside out (rsa only, as hmac is significantly simpler):</p>
</div>
<div class="listingblock">
<div class="title">Outbound signature configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Configuration of private key to sign outbound requests</span>
keyConfig = KeyConfig.builder()
                        .keystorePath(Paths.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">src/main/resources/keystore.p12</span><span class="delimiter">&quot;</span></span>))
                        .keystorePassphrase(<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>.toCharArray())
                        .keyAlias(<span class="string"><span class="delimiter">&quot;</span><span class="content">myPrivateKey</span><span class="delimiter">&quot;</span></span>)
                        .build())

rsaTarget =  OutboundTarget.builder(<span class="string"><span class="delimiter">&quot;</span><span class="content">service2-rsa</span><span class="delimiter">&quot;</span></span>)
                        .addHost(<span class="string"><span class="delimiter">&quot;</span><span class="content">service2</span><span class="delimiter">&quot;</span></span>) <span class="comment">// considering service registry</span>
                        .addPath(<span class="string"><span class="delimiter">&quot;</span><span class="content">/service2-rsa</span><span class="delimiter">&quot;</span></span>)
                        .customObject(OutboundTargetDefinition.class,
                                      OutboundTargetDefinition.builder(<span class="string"><span class="delimiter">&quot;</span><span class="content">service1-rsa</span><span class="delimiter">&quot;</span></span>)
                                              .privateKeyConfig(keyConfig)
                                              .build())
                        .build();

<span class="comment">// Now create a HTTP signature provider with outbound support (with a single supported signature)</span>
HttpSignProvider.builder()
             .outbound(OutboundConfig.builder()
                       .addTarget(rsaTarget)
                       .build())
             .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Configuration examples for hmac-sha256 and rsa-sha256 algorithms (as supported by this provider):</p>
</div>
<div class="listingblock">
<div class="title">Inbound signature configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="conf">http-signatures {
outbound: [
    {
        # Logical name of this outbound configuration
        name = &quot;service2-trust-circle&quot;
        # If ommited or one value is &quot;*&quot;, all are supported
        transports = [&quot;http&quot;, &quot;https&quot;]
        # If ommited or one value is &quot;*&quot;, all are supported, may contain * as a sequence &quot;any&quot; characters/nubmers
        hosts = [&quot;service2&quot;]
        # If ommited, all are supported - regular expression
        paths = [&quot;/service2&quot;]

        # Configuration of signature (signing the request)
        signature {
            key-id = &quot;service2-shared-secret&quot;
            # HMAC shared secret (algorithm hmac-sha256)
            hmac.secret = &quot;${CLEAR=somePasswordForHmacShouldBeEncrypted}&quot;
        }
    },
    {
        name = &quot;service2-rsa&quot;
        hosts = [&quot;service2&quot;]
        paths = [&quot;/service2-rsa&quot;]


        signature {
            key-id = &quot;service1-rsa&quot;
            # RSA private key (algorithm rsa-sha256)
            private-key {
                # path to keystore
                keystore-path = &quot;src/main/resources/keystore.p12&quot;
                # Keystore type
                # PKCS12, JSK or RSA (not really a keystore, but directly the linux style private key unencrypted)
                # defaults to jdk default
                keystore-type = &quot;PKCS12&quot;
                # password of the keystore
                keystore-passphrase = &quot;password&quot;
                # alias of the key to sign request
                key-alias = &quot;myPrivateKey&quot;
            }
        }
    }
]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_http_authentication">HTTP Authentication</h5>
<div class="paragraph">
<p>Basic and Digest authentication support</p>
</div>
<div class="listingblock">
<div class="title">Maven Dependency</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>io.j4c.security<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>j4c-security-provider-http-auth<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;version&gt;</span>${version}<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_roles_authorization_provider">Roles Authorization Provider</h5>
<div class="paragraph">
<p>Support for roles, roles mapping and @RolesAllowed annotation</p>
</div>
<div class="listingblock">
<div class="title">Maven Dependency</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>io.j4c.security<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>j4c-security-provider-roles<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;version&gt;</span>${version}<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tools">2.3.5. Tools</h4>
<div class="sect4">
<h5 id="_secure_configuration">Secure configuration</h5>
<div class="paragraph">
<p>Support for encrypting secrets in configuration files.</p>
</div>
<div class="listingblock">
<div class="title">Maven Dependency</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>io.j4c.security<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>j4c-security-tools-config<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;version&gt;</span>${version}<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_key_and_certificate_configuration">Key and certificate configuration</h5>
<div class="paragraph">
<p>Configuration support for accessing private keys, public keys, certificates and certificate
chains including runtime access to instances of such.</p>
</div>
<div class="listingblock">
<div class="title">Maven Dependency</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>io.j4c.security<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>j4c-pki-util<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;version&gt;</span>${version}<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_developer_s_guide">2.3.6. Developer&#8217;s Guide</h4>
<div class="paragraph">
<p>This guide guides you through extension possibilities for Security component.</p>
</div>
<div class="paragraph">
<p>The component has the following extension points:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Security providers</p>
</li>
<li>
<p>Provider selection policy</p>
</li>
<li>
<p>Integration with a framework</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_security_providers">Security providers</h5>
<div class="paragraph">
<p>You can build a custom provider for each type of security concept supported.
By default, each provider is asynchronous. To simplify simple cases, a class
exists in "spi" package to help in implementing synchronous approach: "SynchronousProvider".</p>
</div>
<div class="paragraph">
<p>You have two options:
1. Implement a provider interface and reference it in configuration (or from builder) by class
2. Implement a provider interface and provide a java service implementing "io.j4c.security.spi.SecurityProviderService"</p>
</div>
<div class="paragraph">
<p>The second option allows for easier configuration, as the configuration key can be used
without a class definition and creates a default name of a provider.</p>
</div>
<div class="sect5">
<h6 id="_authentication_provider">Authentication provider</h6>
<div class="paragraph">
<p>To create a custom authentication provider, create a class that implements
"io.j4c.security.spi.AuthenticationProvider".
Implementation is responsible for taking a request and assuming a subject
based on that request.
In case the protocol is multi-request (e.g. challenge for basic authentication), you have
the possibility to return specific headers and a response code.
The default semantics of these is HTTP, though providers may exist that are not
HTTP specific.</p>
</div>
</div>
<div class="sect5">
<h6 id="_authorization_provider">Authorization provider</h6>
<div class="paragraph">
<p>To create a custom authorization provider, create a class that implements
"io.j4c.security.spi.AuthorizationProvider".
Implementation is responsible for taking a request and checking whether the request
can continue processing (e.g. if the current user and/or service subject has a right to execute it).</p>
</div>
<div class="paragraph">
<p>If authentication is configured, the Security component guarantees it resolved before authorization.</p>
</div>
</div>
<div class="sect5">
<h6 id="_outbound_security_provider">Outbound security provider</h6>
<div class="paragraph">
<p>To create a custom outbound security provider, create a class that implements
"io.j4c.security.spi.OutboundSecurityProvider".
Implementation can update outgoing message headers and/or entities to handle
security for an outgoing request (e.g. identity propagation, mapping etc.).</p>
</div>
</div>
<div class="sect5">
<h6 id="_audit_provider">Audit provider</h6>
<div class="paragraph">
<p>To create a custom audit provider, create a class that implements
"io.j4c.security.spi.AuditProvider".
Security component feeds each audit provider all messages from all components
that invoke audit method on "Security" class, including internal audit events
pre-configured in the component itself (e.g. authentication, authorization events).</p>
</div>
<div class="paragraph">
<p>Implementation may do whatever desired with these messages, e.g.:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>filter them</p>
</li>
<li>
<p>log them</p>
</li>
<li>
<p>store them to a database</p>
</li>
<li>
<p>forward them to an audit component</p>
</li>
<li>
<p>discard them</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_provider_selection_policy">Provider selection policy</h5>
<div class="paragraph">
<p>Each request is processed by a single authentication and/or authorization provider.
The selection policy provides the security component information about which provider to use.
Out of the box, there are three policies:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>"First" policy - first configured provider (or explicitly defined default provider) is used by default, if a named
provider is requested, it would be used</p>
</li>
<li>
<p>"Composite" policy - this policy allows for a sequence of providers to be executed (e.g. one request may have more than
one provider) - used for example to resolve service and user authentication</p>
</li>
<li>
<p>"Class" policy - this allows usage of a custom policy defined by fully qualified class name</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To create a custom provider selection policy, create a class that implements
"io.j4c.security.spi.ProviderSelectionPolicy".</p>
</div>
</div>
<div class="sect4">
<h5 id="_framework_integration">Framework integration</h5>
<div class="paragraph">
<p>To integrate a new framework, you should create a single Security
instance shared for a scope (e.g. one application). Security instance
has a method to create a SecurityContext (request scope).
Use tools of the framework integrated to add annotations support (if feasible).</p>
</div>
<div class="paragraph">
<p>There are two annotations that should be supported:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>@Secured - to configure security, e.g. authentication, authorization</p>
</li>
<li>
<p>@Audited - to configure auditing</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In addition you should implement integration of entity processing through Request builder
 - see integration for Jersey, class "SecurityFilter"</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_open_tracing">2.4. Open Tracing</h3>
<div class="paragraph">
<p>See the <a href="http://opentracing.io/documentation/">OpenTracing documentation</a>
for information on the OpenTracing API.</p>
</div>
</div>
<div class="sect2">
<h3 id="_prometheus">2.5. Prometheus</h3>
<div class="paragraph">
<p>See the <a href="https://github.com/prometheus/client_java/blob/master/README.md">Prometheus JVM Client documentation</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tracing_and_monitoring">3. Tracing and Monitoring</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_deployment">4. Deployment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is the documentation for deploying</p>
</div>
<div class="sect2">
<h3 id="_first_deployment_section">4.1. First Deployment Section</h3>
<div class="ulist">
<ul>
<li>
<p>item 1</p>
</li>
<li>
<p>item 2</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_code_bmkops_code_tool">4.2. <code>bmkops</code> Tool</h3>
<div class="paragraph">
<p><code>bmkops</code> is command line tool that can be used to setup Kubernetes cluster on Oracle Bare Metal Cloud Service.</p>
</div>
<div class="sect3">
<h4 id="_installation">4.2.1. Installation</h4>
<div class="sect4">
<h5 id="_preparing_bare_metal_cloud_service_profile">Preparing Bare Metal Cloud Service Profile</h5>
<div class="paragraph">
<p>In order to enable access to the Bare Metal Cloud Service API, you need to setup your profile with authentication keys.</p>
</div>
<div class="paragraph">
<p>This means creating a public/private key pair in your user account, and adding the public key to your BMCS profile. The following steps are summarized from this <a href="https://docs.us-phoenix-1.oraclecloud.com/Content/API/Concepts/apisigningkey.htm">BMCS guide</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create the public/private key pair if you don&#8217;t have one already.  (Usually located at <code>~/.ssh/id_rsa</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>ssh-keygen -t rsa -b 4096</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you haven&#8217;t already, create a <code>.oraclebmc</code> directory to store the credentials:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>mkdir ~/.oraclebmc</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Generate the private key with no passphrase:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>openssl genrsa -out ~/.oraclebmc/bmcs_api_key.pem 2048</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure that only you can read the private key file:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>chmod go-r ~/.oraclebmc/bmcs_api_key.pem</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Generate the public key</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>openssl rsa -pubout -in ~/.oraclebmc/bmcs_api_key.pem -out ~/.oraclebmc/bmcs_api_key_public.pem</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Login to the console <a href="https://console.us-phoenix-1.oraclecloud.com/">https://console.us-phoenix-1.oraclecloud.com</a> with your username and password.</p>
</li>
<li>
<p>Upload the public key content from
 <code>~/.oraclebmc/bmcs_api_key_public.pem</code> to &lt;your user name&gt;&#8594;User
 Settings&#8594; Add API Keys. If the public key is valid this will
generate a fingerprint for you.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_gathering_account_information">Gathering Account Information</h5>
<div class="paragraph">
<p>Create a <code>~/.oraclebmc/config</code> file and add account information there. The details of the content of the config file can be found in <a href="https://docs.us-phoenix-1.oraclecloud.com/Content/API/Concepts/sdkconfig.htm">https://docs.us-phoenix-1.oraclecloud.com/Content/API/Concepts/sdkconfig.htm</a></p>
</div>
<div class="paragraph">
<p>An example <code>~/.oraclebmc/config</code> file content should look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">[DEFAULT]
user=ocid1.user.oc1..aaaaaaaau2tbxvjhaz6rofksz7zhl22gi6fypmugdaplahhtnrk53r4i3g5a
fingerprint=f8:fe:db:<span class="integer">4</span>a:<span class="float">9f</span>:b9:<span class="integer">0</span>e:<span class="integer">0</span>b:<span class="integer">4</span>a:ca:a0:<span class="integer">0</span>e:<span class="float">9d</span>:<span class="integer">79</span>:<span class="integer">09</span>:dc
tenancy=ocidv1:tenancy:oc1:phx:<span class="integer">1461274726633</span>:aaaaaaaamx5hilzhdwvds5wfsn2akuyty4
region=us-phoenix-<span class="integer">1</span>
compartment=ocid1.compartment.oc1..aaaaaaaamn3g3klqsgnbxhawpn7blddxrt36exeegtej3sa2oy6ve3powylq
key_file=/Users/username/.oraclebmc/bmcs_api_key.pem</code></pre>
</div>
</div>
<div class="paragraph">
<p>All the information required for the file contents can be determined using <a href="https://console.us-phoenix-1.oraclecloud.com/">https://console.us-phoenix-1.oraclecloud.com/</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>User OCID</strong>: Go to &lt;:User Name &gt;User Settings. User OCID will be listed under user name.</p>
</li>
<li>
<p><strong>Tenancy OCID</strong>: Go to &lt;:User Name &gt;User Settings. Tenancy OCID is listed at the bottom of the page in grey color.</p>
</li>
<li>
<p><strong>Compartment OCID</strong>:   Identity&#8594; Go to Compartments. Locate your compartment and the OCID will be listed there.</p>
</li>
<li>
<p><strong>BMCS region name</strong> can be determined from <a href="https://docs.us-phoenix-1.oraclecloud.com/Content/General/Concepts/regions.htm">https://docs.us-phoenix-1.oraclecloud.com/Content/General/Concepts/regions.htm</a>. Currently there is only one region which is us-phoenix-1</p>
</li>
<li>
<p><strong>Private key path</strong> which is  <code>~/.oraclebmc/bmcs_api_key.pem</code> if created as previously described.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_prerequisites_4">Prerequisites</h5>
<div class="paragraph">
<p><strong>OEL 7 is recommended OS platform.  </strong>(OEL 6u7 can be used but requires more setup steps.  )</p>
</div>
<div class="paragraph">
<p><strong>Python and Pip</strong> - <code>bmkops</code> runs
 inside Python virtual environment and uses pip package manager for
dependency management. Minimal verified python version is 2.7.5, note
that 3.x is <strong>not</strong> supported at this time.</p>
</div>
<div class="paragraph">
<p><strong>Git</strong></p>
</div>
<div class="paragraph">
<p><strong>VirtualEnv</strong></p>
</div>
<div class="paragraph">
<p>Make sure that your environment sets http_proxy and https_proxy:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>export http_proxy=www-proxy.us.oracle.com:80</code></p>
</li>
<li>
<p><code>export https_proxy=www-proxy.us.oracle.com:80</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_python_and_pip_installation_if_not_installed">Python and Pip Installation (if not installed)</h5>
<div class="sect5">
<h6 id="_oel_7_python_and_pip_installation_instructions">OEL 7 Python and Pip Installation Instructions</h6>
<div class="paragraph">
<p>This will update system python installation to the latest available 2.7.5 package update and install pip package from EPEL repository.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sudo su</code></p>
</li>
<li>
<p>Enable EPEL repository using <a href="https://fedorahosted.org/copr/wiki/HowToEnableRepo">these instructions</a>.</p>
</li>
<li>
<p><code>yum update python</code></p>
</li>
<li>
<p><code>yum install python-pip</code></p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_oel_6u7_python_and_pip_installation_instructions">OEL 6u7 Python and Pip Installation Instructions</h6>
<div class="paragraph">
<p>On
 this platform you will need to install python 2.7.x as an alternative
install since system-wide python installation is limited to 2.6.x and
cannot be safely updated. We used and verified python 2.7.8 in this
scenario.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sudo su</code></p>
</li>
<li>
<p>Create dedicated directory and download python distribution:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>wget  <a href="http://www.python.org/ftp/python/2.7.8/Python-2.7.8.tar.xz-" class="bare">http://www.python.org/ftp/python/2.7.8/Python-2.7.8.tar.xz-</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Extract distribution content:
<code>xz -d Python-2.7.8.tar.xz </code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>tar -xvf Python-2.7.8.tar</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enter extracted directory and run configure command:
<code>cd Python-2.7.8</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>./configure --prefix=/usr/local</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Compile and install python:
<code>make</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>make altinstall</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Check python version, should be 2.7.8:
<code>python2.7 -V</code></p>
</li>
<li>
<p>Create dedicated temporary directory and download get-pip.py script to it:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>wget <a href="https://bootstrap.pypa.io/get-pip.py" class="bare">https://bootstrap.pypa.io/get-pip.py</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Run  the script to install pip:
<code>python2.7 get-pip.py</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_virtualenv_installation_if_not_installed">VirtualEnv Installation (if not installed)</h5>
<div class="ulist">
<ul>
<li>
<p><code>sudo pip install --upgrade virtualenv </code></p>
<div class="literalblock">
<div class="content">
<pre>(upgrades ``virtualenv`` to version 15.1.0)</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_samples">5. Samples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Please see the <a href="http://sca00jue.us.oracle.com:7070/mic/prime-samples">J4C Samples</a> repository for a
large collection of example programs.</p>
</div>
</div>
</div></div></div>

            </div>
    <div id="footer">
      <div class="container">
        <p class="muted credit">Copyright &copy; 2017 | All Rights Reserved.</a></p>
      </div>
    </div>
    </div>

    <!-- Placed at the end of the document so the pages load faster -->
    <script src="js/jquery-1.8.3.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/prettify.js"></script>

    <script type="text/javascript">
        $(function() {
            $('#toc a').click(function(){
                $('html, body').animate({
                      scrollTop: $($(this).attr('href')).offset().top - 65
                  }, 10);
                });
            });
    </script>
  </body>
</html>